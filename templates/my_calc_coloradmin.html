<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <title>JPC CALC V2.0 (ColorAdmin)</title>

  <!-- ================== BEGIN ColorAdmin core CSS ================== -->
  <!-- Statt Bootstrap-CDN nutzen wir ColorAdmin (enthält Bootstrap + FontAwesome) -->
  <link href="/static/coloradmin/css/vendor.min.css" rel="stylesheet" />
  <link href="/static/coloradmin/css/app.min.css" rel="stylesheet" />
  <!-- ================== END ColorAdmin core CSS ================== -->

  <!-- Behalte dein Custom-Style (leicht angepasst, falls nötig) -->
  <style>
    /* -----------------------------
       Deins: Aus deinem <style> Block
       ----------------------------- */
    body {
      font-size: 14px;
      background-color: #f8f9fa;
    }
/* Navbar-Header als flexbox-Container */
.navbar-header {
  display: flex;
  align-items: center;
  gap: 15px; /* Abstand zwischen Burger und Logo */
  padding-left: 15px; /* Abstand zum linken Bildschirmrand */
}

/* Das eigentliche Burger-Element */
.navbar-desktop-toggler,
.navbar-mobile-toggler {
  font-size: 1rem;    /* statt 2rem */
  line-height: 1;
  background: none;
  border: none;       /* kein Rahmen */
  padding: 0;
  margin: 0;
}

/* Burger-Icon selbst (z. B. .fa-bars) dezenter darstellen */
.navbar-desktop-toggler i.fa-bars,
.navbar-mobile-toggler i.fa-bars {
  font-size: 1.2rem;
  color: #444;
  margin-right: 5px; /* minimaler Abstand zur Kante */
}

/* Logo + Text in einer Zeile, größer */
.navbar-brand {
  display: flex;
  align-items: center;
  white-space: nowrap; /* verhindert Zeilenumbruch */
  gap: 10px;           /* Abstand zwischen Logo-Bild und Text */
}

/* Logo selbst doppelt so hoch wie sonst */
.navbar-brand img,
.navbar-header .navbar-brand img {
  height: 80px !important; /* doppelte Höhe */
  width: auto;
}

/* Text neben dem Logo (falls vorhanden) */
.navbar-brand span,
.navbar-header .navbar-brand span {
  font-size: 18px;       /* größerer Text */
  vertical-align: middle;
  margin-left: 10px;     /* kleiner Seitenabstand */
}

/*
   2) Sidebar (nur Icons, kein Text)
      --------------------------------
   - Falls du reine Icon-Navigation willst,
     verstecke den Text
*/

/* Icon minimal vergrößern */
.nav-icon {
  font-size: 1.2rem;
}

/* Den .nav-text (Beschriftung) ausblenden,
   wenn du nur Symbole anzeigen willst. */
.nav-text {
  display: none !important;
}

/* Falls du in der rechten Navbar
   (z. B. "Zu meinem Account")
   einen Rand vom Bildschirm haben möchtest */
.navbar-nav {
  margin-right: 20px;
}

/*
   3) Chat-Bubble + Fenster (im Modal)
      --------------------------------
   - Für dein PCB-Modal (oder andere Modals).
   - Position: unten rechts im Modal
   - Kleines Overlay-Fenster
*/

/* Modal-Body relative => absolute Bubble */
.modal-body {
  position: relative;
}

/* Chat-Bubble (Icon) unten rechts */
#pcbChatBubble {
  position: absolute;
  right: 10px;
  bottom: 10px;
  width: 40px;
  height: 40px;
  cursor: pointer;
  z-index: 9999; /* über Modal-Inhalt */
}
#pcbChatBubble img {
  width: 100%;
  height: auto;
  border-radius: 50%;
  box-shadow: 0 0 5px rgba(0,0,0,0.3);
}

/* Chat-Fenster: absolutes Panel */
#pcbChatWindow {
  position: absolute;
  right: 60px;
  bottom: 60px;
  width: 280px;
  background: #fff;
  border: 1px solid #ccc;
  box-shadow: 0 0 6px rgba(0,0,0,0.2);
  z-index: 9999;
  display: none; /* per JS togglen */
}

/* Kopf-/Body-/Footer-Bereiche im Chat-Fenster */
#pcbChatWindow .header {
  background: #f0f0f0;
  padding: 6px;
  font-weight: bold;
}
#pcbChatWindow .body {
  max-height: 150px;
  overflow-y: auto;
  padding: 6px;
  font-size: 0.85rem;
}
#pcbChatWindow .footer {
  padding: 6px;
  text-align: right;
}

/*
   4) Sonstige Tab-Styles
      --------------------------------
   - Leicht erhöhte Schrift im Tab.
*/
.nav-tabs .nav-link {
  font-weight: 500;
}
    .table-sm td,
    .table-sm th {
      padding: 0.3rem;
    }

    /* Beispiel: Hover-Effekt für Bilder */
    .img-choice {
      width: 120px;
      margin: 0.5rem;
      border: 2px solid #ddd;
      border-radius: 4px;
      cursor: pointer;
    }
    .img-choice:hover {
      border: 2px solid #007bff;
    }

    /* Flex-Layout für Input + Button, wenn gewünscht */
    .flex-container {
      display: flex;
      flex-wrap: nowrap;
      align-items: center;
      justify-content: space-between;
    }
    .flex-container .form-control {
      width: 70%;
    }
    .flex-container .btn {
      width: 30%;
      margin-left: 0.25rem;
    }

    /* Beispiel-Slider */
    input[type="range"] {
      -webkit-appearance: none;
      appearance: none;
      width: 100%;
      height: 8px;
      background: linear-gradient(
        to right,
        #ff0000 0%,
        #ff0000 50%,
        #ccc 50%,
        #ccc 100%
      );
      border-radius: 5px;
      outline: none;
      opacity: 0.9;
      transition: background 0.3s;
    }
    input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 20px;
      height: 20px;
      background: #4caf50;
      cursor: pointer;
      border-radius: 50%;
    }
    input[type="range"]::-moz-range-thumb {
      width: 20px;
      height: 20px;
      background: #4caf50;
      cursor: pointer;
      border-radius: 50%;
    }

    /* Responsive Design für Smartphones */
    @media (max-width: 768px) {
      body {
        transform: scale(0.8);
        transform-origin: top left;
      }
      input[type="text"],
      input[type="number"] {
        width: 100%;
        font-size: 12px;
      }
      .form-label {
        font-size: 10px;
      }
      h1,
      h2,
      h3 {
        font-size: 80%;
      }
      .btn {
        font-size: 12px;
        padding: 0.4rem 0.8rem;
      }
    }
    /* Entfernte "Rumtricksereien" für Tab 5, nur minimaler Abstand */
    /* Stattdessen nutzen wir die p-3-Klasse im Tab-Container selbst. */

    /* Evtl. kleinere Anpassung, damit Sidebar & Header sauber aussehen */
    .app-header {
      min-height: 60px; /* minimal höher für Logo/Bereich */
    }

    /* Beispiel: Floating Chat-Bubble */
    #chatBubble {
      position: fixed;
      bottom: 20px;
      right: 20px;
      z-index: 9999;
      cursor: pointer;
    }
    #chatBubble img {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      box-shadow: 0 0 5px rgba(0,0,0,0.3);
    }

    /* Chat-Fenster-Card (ausgeblendet) */
    #chatWindow {
      position: fixed;
      bottom: 80px;
      right: 20px;
      width: 300px;
      display: none; /* per JS togglen */
      z-index: 9999;
    }
    .app-header {
  background: #fff; /* oder transparent */
  border-bottom: 1px solid #ddd; /* leichte Trennlinie */
}

.app-header .navbar-brand img {
  height: 60px; /* dein Wunsch */
}

.app-header label {
  margin-bottom: 0; /* kein Zeilenumbruch unterm Label */
}

.app-header input[readonly] {
  background: #e9ecef; /* grau hinterlegt, readonly */
}
.app-header {
  padding-left: 2px;
}
  </style>
  <!-- Deine CSRF oder weitere Meta -->
  <meta name="csrf-token" content="{{ csrf_token() }}">
</head>
<body>
<!-- BEGIN #app -->
<!-- Wichtig: 'app-sidebar-minified' sorgt dafür, dass Sidebar standardmäßig eingeklappt ist -->
<div id="header" class="app-header d-flex align-items-center" style="min-height: 60px;">

  <!-- 1) Burger + Logo links (flex-start) -->
  <div class="d-flex align-items-center" style="gap:10px;">
    <!-- Burger -->
    <button type="button"
            class="navbar-desktop-toggler"
            data-toggle="app-sidebar-minify"
            style="border:none;background:none;padding:0;margin:0;">
      <i class="fa fa-bars fa-lg text-dark"></i>
    </button>

    <!-- Logo + Text -->
    <a href="/" class="navbar-brand d-flex align-items-center" style="gap:10px;white-space:nowrap;">
      <img src="/static/img/jpc.jpeg"
           alt="Logo"
           style="height:60px;width:auto;" />
      <!-- Wenn du keinen Text willst, kommentiere die nächste Zeile aus -->
      <span style="font-size:16px;">JPC CALC V2.0</span>
    </a>
  </div>

  <!-- 2) Kosten/CO₂ in der Mitte (mit flex-grow) -->
  <div class="flex-grow-1 d-flex justify-content-center align-items-center" style="gap:20px;">
    <!-- Kosten / 100 -->
    <div>
      <label class="fw-bold me-1">Kosten/100 (€):</label>
      <input type="text"
             id="txtCosts100"
             class="form-control form-control-sm d-inline-block"
             style="width:70px;"
             readonly />
    </div>
    <!-- CO₂ / 100 -->
    <div>
      <label class="fw-bold me-1">CO₂/100 (kg):</label>
      <input type="text"
             id="txtCo2Per100"
             class="form-control form-control-sm d-inline-block"
             style="width:70px;"
             readonly />
    </div>
  </div>

  <!-- 3) Account-Button rechts (flex-end) -->
  <div class="d-flex align-items-center" style="gap:10px; margin-right:20px;">
    <!-- User Info (falls du willst) -->
    <div id="userInfo" style="display:none;">
      <span id="spanUserEmail"></span>
      <button class="btn btn-sm btn-primary" onclick="doLogout()">Logout</button>
    </div>
    <!-- Account-Button -->
    <button class="btn btn-sm btn-info"
            onclick="window.location.href='/account/'">
      Zu meinem Account
    </button>
  </div>

</div>
  <!-- END app-header -->

  <!-- BEGIN app-sidebar (klappbare Sidebar) -->
  <div id="sidebar" class="app-sidebar">
    <!-- Scroll-Wrapper, falls Sidebar sehr lang ist -->
    <div class="app-sidebar-content" data-scrollbar="true" data-height="100%">
      <!-- Deine Sidebar-Nav -->
      <div class="menu">
        <div class="menu-header">Navigation</div>
        <div class="nav">
          <!-- Beispiel: Dashboard-Link -->
          <div class="nav-item">
            <a href="javascript:;" class="nav-link">
              <i class="fa fa-home nav-icon"></i>
              <span class="nav-text">Dashboard</span>
            </a>
          </div>

          <!-- MyCalc (aktuell) -->
          <div class="nav-item">
            <a href="javascript:;" class="nav-link active">
              <i class="fa fa-calculator nav-icon"></i>
              <span class="nav-text">MyCalc</span>
            </a>
          </div>

          <!-- Optional: Weitere Menüpunkte -->
          <div class="nav-item">
            <a href="/account/" class="nav-link">
              <i class="fa fa-user nav-icon"></i>
              <span class="nav-text">Account</span>
            </a>
          </div>

          <!-- Später: Branchenprofile, etc. -->
          <!-- ... -->
        </div>
      </div>
    </div>
    <!-- Sidebar-Hintergrund (wenn eingeklappt) -->
    <button class="app-sidebar-mobile-backdrop" data-dismiss="sidebar"></button>
  </div>
  <!-- END app-sidebar -->

  <!-- BEGIN #content -->
  <!-- Hier hinein packen wir 1:1 den Inhalt (Tabs, etc.) -->
  <div id="content" class="app-content p-3">
    <!-- Container optional, aber wir lassen’s für Ordnung -->
    <div class="container-fluid">
      <!-- Tabs-Navigation -->
      <ul class="nav nav-tabs" id="calcTab" role="tablist">
        <!-- Tab 1 -->
        <li class="nav-item" role="presentation">
          <button
            class="nav-link active"
            id="tab1-tab"
            data-bs-toggle="tab"
            data-bs-target="#tab1"
            type="button"
            role="tab"
            aria-controls="tab1"
            aria-selected="true"
          >
            1) Projektübersicht
          </button>
        </li>
        <!-- Tab 2 -->
        <li class="nav-item" role="presentation">
          <button
            class="nav-link"
            id="tab2-tab"
            data-bs-toggle="tab"
            data-bs-target="#tab2"
            type="button"
            role="tab"
            aria-controls="tab2"
            aria-selected="false"
          >
            2) Material
          </button>
        </li>
        <!-- Tab 3 -->
        <li class="nav-item" role="presentation">
          <button
            class="nav-link"
            id="tab3-tab"
            data-bs-toggle="tab"
            data-bs-target="#tab3"
            type="button"
            role="tab"
            aria-controls="tab3"
            aria-selected="false"
          >
            3) Fertigung
          </button>
        </li>
        <!-- Tab 4 -->
        <li class="nav-item" role="presentation">
          <button
            class="nav-link"
            id="tab4-tab"
            data-bs-toggle="tab"
            data-bs-target="#tab4"
            type="button"
            role="tab"
            aria-controls="tab4"
            aria-selected="false"
          >
            4) Ergebnis
          </button>
        </li>
        <!-- Tab 5 -->
        <li class="nav-item" role="presentation">
          <button
            class="nav-link"
            id="tab5-tab"
            data-bs-toggle="tab"
            data-bs-target="#tab5"
            type="button"
            role="tab"
            aria-controls="tab5"
            aria-selected="false"
          >
            5) Baugruppe
          </button>
        </li>
      </ul>

      <!-- Tabs-Inhalt -->
      <div
        class="tab-content"
        id="myTabContent"
        style="min-height: 300px; margin-top: 1rem;"
      >
        <!-- ====================
             TAB 1: Parametric Tools
             ==================== -->
        <div
          class="tab-pane fade show active p-3"
          id="tab1"
          role="tabpanel"
          aria-labelledby="tab1-tab"
        >
          <h5>Parametric Tools</h5>
          <div class="row mb-2">
            <label for="txtProjectName" class="col-sm-3 col-form-label"
              >Projektname</label
            >
            <div class="col-sm-5">
              <input
                type="text"
                class="form-control"
                id="txtProjectName"
                placeholder="Projekt ABC"
              />
            </div>
          </div>
          <div class="row mb-2">
            <label for="txtPartName" class="col-sm-3 col-form-label"
              >Bauteilname</label
            >
            <div class="col-sm-5">
              <input
                type="text"
                class="form-control"
                id="txtPartName"
                placeholder="Bauteil X"
              />
            </div>
          </div>
          <div class="row mb-2">
            <label for="annualQty" class="col-sm-3 col-form-label"
              >Jahresstückzahl</label
            >
            <div class="col-sm-3">
              <input
                type="number"
                class="form-control"
                id="annualQty"
                value="1000"
              />
            </div>
          </div>
          <div class="row mb-2">
            <label for="lotSize" class="col-sm-3 col-form-label"
              >Losgröße</label
            >
            <div class="col-sm-3">
              <input
                type="number"
                class="form-control"
                id="lotSize"
                value="100"
              />
            </div>
          </div>
          <div class="row mb-2">
            <label for="scrapPct" class="col-sm-3 col-form-label"
              >Globaler Ausschuss (%)</label
            >
            <div class="col-sm-3">
              <input
                type="number"
                step="0.1"
                class="form-control"
                id="scrapPct"
                value="5.0"
              />
            </div>
          </div>
          <div class="row mb-2">
            <label for="sgaPct" class="col-sm-3 col-form-label"
              >SG&A (%)</label
            >
            <div class="col-sm-3">
              <input
                type="number"
                step="0.1"
                class="form-control"
                id="sgaPct"
                value="10.0"
              />
            </div>
          </div>
          <div class="row mb-2">
            <label for="profitPct" class="col-sm-3 col-form-label"
              >Profit (%)</label
            >
            <div class="col-sm-3">
              <input
                type="number"
                step="0.1"
                class="form-control"
                id="profitPct"
                value="5.0"
              />
            </div>
          </div>
          <div class="row mb-2">
            <label for="yearSpin" class="col-sm-3 col-form-label"
              >Kalkulationsjahr</label
            >
            <div class="col-sm-3">
              <input
                type="number"
                class="form-control"
                id="yearSpin"
                value="2024"
              />
            </div>
          </div>
          <div class="row mb-2">
            <label for="zielPrice" class="col-sm-3 col-form-label"
              >Zielpreis / 100 Stk</label
            >
            <div class="col-sm-3">
              <input
                type="number"
                step="0.01"
                class="form-control"
                id="zielPrice"
                value="200.00"
              />
            </div>
          </div>
          <button class="btn btn-primary mt-3" onclick="openParamToolsModal()">
            Parametric Tools
          </button>
        </div>
        <!-- END Tab1 -->

        <!-- ====================
             TAB 2: Material
             ==================== -->
        <div
          class="tab-pane fade p-3"
          id="tab2"
          role="tabpanel"
          aria-labelledby="tab2-tab"
        >
          <h5>Material</h5>
          <button class="btn btn-secondary mb-3" onclick="openMaterialModal()">
            Materialliste laden
          </button>
          <!-- Felder in Tab2 -->
          <div class="mb-2 row">
            <label class="col-sm-3 col-form-label" for="matName"
              >Materialname</label
            >
            <div class="col-sm-4">
              <input
                type="text"
                class="form-control"
                id="matName"
                value="Aluminium"
              />
            </div>
          </div>
          <div class="mb-2 row">
            <label class="col-sm-3 col-form-label" for="matPrice"
              >Materialpreis (€/kg)</label
            >
            <div class="col-sm-3">
              <input
                type="number"
                class="form-control"
                step="0.01"
                id="matPrice"
                value="2.0"
              />
            </div>
          </div>
          <div class="mb-2 row">
            <label class="col-sm-3 col-form-label" for="matCo2"
              >Material-CO₂ (kg/kg)</label
            >
            <div class="col-sm-3">
              <input
                type="number"
                class="form-control"
                step="0.1"
                id="matCo2"
                value="2.0"
              />
            </div>
          </div>
          <div class="mb-2 row">
            <label class="col-sm-3 col-form-label" for="matGK"
              >Material-GK (%)</label
            >
            <div class="col-sm-3">
              <input
                type="number"
                class="form-control"
                step="0.1"
                id="matGK"
                value="5.0"
              />
            </div>
          </div>
          <div class="mb-2 row">
            <label class="col-sm-3 col-form-label" for="matWeight"
              >Bauteilgewicht (kg)</label
            >
            <div class="col-sm-3">
              <input
                type="number"
                class="form-control"
                step="0.01"
                id="matWeight"
                value="0.2"
              />
            </div>
          </div>
          <div class="mb-2 row">
            <label class="col-sm-3 col-form-label" for="fremdValue"
              >Fremdzukauf (€)</label
            >
            <div class="col-sm-3">
              <input
                type="number"
                class="form-control"
                step="0.01"
                id="fremdValue"
                value="0.0"
              />
            </div>
          </div>

          <button class="btn btn-primary mt-3" onclick="calcAll()">Berechnen</button>
        </div>
    <!-- ====================
         TAB 3: Fertigung
         ==================== -->
    <div
      class="tab-pane fade p-3"
      id="tab3"
      role="tabpanel"
      aria-labelledby="tab3-tab"
    >
      <h5>Fertigung</h5>
      <table
        class="table table-sm table-bordered align-middle"
        id="fertTable"
      >
        <thead>
          <tr>
            <th>Arbeitsschritt</th>
            <th>Zyklus (s)</th>
            <th>MS (€/h)</th>
            <th>Lohn (€/h)</th>
            <th>Rüst (€/Los)</th>
            <th>Tooling/100 (€)</th>
            <th>FGK (%)</th>
            <th>CO₂ (kg/h)</th>
            <th>Kosten/100 (€)</th>
            <th>CO₂/100 (kg)</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><input type="text" value="Step 1" /></td>
            <td>
              <input type="number" value="10" />
              <button
                class="btn btn-sm btn-outline-primary mt-1"
                onclick="openZyklusModalWithTakt(0)"
              >
                Zykluszeit...
              </button>
            </td>
            <td><input type="number" value="50" /></td>
            <td>
              <input type="number" value="30" />
              <button
                id="btnLohnListe"
                class="btn btn-secondary mb-3"
                style="display: none;"
                onclick="openLohnModal()"
              >
                Aus Liste...
              </button>
            </td>
            <td><input type="number" value="20" /></td>
            <td><input type="number" value="15" /></td>
            <td><input type="number" value="10" /></td>
            <td><input type="number" value="5" /></td>
            <td><span>0.00</span></td>
            <td><span>0.00</span></td>
          </tr>
          <!-- Dynamische Zeilen per JS -->
        </tbody>
      </table>

      <button class="btn btn-primary mt-3" onclick="calcAll()">Berechnen</button>
    </div>

    <!-- ====================
         TAB 4: Ergebnis
         ==================== -->
    <div
      class="tab-pane fade p-3"
      id="tab4"
      role="tabpanel"
      aria-labelledby="tab4-tab"
    >
      <h5>Ergebnis</h5>
      <div id="sliderContainer" class="text-center p-3 mb-3 border">
        <div class="d-flex justify-content-around" style="gap: 30px;">
          <!-- 1) Material-Slider -->
          <div style="position: relative; width: 330px;">
            <label class="form-label" style="font-size: 0.8em;"
              >Materialpreis ±30%</label
            >
            <input
              type="range"
              min="-30"
              max="30"
              step="1"
              value="0"
              oninput="onSliderMaterialChange(this.value)"
              style="width: 100%;"
            />
          </div>
          <!-- 2) Lohn-Slider -->
          <div style="position: relative; width: 330px;">
            <label class="form-label" style="font-size: 0.8em;"
              >Lohnkosten ±30%</label
            >
            <input
              type="range"
              min="-30"
              max="30"
              step="1"
              value="0"
              oninput="onSliderLaborChange(this.value)"
              style="width: 100%;"
            />
          </div>
          <!-- 3) CO2-Slider -->
          <div style="position: relative; width: 330px;">
            <label class="form-label" style="font-size: 0.8em;"
              >CO₂+/-100% (@380gCO₂/kWh)</label
            >
            <input
              type="range"
              min="-100"
              max="100"
              step="1"
              value="0"
              oninput="onSliderCO2Change(this.value)"
              style="width: 100%;"
            />
          </div>
        </div>
      </div>

      <div class="row mb-3">
        <div class="col-md-6">
          <canvas
            id="costChart"
            width="300"
            height="150"
            style="border: 1px solid #ccc;"
          ></canvas>
        </div>
        <div class="col-md-6">
          <canvas
            id="co2Chart"
            width="300"
            height="150"
            style="border: 1px solid #ccc;"
          ></canvas>
        </div>
      </div>
      <table class="table table-striped table-sm">
        <tbody>
          <tr>
            <td>Material-Einzelkosten/100</td>
            <td id="tdMatEinzel">0.00</td>
          </tr>
          <tr>
            <td>Material-Gemeinkosten/100</td>
            <td id="tdMatGemein">0.00</td>
          </tr>
          <tr>
            <td>Fremdzukauf/100</td>
            <td id="tdFremd">0.00</td>
          </tr>
          <tr>
            <td>Maschinenkosten/100</td>
            <td id="tdMach">0.00</td>
          </tr>
          <tr>
            <td>Lohnkosten/100</td>
            <td id="tdLohn">0.00</td>
          </tr>
          <tr>
            <td>Fertigungsgemeinkosten/100</td>
            <td id="tdFGK">0.00</td>
          </tr>
          <tr>
            <td>Herstellkosten/100</td>
            <td id="tdHerstell">0.00</td>
          </tr>
          <tr>
            <td>SG&A</td>
            <td id="tdSGA">0.00</td>
          </tr>
          <tr>
            <td>Profit</td>
            <td id="tdProfit">0.00</td>
          </tr>
          <!-- <tr>
            <td>CO₂/100</td>
            <td id="tdCo2Total">0.00</td>
          </tr> -->
          <tr>
            <td>Gesamtkosten/100</td>
            <td id="tdTotal">0.00</td>
          </tr>
        </tbody>
      </table>
      <button class="btn btn-primary mt-3" onclick="addResultToBaugruppeFromTab4()">
        In Baugruppe übernehmen
      </button>
    </div>

    <!-- ====================
         TAB 5: Baugruppe
         ==================== -->
    <div
      class="tab-pane fade p-3 d-flex flex-column align-items-start"
      id="tab5"
      role="tabpanel"
      aria-labelledby="tab5-tab"
    >
      <h4>Baugruppenliste</h4>
      <table id="baugruppeTable" class="table table-sm" style="margin-bottom: 10px;">
        <thead>
          <tr>
            <th>Bauteilname</th>
            <th>Verfahren</th>
            <th>MatEinzel</th>
            <th>MatGemein</th>
            <th>Fremd</th>
            <th>Mach</th>
            <th>Lohn</th>
            <th>FGK</th>
            <th>Herstell</th>
            <th>SGA</th>
            <th>Profit</th>
            <th>Total</th>
            <th>CO₂/100</th>
          </tr>
        </thead>
        <tbody>
          <!-- Dynamische Einträge via JS (renderBaugruppeItems) -->
        </tbody>
        <tfoot>
          <tr>
            <th>Summe:</th>
            <td></td> <!-- leer für Verfahren-Spalte -->
            <td id="bgSumMatEinzel"></td>
            <td id="bgSumMatGemein"></td>
            <td id="bgSumFremd"></td>
            <td id="bgSumMach"></td>
            <td id="bgSumLohn"></td>
            <td id="bgSumFGK"></td>
            <td id="bgSumHerstell"></td>
            <td id="bgSumSGA"></td>
            <td id="bgSumProfit"></td>
            <td id="bgSumTotal"></td>
            <td id="bgSumCO2"></td>
          </tr>
        </tfoot>
      </table>
      <div id="baugruppeSumArea" class="d-flex flex-wrap gap-2 align-items-center">
        <button class="btn btn-primary mt-3" onclick="calcBaugruppeSum()">
          Gesamtsumme
        </button>
        <button class="btn btn-primary mt-3" onclick="resetBaugruppenListe()">
          Liste zurücksetzen
        </button>
        <button class="btn btn-primary mt-3" onclick="addManualBaugruppe()">
          Manuell hinzufügen
        </button>
        <button class="btn btn-primary mt-3" onclick="exportBaugruppenAsCSV()">
          Export als CSV
        </button>
      </div>
    </div>
    <!-- Ende von Tab 5 -->

    <!-- Beispiel: KI-Assistent (Beta) -->
    <div class="card mt-3">
      <div class="card-header">
        <h5>KI-Assistent (Beta)</h5>
      </div>
      <div class="card-body">
        <label for="gptQuestion" class="form-label">Deine Frage:</label>
        <input type="text" id="gptQuestion" class="form-control" placeholder="Z.B. Was ist FGK?" />

        <!-- Button, der automatisch GPT-Abfrage macht -->
        <button
          class="btn btn-primary btn-sm mt-2"
          onclick="onAskGPT('gptQuestion', 'gptAnswer')"
        >
          Fragen
        </button>

        <div
          id="gptAnswer"
          class="mt-3 p-2 border bg-light"
          style="min-height:40px; white-space:pre-wrap;"
        >
          <!-- GPT-Antwort erscheint hier -->
        </div>
      </div>
    </div>

<!-- =========================================
     PARAMETRIC TOOLS MODAL (modalParamTools)
     ========================================= -->
<div
  class="modal fade"
  id="modalParamTools"
  tabindex="-1"
  aria-hidden="true"
>
  <div class="modal-dialog modal-lg">
    <div class="modal-content">

      <div class="modal-header">
        <h5 class="modal-title">Parametric Tools</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>

      <div class="modal-body">
        <p>Wähle deinen Prozess:</p>
        <div class="d-flex flex-wrap justify-content-between">
          <!-- Feinguss -->
          <div class="text-center m-2">
            <img
              src="/static/img/feinguss.jpeg"
              alt="Feinguss"
              class="img-choice"
              onclick="openFeingussModal()"
              style="width: 150px; height: auto; cursor: pointer;"
            />
            <p>Feinguss</p>
          </div>
          <!-- Schmieden -->
          <div class="text-center m-2">
            <img
              src="/static/img/schmieden.jpeg"
              alt="Schmieden"
              class="img-choice"
              onclick="openSchmiedenModalSafe()"
              style="width: 150px; height: auto; cursor: pointer;"
            />
            <p>Schmieden</p>
          </div>
          <!-- Kaltfließpressen -->
          <div class="text-center m-2">
            <img
              src="/static/img/kaltfliess.jpeg"
              alt="Kaltfließpressen"
              class="img-choice"
              onclick="openKaltfliessModalSafe()"
              style="width: 150px; height: auto; cursor: pointer;"
            />
            <p>Kaltfließpressen</p>
          </div>
          <!-- PCB-Parametrik -->
          <div class="text-center m-2">
            <img
              src="/static/img/pcb_logo.jpeg"
              alt="PCB-Parametrik"
              class="img-choice"
              onclick="openPcbModalSafe()"
              style="width: 150px; height: auto; cursor: pointer;"
            />
            <p>PCB-Parametrik</p>
          </div>
        </div>
      </div>

      <div class="modal-footer">
        <button
          type="button"
          class="btn btn-secondary"
          data-bs-dismiss="modal"
        >
          Schließen
        </button>
      </div>

    </div> <!-- .modal-content -->
  </div> <!-- .modal-dialog -->
</div> <!-- #modalParamTools -->

<!-- =============== FEINGUSS MODAL (feingussModal) =============== -->
```html
<!-- =================== FEINGUSS-PARAMETRIC V2 (DESIGN-ADAPTIERT) =================== -->
<div class="modal fade" id="feingussModal" tabindex="-1" aria-labelledby="feingussModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-xl" style="max-width:1000px;">
    <div class="modal-content" style="font-size: 0.9rem;">

      <!-- HEADER -->
      <div class="modal-header bg-theme text-white" style="padding: 0.6rem 1rem;">
        <h5 class="modal-title" id="feingussModalLabel">Feinguss-Parametric V2</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Schließen"></button>
      </div>

      <!-- BODY -->
      <div class="modal-body p-2">

        <!-- NAV-TABS (Basis / Erweitert) -->
        <ul class="nav nav-tabs nav-tabs-v2" id="fgTabs" role="tablist" style="margin-bottom: 0.5rem;">
          <li class="nav-item" role="presentation">
            <button
              class="nav-link active"
              id="fg-tab-basis"
              data-bs-toggle="tab"
              data-bs-target="#fgTabBasis"
              type="button"
              role="tab"
              aria-controls="fgTabBasis"
              aria-selected="true"
            >
              Basis
            </button>
          </li>
          <li class="nav-item" role="presentation">
            <button
              class="nav-link"
              id="fg-tab-erweitert"
              data-bs-toggle="tab"
              data-bs-target="#fgTabErweitert"
              type="button"
              role="tab"
              aria-controls="fgTabErweitert"
              aria-selected="false"
            >
              Erweitert
            </button>
          </li>
        </ul>

        <div class="tab-content mt-2" id="fgTabContent">
          <!-- TAB 1: BASIS -->
          <div
            class="tab-pane fade show active"
            id="fgTabBasis"
            role="tabpanel"
            aria-labelledby="fg-tab-basis"
          >
            <div class="row mb-2">
              <div class="col-md-6">
                <label class="form-label fw-bold mb-1">Legierung / Material</label>
                <select id="fgMatSelect" class="form-select form-select-sm">
                  <option value="Stahl">Stahl (Allg.)</option>
                  <option value="Alu">Aluminium</option>
                  <option value="Titan">Titan</option>
                  <option value="NickelAlloy">Nickelbasis-Legierung</option>
                </select>
              </div>
              <div class="col-md-6">
                <label class="form-label fw-bold mb-1">Standort</label>
                <select id="fgLocationSelect" class="form-select form-select-sm">
                  <option value="DE">Deutschland</option>
                  <option value="CN">China</option>
                  <option value="PL">Polen</option>
                </select>
              </div>
            </div>

            <div class="row mb-2">
              <div class="col-md-6">
                <label class="form-label fw-bold mb-1">Gewicht (g)</label>
                <input
                  type="number"
                  id="fgWeight"
                  class="form-control form-control-sm"
                  value="50"
                  step="1"
                />
              </div>
              <div class="col-md-6">
                <label class="form-label fw-bold mb-1">Ausschuss (%)</label>
                <input
                  type="number"
                  id="fgScrapRate"
                  class="form-control form-control-sm"
                  value="5"
                  step="0.1"
                />
              </div>
            </div>

            <div class="row mb-2">
              <div class="col-md-6">
                <label class="form-label fw-bold mb-1">Jahresmenge</label>
                <input
                  type="number"
                  id="fgQuantity"
                  class="form-control form-control-sm"
                  value="1000"
                  step="1"
                />
              </div>
            </div>
          </div><!-- #fgTabBasis -->

          <!-- TAB 2: ERWEITERT -->
          <div
            class="tab-pane fade"
            id="fgTabErweitert"
            role="tabpanel"
            aria-labelledby="fg-tab-erweitert"
          >
            <div class="row mb-2">
              <div class="col-md-6">
                <label class="form-label fw-bold mb-1">Komplexität</label>
                <select id="fgComplexitySelect" class="form-select form-select-sm">
                  <option value="Low">Low</option>
                  <option value="Medium" selected>Medium</option>
                  <option value="High">High</option>
                </select>
              </div>
              <div class="col-md-6">
                <label class="form-label fw-bold mb-1">Rüstzeit (min/Jahr)</label>
                <input
                  type="number"
                  id="fgSetupTimeMin"
                  class="form-control form-control-sm"
                  value="60"
                  step="1"
                />
              </div>
            </div>

            <div class="row mb-2">
              <div class="col-md-6">
                <label class="form-label fw-bold mb-1">Overhead (%)</label>
                <input
                  type="number"
                  id="fgOverheadRate"
                  class="form-control form-control-sm"
                  value="15"
                  step="1"
                />
              </div>
              <div class="col-md-6">
                <label class="form-label fw-bold mb-1">Gewinnrate (%)</label>
                <input
                  type="number"
                  id="fgProfitRate"
                  class="form-control form-control-sm"
                  value="10"
                  step="1"
                />
              </div>
            </div>

            <div class="row mb-2">
              <div class="col-md-6">
                <label class="form-label fw-bold mb-1">Werkzeugkosten (€)</label>
                <input
                  type="number"
                  id="fgToolCost"
                  class="form-control form-control-sm"
                  value="0"
                  step="50"
                />
              </div>
              <div class="col-md-6">
                <label class="form-label fw-bold mb-1">Nachbearb. (min/Teil)</label>
                <input
                  type="number"
                  id="fgPostProcMin"
                  class="form-control form-control-sm"
                  value="0.5"
                  step="0.1"
                />
              </div>
            </div>
          </div><!-- #fgTabErweitert -->
        </div><!-- .tab-content -->

        <hr />

        <!-- Ergebnis + Chart -->
        <div class="row">
          <div class="col-md-6">
            <div class="table-responsive mb-2">
              <table class="table table-sm table-bordered">
                <thead class="table-light">
                  <tr>
                    <th>Parameter/Kostenblock</th>
                    <th>Wert</th>
                  </tr>
                </thead>
                <tbody id="fgTableBody">
                  <!-- 5 Zeilen dynamisch -->
                </tbody>
              </table>
            </div>
          </div>
          <div class="col-md-6 text-center">
            <canvas
              id="fgCostChart"
              width="240"
              height="240"
              style="border:1px solid #ccc;"
            ></canvas>
          </div>
        </div>
      </div><!-- .modal-body -->

      <!-- FOOTER -->
      <div class="modal-footer d-flex justify-content-between align-items-center" style="padding: 0.5rem 1rem;">
        <div>
          <button
            type="button"
            class="btn btn-sm btn-theme me-2"
            id="fgCalcBtn"
            onclick="calculateFeingussParametricV2()"
          >
            <i class="fa fa-calculator me-1"></i> Berechnen
          </button>

          <button
            type="button"
            class="btn btn-sm btn-secondary"
            data-bs-dismiss="modal"
          >
            <i class="fa fa-times me-1"></i> Schließen
          </button>
        </div>
      </div>

    </div><!-- .modal-content -->
  </div><!-- .modal-dialog -->
</div><!-- #feingussModal -->

<!-- ============== SCHMIEDEN-MODAL ============== -->
<!-- =================== SCHMIEDEN-KALKULATOR (PARAMETRIC) - DESIGN-ADAPTIERT =================== -->
<div class="modal fade" id="schmiedenModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-xl" style="max-width:1000px;">
    <!-- Übernimmt Design-Komponenten analog zum Beispiel -->
    <div class="modal-content" style="font-size: 0.9rem; max-height: 85vh; overflow-y: auto;">

      <!-- HEADER (Farbe & Styling übernommen) -->
      <div class="modal-header bg-theme text-white" style="padding: 0.6rem 1rem;">
        <h5 class="modal-title">Schmieden-Kalkulator (Parametric)</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
      </div>

      <!-- BODY (Tabs + Inhalt) -->
      <div class="modal-body p-2">
        <!-- === NAV TABS (Eingaben / Erweitert) - mit nav-tabs-v2 === -->
        <ul class="nav nav-tabs nav-tabs-v2" id="schmiedenTabs" role="tablist" style="margin-bottom: 0.5rem;">
          <li class="nav-item" role="presentation">
            <button
              class="nav-link active"
              id="schmieden-tab-input"
              data-bs-toggle="tab"
              data-bs-target="#schmieden-tabpane-input"
              type="button"
              role="tab"
            >
              Eingaben
            </button>
          </li>
          <li class="nav-item" role="presentation">
            <button
              class="nav-link"
              id="schmieden-tab-adv"
              data-bs-toggle="tab"
              data-bs-target="#schmieden-tabpane-adv"
              type="button"
              role="tab"
            >
              Erweitert
            </button>
          </li>
        </ul>

        <div class="tab-content p-3" id="schmiedenTabsContent">
          <!-- =========== TAB 1: EINGABEN =========== -->
          <div
            class="tab-pane fade show active"
            id="schmieden-tabpane-input"
            role="tabpanel"
          >
            <!-- Material -->
            <div class="row mb-3">
              <label for="schmiedenMaterial" class="col-sm-4 col-form-label">
                Material:
              </label>
              <div class="col-sm-5">
                <select class="form-select form-select-sm" id="schmiedenMaterial">
                  <option>C45 (Stahl)</option>
                  <option>42CrMo4</option>
                  <option>Alu 6082</option>
                </select>
              </div>
            </div>

            <!-- Land (DE / CN) -->
            <div class="row mb-3">
              <label for="schmiedenCountry" class="col-sm-4 col-form-label">
                Land
              </label>
              <div class="col-sm-5">
                <select class="form-select form-select-sm" id="schmiedenCountry">
                  <option>DE</option>
                  <option>CN</option>
                </select>
              </div>
            </div>

            <!-- Teilgewicht (Fertig, in kg) -->
            <div class="row mb-3">
              <label for="schmiedenPartWeight" class="col-sm-4 col-form-label">
                Fertig-Gewicht (kg)
              </label>
              <div class="col-sm-5">
                <input
                  type="number"
                  class="form-control form-control-sm"
                  id="schmiedenPartWeight"
                  step="0.001"
                  value="0.50"
                />
              </div>
            </div>

            <!-- Losgröße -->
            <div class="row mb-3">
              <label for="schmiedenLos" class="col-sm-4 col-form-label">
                Losgröße
              </label>
              <div class="col-sm-5">
                <input
                  type="number"
                  class="form-control form-control-sm"
                  id="schmiedenLos"
                  step="1"
                  value="10000"
                />
              </div>
            </div>
          </div>

          <!-- =========== TAB 2: ERWEITERT =========== -->
          <div
            class="tab-pane fade"
            id="schmieden-tabpane-adv"
            role="tabpanel"
          >
            <!-- Verschnitt (%) -->
            <div class="row mb-3">
              <label for="schmiedenScrapPct" class="col-sm-4 col-form-label">
                Verschnitt (%)
              </label>
              <div class="col-sm-5">
                <input
                  type="number"
                  class="form-control form-control-sm"
                  id="schmiedenScrapPct"
                  step="0.1"
                  value="15"
                />
              </div>
            </div>

            <!-- proj. Querschnitt (cm²) -->
            <div class="row mb-3">
              <label for="schmiedenArea" class="col-sm-4 col-form-label">
                proj. Querschnitt (cm²)
              </label>
              <div class="col-sm-5">
                <input
                  type="number"
                  class="form-control form-control-sm"
                  id="schmiedenArea"
                  step="0.1"
                  value="10.0"
                />
              </div>
            </div>

            <!-- Rüstzeit (min) -->
            <div class="row mb-3">
              <label for="schmiedenRuestMin" class="col-sm-4 col-form-label">
                Rüstzeit (min)
              </label>
              <div class="col-sm-5">
                <input
                  type="number"
                  class="form-control form-control-sm"
                  id="schmiedenRuestMin"
                  step="1"
                  value="60"
                />
              </div>
            </div>
          </div>
        </div><!-- /.tab-content -->

        <!-- ========== ERGEBNISBEREICH (3-spaltig) ========== -->
        <hr />
        <div class="row" id="schmiedenResultRow">
          <!-- TEXT-Result -->
          <div class="col-sm-4" id="schmiedenResultText" style="font-size:0.85rem;">
            <!-- Dynamisch gefüllt via JS -->
          </div>
          <!-- COST Chart -->
          <div class="col-sm-4 text-center">
            <canvas
              id="schmiedenCostChart"
              width="200"
              height="200"
              style="border:1px solid #ccc;"
            ></canvas>
          </div>
          <!-- CO2 Chart -->
          <div class="col-sm-4 text-center">
            <canvas
              id="schmiedenCo2Chart"
              width="200"
              height="200"
              style="border:1px solid #ccc;"
            ></canvas>
          </div>
        </div>
      </div><!-- /.modal-body -->

      <!-- FOOTER (Buttons & Styling analog) -->
      <div class="modal-footer d-flex justify-content-between align-items-center" style="padding: 0.5rem 1rem;">
        <div>
          <button
            type="button"
            class="btn btn-sm btn-theme me-2"
            onclick="calculateSchmieden()"
          >
            <i class="fa fa-calculator me-1"></i> Berechnen
          </button>
          <button
            type="button"
            class="btn btn-sm btn-secondary"
            data-bs-dismiss="modal"
          >
            <i class="fa fa-times me-1"></i> Schließen
          </button>
        </div>
      </div>

    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- #schmiedenModal -->
<!-- End SchmiedenModal -->


<!-- ============== KALTFLIESS-MODAL ============== -->
<!-- =================== KALTFLIESSPRESSEN – PARAMETRIK (DESIGN-ADAPTIERT) =================== -->
<div class="modal fade" id="kaltfliessModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-xl" style="max-width:1000px;">
    <div class="modal-content" style="font-size: 0.9rem; max-height: 85vh; overflow-y: auto;">

      <!-- HEADER (Design analog zu "Maschinenstundensatz") -->
      <div class="modal-header bg-theme text-white" style="padding: 0.6rem 1rem;">
        <h5 class="modal-title">Kaltfließpressen – Parametrik</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
      </div>

      <!-- BODY -->
      <div class="modal-body p-2">
        <!-- NAV-TABS (Eingaben / Erweitert) -->
        <ul class="nav nav-tabs nav-tabs-v2" id="kaltfliessTabs" role="tablist" style="margin-bottom: 0.5rem;">
          <li class="nav-item" role="presentation">
            <button
              class="nav-link active"
              id="kaltfliess-tab-input"
              data-bs-toggle="tab"
              data-bs-target="#kaltfliess-tabpane-input"
              type="button"
              role="tab"
            >
              Eingaben
            </button>
          </li>
          <li class="nav-item" role="presentation">
            <button
              class="nav-link"
              id="kaltfliess-tab-adv"
              data-bs-toggle="tab"
              data-bs-target="#kaltfliess-tabpane-adv"
              type="button"
              role="tab"
            >
              Erweitert
            </button>
          </li>
        </ul>

        <div class="tab-content p-3" id="kaltfliessTabsContent">
          <!-- TAB 1: EINGABEN -->
          <div
            class="tab-pane fade show active"
            id="kaltfliess-tabpane-input"
            role="tabpanel"
          >
            <!-- Material -->
            <div class="row mb-3">
              <label for="kaltfliessMatSelect" class="col-sm-4 col-form-label">
                Material
              </label>
              <div class="col-sm-5">
                <select class="form-select form-select-sm" id="kaltfliessMatSelect">
                  <option>C10 (Stahl)</option>
                  <option>C35 (Stahl)</option>
                  <option>Alu6060</option>
                  <option>Edelstahl304</option>
                </select>
              </div>
            </div>

            <!-- Land -->
            <div class="row mb-3">
              <label for="kaltfliessCountry" class="col-sm-4 col-form-label">
                Land
              </label>
              <div class="col-sm-5">
                <select class="form-select form-select-sm" id="kaltfliessCountry">
                  <option>DE</option>
                  <option>CN</option>
                </select>
              </div>
            </div>

            <!-- Bauteilgewicht (g) -->
            <div class="row mb-3">
              <label for="kaltfliessWeight" class="col-sm-4 col-form-label">
                Bauteilgewicht (g)
              </label>
              <div class="col-sm-5">
                <input
                  type="number"
                  class="form-control form-control-sm"
                  id="kaltfliessWeight"
                  step="0.1"
                  value="50.0"
                />
              </div>
            </div>

            <!-- Losgröße -->
            <div class="row mb-3">
              <label for="kaltfliessLos" class="col-sm-4 col-form-label">
                Losgröße
              </label>
              <div class="col-sm-5">
                <input
                  type="number"
                  class="form-control form-control-sm"
                  id="kaltfliessLos"
                  step="1"
                  value="10000"
                />
              </div>
            </div>
          </div>

          <!-- TAB 2: ERWEITERT -->
          <div
            class="tab-pane fade"
            id="kaltfliess-tabpane-adv"
            role="tabpanel"
          >
            <!-- Umform-Stufen -->
            <div class="row mb-3">
              <label for="kaltfliessStufen" class="col-sm-4 col-form-label">
                Umform-Stufen
              </label>
              <div class="col-sm-5">
                <input
                  type="number"
                  class="form-control form-control-sm"
                  id="kaltfliessStufen"
                  step="1"
                  value="3"
                />
              </div>
            </div>

            <!-- Rüstzeit (min) -->
            <div class="row mb-3">
              <label for="kaltfliessRuestMin" class="col-sm-4 col-form-label">
                Rüstzeit (min)
              </label>
              <div class="col-sm-5">
                <input
                  type="number"
                  class="form-control form-control-sm"
                  id="kaltfliessRuestMin"
                  step="1"
                  value="60"
                />
              </div>
            </div>

            <!-- Komplex => -20% Hub/min -->
            <div class="row mb-3">
              <div class="col-sm-4"></div>
              <div class="col-sm-8">
                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="kaltfliessKomplex"
                  />
                  <label class="form-check-label" for="kaltfliessKomplex">
                    Komplex => -20% Hub/min
                  </label>
                </div>
              </div>
            </div>

            <!-- Automatische Maschinenwahl? -->
            <div class="row mb-3">
              <div class="col-sm-4"></div>
              <div class="col-sm-8">
                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="kaltfliessAutoMach"
                    checked
                  />
                  <label class="form-check-label" for="kaltfliessAutoMach">
                    Maschine automatisch wählen?
                  </label>
                </div>
              </div>
            </div>

            <!-- Manuelle Maschine-Combo -->
            <div class="row mb-3">
              <label for="kaltfliessMachineCombo" class="col-sm-4 col-form-label">
                Manuelle Maschine:
              </label>
              <div class="col-sm-5">
                <select class="form-select form-select-sm" id="kaltfliessMachineCombo" disabled>
                  <option>200 t</option>
                  <option>400 t</option>
                  <option>600 t</option>
                </select>
              </div>
            </div>
          </div><!-- #kaltfliess-tabpane-adv -->
        </div><!-- .tab-content -->

        <!-- =========== ERGEBNISBEREICH (3 Spalten) =========== -->
        <hr />
        <div class="row">
          <div class="col-sm-4" id="kaltfliessResultText" style="font-size:0.85rem;">
            <!-- Dynamisch gefüllt -->
          </div>
          <div class="col-sm-4 text-center">
            <canvas
              id="kaltfliessCostChart"
              width="200"
              height="200"
              style="border:1px solid #ccc;"
            ></canvas>
          </div>
          <div class="col-sm-4 text-center">
            <canvas
              id="kaltfliessCo2Chart"
              width="200"
              height="200"
              style="border:1px solid #ccc;"
            ></canvas>
          </div>
        </div>
      </div><!-- /.modal-body -->

      <!-- FOOTER (Design-Farben & Buttons) -->
      <div class="modal-footer d-flex justify-content-between align-items-center" style="padding: 0.5rem 1rem;">
        <div>
          <button
            type="button"
            class="btn btn-sm btn-theme me-2"
            onclick="calculateKaltfliess()"
          >
            <i class="fa fa-calculator me-1"></i> Berechnen
          </button>
          <button
            type="button"
            class="btn btn-sm btn-secondary"
            data-bs-dismiss="modal"
          >
            <i class="fa fa-times me-1"></i> Schließen
          </button>
        </div>
      </div>

    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- #kaltfliessModal --><!-- End KaltfliessModal -->
<!-- =================== PCB-KALKULATOR (PARAMETRIK) - DESIGN-ADAPTIERT =================== -->
    <div class="modal fade" id="pcbModal" tabindex="-1" aria-hidden="true">
      <div class="modal-dialog modal-xl" style="max-width:1000px;">
        <div class="modal-content" style="font-size: 0.9rem; max-height: 85vh; overflow-y: auto;">

          <!-- HEADER -->
          <div class="modal-header bg-theme text-white" style="padding: 0.6rem 1rem;">
            <h5 class="modal-title">PCB-Kalkulator (Parametrik)</h5>
            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
          </div>

          <!-- BODY: position relative -->
          <div class="modal-body p-2 position-relative">
            <!-- NAV-TABS -->
            <ul class="nav nav-tabs nav-tabs-v2" id="pcbTabs" role="tablist" style="margin-bottom: 0.5rem;">
              <li class="nav-item" role="presentation">
                <button
                  class="nav-link active"
                  id="pcb-tab-input"
                  data-bs-toggle="tab"
                  data-bs-target="#pcb-tabpane-input"
                  type="button"
                  role="tab"
                >
                  Eingaben
                </button>
              </li>
              <li class="nav-item" role="presentation">
                <button
                  class="nav-link"
                  id="pcb-tab-adv"
                  data-bs-toggle="tab"
                  data-bs-target="#pcb-tabpane-adv"
                  type="button"
                  role="tab"
                >
                  Erweitert
                </button>
              </li>
            </ul>

            <div class="tab-content p-3" id="pcbTabContent">
              <!-- TAB 1: EINGABEN -->
              <div
                class="tab-pane fade show active"
                id="pcb-tabpane-input"
                role="tabpanel"
              >
                <!-- L x B (mm) -->
                <div class="row mb-3">
                  <label class="col-sm-4 col-form-label">
                    Abmessung:
                  </label>
                  <div class="col-sm-5 d-flex flex-wrap gap-2">
                    <div class="input-group input-group-sm" style="width: 48%;">
                      <span class="input-group-text">L (mm)</span>
                      <input
                        type="number"
                        class="form-control"
                        id="pcbLen"
                        step="1"
                        value="100"
                      />
                    </div>
                    <div class="input-group input-group-sm" style="width: 48%;">
                      <span class="input-group-text">B (mm)</span>
                      <input
                        type="number"
                        class="form-control"
                        id="pcbWid"
                        step="1"
                        value="80"
                      />
                    </div>
                  </div>
                </div>

                <!-- Lagenzahl -->
                <div class="row mb-3">
                  <label for="pcbLayer" class="col-sm-4 col-form-label">
                    Lagenzahl
                  </label>
                  <div class="col-sm-5">
                    <select class="form-select form-select-sm" id="pcbLayer">
                      <option>2</option>
                      <option>4</option>
                      <option>6</option>
                      <option>8</option>
                    </select>
                  </div>
                </div>

                <!-- Stückzahl -->
                <div class="row mb-3">
                  <label for="pcbQty" class="col-sm-4 col-form-label">
                    Stückzahl
                  </label>
                  <div class="col-sm-5">
                    <input
                      type="number"
                      class="form-control form-control-sm"
                      id="pcbQty"
                      step="1"
                      value="1000"
                    />
                  </div>
                </div>

                <!-- Land -->
                <div class="row mb-3">
                  <label for="pcbLand" class="col-sm-4 col-form-label">
                    Land (Fertigung)
                  </label>
                  <div class="col-sm-5">
                    <select class="form-select form-select-sm" id="pcbLand">
                      <option>China</option>
                      <option>Europa</option>
                      <option>Sonst</option>
                    </select>
                  </div>
                </div>
              </div>

              <!-- TAB 2: ERWEITERT -->
              <div
                class="tab-pane fade"
                id="pcb-tabpane-adv"
                role="tabpanel"
              >
                <!-- Dicke -->
                <div class="row mb-3">
                  <label for="pcbThick" class="col-sm-4 col-form-label">
                    PCB-Dicke (mm)
                  </label>
                  <div class="col-sm-5">
                    <input
                      type="number"
                      class="form-control form-control-sm"
                      id="pcbThick"
                      step="0.01"
                      value="1.6"
                    />
                  </div>
                </div>

                <!-- Kupferdicke -->
                <div class="row mb-3">
                  <label for="pcbCu" class="col-sm-4 col-form-label">
                    Kupferdicke
                  </label>
                  <div class="col-sm-5">
                    <select class="form-select form-select-sm" id="pcbCu">
                      <option>35µm</option>
                      <option>70µm</option>
                    </select>
                  </div>
                </div>

                <!-- Finish -->
                <div class="row mb-3">
                  <label for="pcbFinish" class="col-sm-4 col-form-label">
                    Oberfläche (Finish)
                  </label>
                  <div class="col-sm-5">
                    <select class="form-select form-select-sm" id="pcbFinish">
                      <option>HASL</option>
                      <option>ENIG</option>
                      <option>OSP</option>
                    </select>
                  </div>
                </div>

                <!-- Tooling-Kosten -->
                <div class="row mb-3">
                  <label for="pcbTooling" class="col-sm-4 col-form-label">
                    Tooling-Kosten (€)
                  </label>
                  <div class="col-sm-5">
                    <input
                      type="number"
                      class="form-control form-control-sm"
                      id="pcbTooling"
                      step="1"
                      value="200"
                    />
                  </div>
                </div>

                <!-- CheckBox: "Einfache Bestückung?" -->
                <div class="row mb-3">
                  <div class="col-sm-4"></div>
                  <div class="col-sm-8">
                    <div class="form-check">
                      <input
                        class="form-check-input"
                        type="checkbox"
                        id="pcbAssemblyCheck"
                      />
                      <label
                        class="form-check-label"
                        for="pcbAssemblyCheck"
                      >
                        Einfache Bestückung berücksichtigen?
                      </label>
                    </div>
                  </div>
                </div>

                <!-- SMD / THT Felder -->
                <div class="row mb-3">
                  <label for="pcbSmdCount" class="col-sm-4 col-form-label">
                    SMD-Bauteile (Anzahl)
                  </label>
                  <div class="col-sm-5">
                    <input
                      type="number"
                      class="form-control form-control-sm"
                      id="pcbSmdCount"
                      step="1"
                      value="50"
                    />
                  </div>
                </div>

                <div class="row mb-3">
                  <label for="pcbThtCount" class="col-sm-4 col-form-label">
                    THT-Pins (Anzahl)
                  </label>
                  <div class="col-sm-5">
                    <input
                      type="number"
                      class="form-control form-control-sm"
                      id="pcbThtCount"
                      step="1"
                      value="10"
                    />
                  </div>
                </div>
              </div>
            </div><!-- .tab-content -->

            <!-- Ergebnis-Bereich -->
            <hr />
            <div class="row">
              <div class="col-sm-4" id="pcbResultText" style="font-size:0.85rem;">
                <!-- Dynamisch gefüllt -->
              </div>
              <div class="col-sm-4 text-center">
                <canvas
                  id="pcbCostChart"
                  width="200"
                  height="200"
                  style="border:1px solid #ccc;"
                ></canvas>
              </div>
              <div class="col-sm-4 text-center">
                <canvas
                  id="pcbCo2Chart"
                  width="200"
                  height="200"
                  style="border:1px solid #ccc;"
                ></canvas>
              </div>
            </div>

            <!-- Chat-Bubble + Chat-Fenster im Modal (Beispiel) -->
            <div id="pcbChatBubble">
              <img src="https://cdn-icons-png.flaticon.com/512/2990/2990675.png"
                   alt="Chat"
                   onclick="togglePcbChatWindow()"/>
            </div>
            <div id="pcbChatWindow">
              <div class="header">KI-Assistent</div>
              <div class="body">
                <p>Hallo, wie kann ich helfen?</p>
              </div>
              <div class="footer">
                <button class="btn btn-sm btn-secondary" onclick="togglePcbChatWindow()">Schließen</button>
              </div>
            </div>

          </div><!-- .modal-body -->

          <!-- FOOTER -->
          <div class="modal-footer d-flex justify-content-between align-items-center" style="padding: 0.5rem 1rem;">
            <div>
              <button
                type="button"
                class="btn btn-sm btn-theme me-2"
                onclick="calculatePcb()"
              >
                <i class="fa fa-calculator me-1"></i> Berechnen
              </button>
              <button
                type="button"
                class="btn btn-sm btn-secondary"
                data-bs-dismiss="modal"
              >
                <i class="fa fa-times me-1"></i> Schließen
              </button>
            </div>
          </div>

        </div><!-- /.modal-content -->
      </div><!-- /.modal-dialog -->
    </div><!-- #pcbModal --><!-- ================= SPRITZGUSS-MODAL ================= -->
<!-- =================== SPRITZGUSS – TAKTZEITRECHNER (DESIGN-ADAPTIERT) =================== -->
<div class="modal fade" id="modalSpritzguss" tabindex="-1" aria-labelledby="spritzgussModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-xl modal-sg" style="max-width:1000px;">
    <div class="modal-content" style="font-size: 0.9rem; max-height: 85vh; overflow-y: auto;">

      <!-- HEADER (Design analog) -->
      <div class="modal-header bg-theme text-white" style="padding: 0.6rem 1rem;">
        <h5 class="modal-title" id="spritzgussModalLabel">
          Spritzguss – Taktzeitrechner
        </h5>
        <button
          type="button"
          class="btn-close btn-close-white"
          data-bs-dismiss="modal"
          aria-label="Schließen"
        ></button>
      </div>

      <!-- BODY -->
      <div class="modal-body p-2">

        <!-- TABS (Basis / Erweitert / Profile) -->
        <ul class="nav nav-tabs nav-tabs-v2" id="sgTabs" role="tablist" style="margin-bottom: 0.5rem;">
          <li class="nav-item" role="presentation">
            <button
              class="nav-link active"
              id="sg-basic-tab"
              data-bs-toggle="tab"
              data-bs-target="#sgTabBasic"
              type="button"
              role="tab"
              aria-controls="sgTabBasic"
              aria-selected="true"
            >
              Basis
            </button>
          </li>
          <li class="nav-item" role="presentation">
            <button
              class="nav-link"
              id="sg-adv-tab"
              data-bs-toggle="tab"
              data-bs-target="#sgTabAdvanced"
              type="button"
              role="tab"
              aria-controls="sgTabAdvanced"
              aria-selected="false"
            >
              Erweitert
            </button>
          </li>
          <li class="nav-item" role="presentation">
            <button
              class="nav-link"
              id="sg-profile-tab"
              data-bs-toggle="tab"
              data-bs-target="#sgTabProfile"
              type="button"
              role="tab"
              aria-controls="sgTabProfile"
              aria-selected="false"
            >
              Profile
            </button>
          </li>
        </ul>

        <!-- TAB-CONTENT -->
        <div class="tab-content mt-2" id="sgTabContent">
          <!-- TAB 1: BASIS -->
          <div
            class="tab-pane fade show active"
            id="sgTabBasic"
            role="tabpanel"
            aria-labelledby="sg-basic-tab"
          >
            <div class="row mb-2">
              <div class="col-md-6">
                <label class="form-label fw-bold mb-1">Material</label>
                <select id="sgMaterialSelect" class="form-select form-select-sm">
                  <option value="PP">PP</option>
                  <option value="ABS">ABS</option>
                  <option value="PA6GF30">PA6GF30</option>
                  <option value="PC">PC</option>
                  <option value="POM">POM</option>
                  <option value="TPE">TPE</option>
                  <option value="PBT">PBT</option>
                </select>
              </div>
              <div class="col-md-6">
                <label class="form-label fw-bold mb-1">Kavitäten</label>
                <input
                  type="number"
                  class="form-control form-control-sm"
                  id="sgCavities"
                  value="4"
                  min="1"
                  max="64"
                />
              </div>
            </div>

            <div class="row mb-2">
              <div class="col-md-6">
                <label class="form-label fw-bold mb-1">Bauteilgewicht (g)</label>
                <input
                  type="number"
                  class="form-control form-control-sm"
                  id="sgPartWeight"
                  value="50"
                />
              </div>
              <div class="col-md-6">
                <label class="form-label fw-bold mb-1">Anguss (g)</label>
                <div class="d-flex">
                  <input
                    type="number"
                    class="form-control form-control-sm"
                    id="sgRunnerWeight"
                    value="10"
                    style="max-width:60%;"
                  />
                  <div class="form-check ms-2">
                    <input
                      class="form-check-input"
                      type="checkbox"
                      id="sgRunnerAutoChk"
                    />
                    <label
                      class="form-check-label"
                      for="sgRunnerAutoChk"
                      style="font-size:0.85rem;"
                    >
                      auto?
                    </label>
                  </div>
                </div>
              </div>
            </div>

            <div class="row mb-2">
              <div class="col-md-6">
                <label class="form-label fw-bold mb-1">
                  Abmessungen (L×B, mm)
                </label>
                <div class="input-group input-group-sm">
                  <input
                    type="number"
                    class="form-control"
                    id="sgLength"
                    value="100"
                  />
                  <span class="input-group-text">×</span>
                  <input
                    type="number"
                    class="form-control"
                    id="sgWidth"
                    value="80"
                  />
                </div>
              </div>
              <div class="col-md-6">
                <label class="form-label fw-bold mb-1">Wandstärke (mm)</label>
                <input
                  type="number"
                  class="form-control form-control-sm"
                  id="sgWallThickness"
                  value="2.0"
                  min="0.3"
                  max="8.0"
                  step="0.1"
                />
              </div>
            </div>
          </div><!-- END TAB BASIC -->

          <!-- TAB 2: ERWEITERT => Accordion -->
          <div
            class="tab-pane fade"
            id="sgTabAdvanced"
            role="tabpanel"
            aria-labelledby="sg-adv-tab"
          >
            <div class="accordion" id="sgAccordionAdvanced">
              <!-- ACCORDION-EINTRAG 1: MASCHINE -->
              <div class="accordion-item">
                <h2 class="accordion-header" id="sgAdvHeadOne">
                  <button
                    class="accordion-button collapsed"
                    type="button"
                    data-bs-toggle="collapse"
                    data-bs-target="#sgAdvCollapseOne"
                    aria-expanded="false"
                    aria-controls="sgAdvCollapseOne"
                  >
                    Maschinen-Parameter
                  </button>
                </h2>
                <div
                  id="sgAdvCollapseOne"
                  class="accordion-collapse collapse"
                  aria-labelledby="sgAdvHeadOne"
                  data-bs-parent="#sgAccordionAdvanced"
                >
                  <div class="accordion-body">
                    <div class="row mb-2">
                      <div class="col-md-6">
                        <label class="form-label fw-bold mb-1">
                          Maschine (manuell)
                        </label>
                        <select
                          id="sgMachineCombo"
                          class="form-select form-select-sm"
                        >
                          <option value="80t HighSpeed">80t HighSpeed</option>
                          <option value="100t Standard">100t Standard</option>
                          <option value="120t AllElectric">120t AllElectric</option>
                          <option value="150t Automotive">150t Automotive</option>
                          <option value="200t Standard">200t Standard</option>
                          <option value="250t Standard">250t Standard</option>
                          <option value="350t Automotive">350t Automotive</option>
                          <option value="400t Standard">400t Standard</option>
                        </select>
                        <div class="form-check mt-1">
                          <input
                            class="form-check-input"
                            type="checkbox"
                            id="sgMachineAutoChk"
                          />
                          <label
                            class="form-check-label"
                            for="sgMachineAutoChk"
                            style="font-size:0.85rem;"
                          >
                            Maschine automatisch?
                          </label>
                        </div>
                      </div>
                      <div class="col-md-6">
                        <label class="form-label fw-bold mb-1">
                          Formen-Innendruck (bar)
                        </label>
                        <select
                          id="sgPressureSelect"
                          class="form-select form-select-sm"
                        >
                          <option value="300">300</option>
                          <option value="600">600</option>
                          <option value="800">800</option>
                        </select>
                        <label class="form-label fw-bold mb-1 mt-2">
                          Sicherheitszuschlag (%)
                        </label>
                        <input
                          type="number"
                          class="form-control form-control-sm"
                          id="sgSafetyFactor"
                          value="30"
                        />
                      </div>
                    </div>
                  </div><!-- .accordion-body -->
                </div><!-- #sgAdvCollapseOne -->
              </div><!-- .accordion-item -->

              <!-- ACCORDION-EINTRAG 2: ZUSÄTZLICHE OPTIONEN -->
              <div class="accordion-item">
                <h2 class="accordion-header" id="sgAdvHeadTwo">
                  <button
                    class="accordion-button collapsed"
                    type="button"
                    data-bs-toggle="collapse"
                    data-bs-target="#sgAdvCollapseTwo"
                    aria-expanded="false"
                    aria-controls="sgAdvCollapseTwo"
                  >
                    Zusätzliche Optionen
                  </button>
                </h2>
                <div
                  id="sgAdvCollapseTwo"
                  class="accordion-collapse collapse"
                  aria-labelledby="sgAdvHeadTwo"
                  data-bs-parent="#sgAccordionAdvanced"
                >
                  <div class="accordion-body">
                    <div class="form-check mb-1">
                      <input
                        class="form-check-input"
                        type="checkbox"
                        id="sgAutomotiveChk"
                      />
                      <label class="form-check-label" for="sgAutomotiveChk">
                        Automotive? (+20% Schließkraft)
                      </label>
                    </div>
                    <div class="form-check mb-1">
                      <input
                        class="form-check-input"
                        type="checkbox"
                        id="sgRobotChk"
                      />
                      <label class="form-check-label" for="sgRobotChk">
                        Roboter? (+2s)
                      </label>
                    </div>
                    <div class="form-check mb-1">
                      <input
                        class="form-check-input"
                        type="checkbox"
                        id="sgSliderChk"
                      />
                      <label class="form-check-label" for="sgSliderChk">
                        Schieber? (+1.5s)
                      </label>
                    </div>
                    <label class="form-label fw-bold mb-1 mt-2">
                      Nachdruck/Haltedruck (s)
                    </label>
                    <input
                      type="number"
                      class="form-control form-control-sm"
                      id="sgHoldPressure"
                      value="2.0"
                    />
                    <label class="form-label fw-bold mb-1 mt-2">
                      Min. Kühlzeit (s)
                    </label>
                    <input
                      type="number"
                      class="form-control form-control-sm"
                      id="sgMinCool"
                      value="1.5"
                    />
                    <div class="form-check mb-1">
                      <input
                        class="form-check-input"
                        type="checkbox"
                        id="sgContourCoolChk"
                      />
                      <label class="form-check-label" for="sgContourCoolChk">
                        Konturnahe Kühlung (-20% Kühlzeit)
                      </label>
                    </div>
                  </div><!-- .accordion-body -->
                </div><!-- #sgAdvCollapseTwo -->
              </div><!-- .accordion-item -->
            </div><!-- .accordion -->
          </div><!-- END TAB ERWEITERT -->

          <!-- TAB 3: PROFILE -->
          <div
            class="tab-pane fade"
            id="sgTabProfile"
            role="tabpanel"
            aria-labelledby="sg-profile-tab"
          >
            <div class="mt-2">
              <h6>Wähle ein Prozess-Profil:</h6>
              <div class="d-flex flex-wrap gap-2">
                <button
                  type="button"
                  class="btn btn-outline-primary btn-sm"
                  onclick="loadProfile('standard')"
                >
                  Standard-Profil
                </button>
                <button
                  type="button"
                  class="btn btn-outline-success btn-sm"
                  onclick="loadProfile('packaging')"
                >
                  Verpackungs-Profil
                </button>
                <button
                  type="button"
                  class="btn btn-outline-danger btn-sm"
                  onclick="loadProfile('automotive')"
                >
                  Automotive-Profil
                </button>
              </div>
              <div
                id="sgProfileChanges"
                class="mt-3 p-2 border border-info"
                style="white-space: pre-wrap; font-size:0.9rem;"
              >
                Noch kein Profil geladen.
              </div>
            </div>
          </div><!-- END TAB PROFILE -->

        </div><!-- END of TAB-CONTENT -->

        <hr />
        <!-- ERGEBNISSE -->
        <h6>Ergebnisse</h6>
        <div class="row">
          <div class="col-md-6">
            <div class="mb-1">
              Schließkraft (t):
              <span id="sgClosureForce" class="fw-bold">--</span>
            </div>
            <div class="mb-1">
              Gewählte Maschine:
              <span id="sgChosenMachine" class="fw-bold">--</span>
            </div>
            <div class="mb-1">
              Zyklus/Schuss (s):
              <span id="sgCycleShot" class="fw-bold">--</span>
            </div>
            <div class="mb-1">
              Zyklus/Teil (s):
              <span id="sgCyclePart" class="fw-bold">--</span>
            </div>

            <div
              id="sgMachineExplain"
              class="text-muted"
              style="font-size:0.85rem;"
            >
              <!-- Dynamisch vom JS ausgefüllt -->
            </div>

            <!-- Versteckte Felder für Durchsatz / Kosten (bei Bedarf genutzt) -->
            <div style="display:none;">
              Teile/h:
              <span id="sgThroughput">--</span>
            </div>
            <div style="display:none;">
              Kosten/Teil:
              <span id="sgCostEach">--</span>
            </div>
          </div>
          <div class="col-md-6">
            <canvas
              id="sgCycleChart"
              width="240"
              height="240"
              style="border:1px solid #ccc;"
            ></canvas>
          </div>
        </div>

      </div><!-- END modal-body -->

      <!-- FOOTER -->
      <div class="modal-footer d-flex justify-content-between align-items-center" style="padding: 0.5rem 1rem;">
        <div>
          <!-- Reihenfolge wie im Original, nur Design & Icons ergänzt -->
          <button
            type="button"
            class="btn btn-sm btn-secondary me-2"
            data-bs-dismiss="modal"
          >
            <i class="fa fa-times me-1"></i> Schließen
          </button>
          <button
            type="button"
            class="btn btn-sm btn-theme me-2"
            onclick="calculateSpritzguss()"
          >
            <i class="fa fa-calculator me-1"></i> Berechnen
          </button>
          <button
            type="button"
            class="btn btn-sm btn-success"
            id="btnSpritzgussUebernehmen"
          >
            <i class="fa fa-check me-1"></i> Übernehmen
          </button>
        </div>
      </div>

    </div><!-- .modal-content -->
  </div><!-- .modal-dialog -->
</div><!-- #modalSpritzguss -->
        <!-- DRUCKGUSS-MODAL (Fancy v2.0) -->
<!-- =================== DRUCKGUSS – TAKTZEITRECHNER (DESIGN-ADAPTIERT) =================== -->
<div class="modal fade" id="modalDruckguss" tabindex="-1" aria-labelledby="druckgussModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-xl modal-dg" style="max-width:1000px;">
    <div class="modal-content" style="font-size: 0.9rem; max-height: 85vh; overflow-y: auto;">

      <!-- HEADER (Design analog) -->
      <div class="modal-header bg-theme text-white" style="padding: 0.6rem 1rem;">
        <h5 class="modal-title" id="druckgussModalLabel">Druckguss – Taktzeitrechner</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
      </div>

      <!-- BODY -->
      <div class="modal-body p-2">
        <!-- TABS (Basis / Erweitert) -->
        <ul class="nav nav-tabs nav-tabs-v2" id="dgTabs" role="tablist" style="margin-bottom: 0.5rem;">
          <li class="nav-item" role="presentation">
            <button
              class="nav-link active"
              id="dg-basic-tab"
              data-bs-toggle="tab"
              data-bs-target="#dgTabBasic"
              type="button"
              role="tab"
              aria-selected="true"
            >
              Basis
            </button>
          </li>
          <li class="nav-item" role="presentation">
            <button
              class="nav-link"
              id="dg-adv-tab"
              data-bs-toggle="tab"
              data-bs-target="#dgTabAdvanced"
              type="button"
              role="tab"
              aria-selected="false"
            >
              Erweitert
            </button>
          </li>
        </ul>

        <div class="tab-content mt-2" id="dgTabContent">
          <!-- TAB 1: BASIS -->
          <div
            class="tab-pane fade show active"
            id="dgTabBasic"
            role="tabpanel"
          >
            <div class="row mb-2">
              <div class="col-md-6">
                <label class="form-label fw-bold mb-1">Legierung</label>
                <select id="dgMaterialSelect" class="form-select form-select-sm">
                  <option value="AlSi9Cu3">AlSi9Cu3</option>
                  <option value="AZ91D">AZ91D</option>
                  <option value="Zamak5">Zamak5</option>
                </select>
              </div>
              <div class="col-md-6">
                <label class="form-label fw-bold mb-1">Teilegewicht (g)</label>
                <input
                  type="number"
                  class="form-control form-control-sm"
                  id="dgPartWeight"
                  value="500"
                />
              </div>
            </div>

            <div class="row mb-2">
              <div class="col-md-6">
                <label class="form-label fw-bold mb-1">proj. Fläche (cm²)</label>
                <input
                  type="number"
                  class="form-control form-control-sm"
                  id="dgAreaCm2"
                  value="80"
                />
              </div>
              <div class="col-md-6">
                <label class="form-label fw-bold mb-1">Kavitäten</label>
                <input
                  type="number"
                  class="form-control form-control-sm"
                  id="dgCavities"
                  value="1"
                />
              </div>
            </div>

            <div class="row mb-2">
              <div class="col-md-6">
                <div class="form-check mb-1">
                  <input class="form-check-input" type="checkbox" id="dgDickwandChk" />
                  <label class="form-check-label" for="dgDickwandChk">
                    Dickwand? (+15% Kraft, ggf. +2x Kühlzeit)
                  </label>
                </div>
                <div class="form-check mb-1">
                  <input class="form-check-input" type="checkbox" id="dgEntgratenChk" />
                  <label class="form-check-label" for="dgEntgratenChk">
                    Entgraten (+2s)
                  </label>
                </div>
              </div>
              <div class="col-md-6">
                <label class="form-label fw-bold mb-1">Overflow (%)</label>
                <input
                  type="number"
                  class="form-control form-control-sm"
                  id="dgOverflowPct"
                  value="50"
                />
              </div>
            </div>
          </div><!-- END TAB BASIC -->

          <!-- TAB 2: ERWEITERT -->
          <div
            class="tab-pane fade"
            id="dgTabAdvanced"
            role="tabpanel"
          >
            <div class="row mb-2">
              <div class="col-md-6">
                <div class="form-check mb-1">
                  <input class="form-check-input" type="checkbox" id="dgAutoMachineChk" checked />
                  <label class="form-check-label" for="dgAutoMachineChk">
                    Maschine automatisch wählen?
                  </label>
                </div>
                <label class="form-label fw-bold mb-1">Manuelle Maschine</label>
                <select
                  id="dgMachineSelect"
                  class="form-select form-select-sm"
                  disabled
                >
                  <option value="200t">200 t</option>
                  <option value="400t">400 t</option>
                  <option value="800t">800 t</option>
                </select>

                <div class="form-check mb-1 mt-2">
                  <input class="form-check-input" type="checkbox" id="dgAbgeschrChk" />
                  <label class="form-check-label" for="dgAbgeschrChk">
                    Abgeschrieben? (-20% Rate)
                  </label>
                </div>
              </div>
              <div class="col-md-6">
                <label class="form-label fw-bold mb-1">Sicherheitsfaktor</label>
                <input
                  type="number"
                  class="form-control form-control-sm"
                  id="dgSafetyFactor"
                  value="2.0"
                />
                <div class="form-check mb-1 mt-2">
                  <input class="form-check-input" type="checkbox" id="dgSqueezeChk" />
                  <label class="form-check-label" for="dgSqueezeChk">
                    Squeeze Casting (+20% Kraft, +3s Nachdruck)
                  </label>
                </div>
              </div>
            </div>

            <div class="row mb-2">
              <div class="col-md-6">
                <label class="form-label fw-bold mb-1">Wandstärke (mm)</label>
                <input
                  type="number"
                  class="form-control form-control-sm"
                  id="dgWallThickness"
                  value="6.0"
                />
                <label class="form-label fw-bold mb-1 mt-2">Sprühzeit (s)</label>
                <input
                  type="number"
                  class="form-control form-control-sm"
                  id="dgSprayTime"
                  value="5.0"
                />
              </div>
              <div class="col-md-6">
                <label class="form-label fw-bold mb-1">Nachdruck (s)</label>
                <input
                  type="number"
                  class="form-control form-control-sm"
                  id="dgHoldTime"
                  value="5.0"
                />
                <label class="form-label fw-bold mb-1 mt-2">Automation-Level</label>
                <select id="dgAutomationSelect" class="form-select form-select-sm">
                  <option value="Manuell">Manuell</option>
                  <option value="Halbauto">Halbauto</option>
                  <option value="Vollauto">Vollauto</option>
                </select>
              </div>
            </div>

            <div class="row mb-2">
              <div class="col-md-6">
                <label class="form-label fw-bold mb-1">Auslastung (%)</label>
                <input
                  type="number"
                  class="form-control form-control-sm"
                  id="dgUtilPct"
                  value="85"
                />
              </div>
            </div>
          </div><!-- END TAB ADVANCED -->
        </div><!-- END .tab-content -->

        <hr/>
        <!-- ERGEBNISSE -->
        <div id="dgResultsArea" class="mt-2">
          <h6>Ergebnisse</h6>
          <div class="row">
            <div class="col-md-6">
              <div>Schließkraft (t): <span id="dgClosureForce" class="fw-bold">--</span></div>
              <div>Gewählte Maschine: <span id="dgChosenMachine" class="fw-bold">--</span></div>
              <div>Zyklus/Schuss (s): <span id="dgCycleShot" class="fw-bold">--</span></div>
              <div>Zyklus/Teil (s): <span id="dgCyclePart" class="fw-bold">--</span></div>
              <div>Teile/h (real): <span id="dgThroughput" class="fw-bold">--</span></div>
              <div>Kosten/Teil: <span id="dgCostEach" class="fw-bold">--</span></div>
              <div>CO₂/Teil: <span id="dgCo2Each" class="fw-bold">--</span></div>
            </div>
            <div class="col-md-6">
              <canvas
                id="dgCycleChart"
                width="240"
                height="240"
                style="border:1px solid #ccc;"
              ></canvas>
            </div>
          </div>
        </div>
      </div><!-- END modal-body -->

      <!-- FOOTER-BUTTONS (Design analog) -->
      <div class="modal-footer d-flex justify-content-between align-items-center" style="padding: 0.5rem 1rem;">
        <div>
          <button
            type="button"
            class="btn btn-sm btn-secondary me-2"
            data-bs-dismiss="modal"
          >
            <i class="fa fa-times me-1"></i> Schließen
          </button>
          <button
            type="button"
            class="btn btn-sm btn-theme me-2"
            onclick="calculateDruckguss()"
          >
            <i class="fa fa-calculator me-1"></i> Berechnen
          </button>
          <button
            type="button"
            class="btn btn-sm btn-success"
            id="btnDruckgussUebernehmen"
          >
            <i class="fa fa-check me-1"></i> Übernehmen
          </button>
        </div>
      </div>
    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- #modalDruckguss -->
<!-- ================================================
     (10-15 Zeilen VORLAUF, z. B. andere Modals)
     ================================================ -->

<!-- =================== MILLING-MODAL =================== -->

<!-- =================== FRÄS-/ZERSPANUNGS-RECHNER (DESIGN-ADAPTIERT) =================== -->
<div class="modal fade" id="modalMilling" tabindex="-1" aria-labelledby="millingModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-xl modal-milling" style="max-width:1000px;">
    <div class="modal-content" style="font-size: 0.9rem; max-height: 85vh; overflow-y: auto;">

      <!-- HEADER (Design analog) -->
      <div class="modal-header bg-theme text-white" style="padding: 0.6rem 1rem;">
        <h5 class="modal-title" id="millingModalLabel">Fräs-/Zerspanungs-Rechner</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
      </div>

      <!-- BODY -->
      <div class="modal-body p-2">
        <!-- Tabs (Basis / Erweitert) -->
        <ul class="nav nav-tabs nav-tabs-v2" id="millTabs" role="tablist" style="margin-bottom: 0.5rem;">
          <li class="nav-item" role="presentation">
            <button
              class="nav-link active"
              id="mill-basic-tab"
              data-bs-toggle="tab"
              data-bs-target="#millTabBasic"
              type="button"
              role="tab"
            >
              Basis
            </button>
          </li>
          <li class="nav-item" role="presentation">
            <button
              class="nav-link"
              id="mill-adv-tab"
              data-bs-toggle="tab"
              data-bs-target="#millTabAdvanced"
              type="button"
              role="tab"
            >
              Erweitert
            </button>
          </li>
        </ul>

        <div class="tab-content mt-2" id="millTabContent">
          <!-- TAB 1: BASIS -->
          <div
            class="tab-pane fade show active"
            id="millTabBasic"
            role="tabpanel"
          >
            <div class="row mb-2">
              <div class="col-md-6">
                <label class="form-label fw-bold mb-1">Werkstoff</label>
                <select id="millMatSelect" class="form-select form-select-sm">
                  <option value="Stahl S235">Stahl S235</option>
                  <option value="Alu ENAW6060">Alu ENAW6060</option>
                  <option value="GG25 Guss">GG25 Guss</option>
                </select>
              </div>
              <div class="col-md-6">
                <div class="form-check mt-2">
                  <input class="form-check-input" type="checkbox" id="millAutoMachChk" checked />
                  <label class="form-check-label" for="millAutoMachChk">
                    Maschine automatisch wählen?
                  </label>
                </div>
              </div>
            </div>

            <div class="row mb-2">
              <label class="form-label fw-bold mb-1">Manuelle Maschine:</label>
              <select
                id="millMachineSelect"
                class="form-select form-select-sm ms-2"
                style="max-width:60%;"
                disabled
              >
                <option value="3-Achs Standard">3-Achs Standard</option>
                <option value="5-Achs Standard">5-Achs Standard</option>
                <option value="5-Achs HighEnd">5-Achs HighEnd</option>
              </select>
            </div>

            <div class="row">
              <div class="col-md-4 mb-2">
                <label class="form-label">Länge (mm)</label>
                <input
                  type="number"
                  class="form-control form-control-sm"
                  id="millLenMm"
                  value="100"
                />
              </div>
              <div class="col-md-4 mb-2">
                <label class="form-label">Breite (mm)</label>
                <input
                  type="number"
                  class="form-control form-control-sm"
                  id="millWidMm"
                  value="80"
                />
              </div>
              <div class="col-md-4 mb-2">
                <label class="form-label">Höhe (mm)</label>
                <input
                  type="number"
                  class="form-control form-control-sm"
                  id="millHeiMm"
                  value="30"
                />
              </div>
            </div>

            <div class="mb-2">
              <label class="form-label fw-bold mb-1">End-Höhe (mm)</label>
              <input
                type="number"
                class="form-control form-control-sm"
                id="millFinishHeight"
                value="28"
              />
            </div>
          </div><!-- END TAB BASIC -->

          <!-- TAB 2: ERWEITERT -->
          <div
            class="tab-pane fade"
            id="millTabAdvanced"
            role="tabpanel"
          >
            <div class="row mb-2">
              <div class="col-md-6">
                <label class="form-label fw-bold mb-1">Vorschub (mm/min)</label>
                <input
                  type="number"
                  class="form-control form-control-sm"
                  id="millFeedRate"
                  value="1500"
                />
                <label class="form-label fw-bold mt-2">Schnitttiefe pro Zug (mm)</label>
                <input
                  type="number"
                  class="form-control form-control-sm"
                  id="millCutDepth"
                  value="3.0"
                />
              </div>
              <div class="col-md-6">
                <label class="form-label fw-bold mb-1">Toolchange-Zeit (s)</label>
                <input
                  type="number"
                  class="form-control form-control-sm"
                  id="millToolChange"
                  value="20"
                />
                <label class="form-label fw-bold mt-2">Maschinen-Verfügbarkeit (%)</label>
                <small class="form-text text-muted">(fix im Code? Optional.)</small>
              </div>
            </div>

            <div class="row mb-2">
              <div class="col-md-6">
                <label class="form-label fw-bold mb-1">Losgröße</label>
                <input
                  type="number"
                  class="form-control form-control-sm"
                  id="millLotSize"
                  value="100"
                />
              </div>
              <div class="col-md-6">
                <label class="form-label fw-bold mb-1">Rüstzeit (min)</label>
                <input
                  type="number"
                  class="form-control form-control-sm"
                  id="millRuestMin"
                  value="30"
                />
              </div>
            </div>
          </div><!-- END TAB ADVANCED -->
        </div><!-- END .tab-content -->

        <hr/>
        <!-- ERGEBNISSE -->
        <div id="millResultsArea" class="mt-2">
          <h6>Ergebnisse</h6>
          <div class="row">
            <div class="col-md-6">
              <div>Maschine: <span id="millChosenMachine" class="fw-bold">--</span></div>
              <div>Takt/Teil (s): <span id="millCycleTime" class="fw-bold">--</span></div>
              <div>Teile/h: <span id="millPartPerHour" class="fw-bold">--</span></div>
              <div>Kosten/Teil: <span id="millCostEach" class="fw-bold">--</span></div>
              <div>CO₂/Teil: <span id="millCo2Each" class="fw-bold">--</span></div>
            </div>
            <div class="col-md-6">
              <canvas
                id="millCostChart"
                width="240"
                height="240"
                style="border:1px solid #ccc;"
              ></canvas>
            </div>
          </div>
        </div><!-- /millResultsArea -->
      </div><!-- /modal-body -->

      <!-- FOOTER (Design analog) -->
      <div class="modal-footer d-flex justify-content-between align-items-center" style="padding: 0.5rem 1rem;">
        <div>
          <button
            type="button"
            class="btn btn-sm btn-secondary me-2"
            data-bs-dismiss="modal"
          >
            <i class="fa fa-times me-1"></i> Schließen
          </button>
          <button
            type="button"
            class="btn btn-sm btn-theme me-2"
            onclick="calculateMilling()"
          >
            <i class="fa fa-calculator me-1"></i> Berechnen
          </button>
          <button
            type="button"
            class="btn btn-sm btn-success"
            id="btnMillingUebernehmen"
          >
            <i class="fa fa-check me-1"></i> Übernehmen
          </button>
        </div>
      </div>

    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- #modalMilling -->
<!-- End MILLING-MODAL -->
        <!-- ============== STAMPING-MODAL ============== -->
<!-- =================== STANZEN/PRESSEN – KALKULATOR (DESIGN-ADAPTIERT) =================== -->
<div class="modal fade" id="modalStamping" tabindex="-1" aria-labelledby="stampingModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-xl modal-stamping" style="max-width:1000px;">
    <div class="modal-content" style="font-size: 0.9rem; max-height: 85vh; overflow-y: auto;">

      <!-- HEADER (Design analog) -->
      <div class="modal-header bg-theme text-white" style="padding: 0.6rem 1rem;">
        <h5 class="modal-title" id="stampingModalLabel">Stanzen/Pressen – Kalkulator</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
      </div>

      <!-- BODY -->
      <div class="modal-body p-2">
        <!-- Tabs (Basis / Erweitert) -->
        <ul class="nav nav-tabs nav-tabs-v2" id="stampingTabs" role="tablist" style="margin-bottom: 0.5rem;">
          <li class="nav-item" role="presentation">
            <button
              class="nav-link active"
              id="stamping-basic-tab"
              data-bs-toggle="tab"
              data-bs-target="#stampingTabBasic"
              type="button"
              role="tab"
            >
              Basis
            </button>
          </li>
          <li class="nav-item" role="presentation">
            <button
              class="nav-link"
              id="stamping-adv-tab"
              data-bs-toggle="tab"
              data-bs-target="#stampingTabAdvanced"
              type="button"
              role="tab"
            >
              Erweitert
            </button>
          </li>
        </ul>

        <div class="tab-content mt-2" id="stampingTabContent">
          <!-- TAB 1: BASIS -->
          <div
            class="tab-pane fade show active"
            id="stampingTabBasic"
            role="tabpanel"
          >
            <div class="row mb-2">
              <div class="col-md-6">
                <label class="form-label fw-bold mb-1">Material</label>
                <select id="stMatSelect" class="form-select form-select-sm">
                  <option value="Stahl DC01">Stahl DC01</option>
                  <option value="Stahl DP600">Stahl DP600</option>
                  <option value="Alu AW1050">Alu AW1050</option>
                </select>
              </div>
              <div class="col-md-6">
                <label class="form-label fw-bold mb-1">Blechdicke (mm)</label>
                <input
                  type="number"
                  class="form-control form-control-sm"
                  id="stThickMm"
                  value="1.0"
                />
              </div>
            </div>

            <div class="row mb-2">
              <div class="col-md-6">
                <label class="form-label fw-bold mb-1">proj. Fläche (cm²)</label>
                <input
                  type="number"
                  class="form-control form-control-sm"
                  id="stAreaCm2"
                  value="150"
                />
              </div>
              <div class="col-md-6">
                <label class="form-label fw-bold mb-1">Verschnitt (%)</label>
                <input
                  type="number"
                  class="form-control form-control-sm"
                  id="stScrapPct"
                  value="15"
                />
              </div>
            </div>

            <div class="row mb-2">
              <div class="col-md-6">
                <label class="form-label fw-bold mb-1">Losgröße</label>
                <input
                  type="number"
                  class="form-control form-control-sm"
                  id="stLos"
                  value="10000"
                />
              </div>
              <div class="col-md-6">
                <label class="form-label fw-bold mb-1">Rüstzeit (min)</label>
                <input
                  type="number"
                  class="form-control form-control-sm"
                  id="stRuestMin"
                  value="60"
                />
              </div>
            </div>

            <div class="mb-2 form-check">
              <input class="form-check-input" type="checkbox" id="stDickBlechChk" />
              <label class="form-check-label" for="stDickBlechChk">
                Dickes Blech => -20% Hubzahl
              </label>
            </div>
          </div><!-- END TAB BASIC -->

          <!-- TAB 2: ERWEITERT -->
          <div
            class="tab-pane fade"
            id="stampingTabAdvanced"
            role="tabpanel"
          >
            <div class="row mb-2">
              <div class="col-md-6">
                <div class="form-check mb-1">
                  <input class="form-check-input" type="checkbox" id="stAutoMachChk" checked />
                  <label class="form-check-label" for="stAutoMachChk">
                    Presse automatisch wählen?
                  </label>
                </div>
                <label class="form-label fw-bold mb-1">Manuelle Presse</label>
                <select id="stPressSelect" class="form-select form-select-sm" disabled>
                  <option value="100">100 t</option>
                  <option value="200">200 t</option>
                  <option value="400">400 t</option>
                  <option value="600">600 t</option>
                </select>
              </div>
              <div class="col-md-6">
                <label class="form-label fw-bold mb-1">Hub/min (Berechnung intern)</label>
                <small class="form-text text-muted">
                  (Kein separates Eingabefeld, wir leiten es aus machine_data ab.)
                </small>
              </div>
            </div>
          </div><!-- END TAB ADVANCED -->
        </div><!-- /tab-content -->

        <hr/>
        <!-- ERGEBNISSE -->
        <div id="stResultsArea" class="mt-2">
          <h6>Ergebnisse</h6>
          <div class="row">
            <div class="col-md-6">
              <div>Presskraft (t): <span id="stPressForce" class="fw-bold">--</span></div>
              <div>Gewählte Presse: <span id="stChosenPress" class="fw-bold">--</span></div>
              <div>Takt/Teil (s): <span id="stCycleTime" class="fw-bold">--</span></div>
              <div>Teile/h: <span id="stPartPerHour" class="fw-bold">--</span></div>
              <div>Kosten/Teil: <span id="stCostEach" class="fw-bold">--</span></div>
              <div>CO₂/Teil: <span id="stCo2Each" class="fw-bold">--</span></div>
            </div>
            <div class="col-md-6">
              <canvas
                id="stCycleChart"
                width="240"
                height="240"
                style="border:1px solid #ccc;"
              ></canvas>
            </div>
          </div>
        </div>
      </div><!-- /modal-body -->

      <!-- FOOTER (Design analog) -->
      <div class="modal-footer d-flex justify-content-between align-items-center" style="padding: 0.5rem 1rem;">
        <div>
          <button type="button" class="btn btn-sm btn-secondary me-2" data-bs-dismiss="modal">
            <i class="fa fa-times me-1"></i> Schließen
          </button>
          <button type="button" class="btn btn-sm btn-theme me-2" onclick="calculateStamping()">
            <i class="fa fa-calculator me-1"></i> Berechnen
          </button>
          <button type="button" class="btn btn-sm btn-success" id="btnStampingUebernehmen">
            <i class="fa fa-check me-1"></i> Übernehmen
          </button>
        </div>
      </div>

    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- #modalStamping -->

<!-- ============= ZYKLUSZEIT-MODAL (mit 4 Verfahren) ============= -->
<div
  class="modal fade"
  id="modalZyklusBild"
  tabindex="-1"
  aria-hidden="true"
>
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Zykluszeit – Auswahl</h5>
        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="modal"
        ></button>
      </div>
      <div class="modal-body">
        <p>Wähle deine Fertigungstechnik:</p>
        <div class="d-flex flex-wrap justify-content-between">
          <!-- Spritzguss -->
          <div class="text-center m-2">
            <img
              src="/static/img/spritzguss.jpeg"
              alt="Spritzguss"
              class="img-choice"
              onclick="openSpritzgussModal()"
            />
            <p class="mt-2 mb-0">Spritzguss</p>
          </div>
          <!-- Druckguss -->
          <div class="text-center m-2">
            <img
              src="/static/img/druckguss.jpeg"
              alt="Druckguss"
              class="img-choice"
              onclick="openDruckgussModalSafe()"
            />
            <p class="mt-2 mb-0">Druckguss</p>
          </div>
          <!-- Zerspanung -->
          <div class="text-center m-2">
            <img
              src="/static/img/zerspanung.jpeg"
              alt="Zerspanung"
              class="img-choice"
              onclick="openMillingModalSafe()"
            />
            <p class="mt-2 mb-0">Zerspanung</p>
          </div>
          <!-- Stanzen -->
          <div class="text-center m-2">
            <img
              src="/static/img/stanzen.jpeg"
              alt="Stanzen"
              class="img-choice"
              onclick="openStampingModalSafe()"
            />
            <p class="mt-2 mb-0">Stanzen</p>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button
          type="button"
          class="btn btn-secondary"
          data-bs-dismiss="modal"
        >
          Schließen
        </button>
      </div>
    </div>
  </div>
</div>


<!-- Taktzeit-Modal -->
<div
  class="modal fade"
  id="modalTakt"
  tabindex="-1"
  aria-hidden="true"
>
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Taktzeit-Rechner</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <label for="taktFormfill" class="form-label">Formfüllzeit (s)</label>
        <input type="number" step="0.1" class="form-control" id="taktFormfill" value="5" />
        <label for="taktCooling" class="form-label mt-2">Kühlzeit (s)</label>
        <input type="number" step="0.1" class="form-control" id="taktCooling" value="10" />
      </div>
      <div class="modal-footer">
        <button
          type="button"
          class="btn btn-secondary"
          data-bs-dismiss="modal"
        >
          Abbrechen
        </button>
        <button
          type="button"
          class="btn btn-primary"
          onclick="acceptTakt()"
        >
          Übernehmen
        </button>
      </div>
    </div>
  </div>
</div>
<!-- =================== NEUES MASCHINENSTUNDENSATZ-MODAL =================== -->
<!-- =================== NEUES MASCHINENSTUNDENSATZ-MODAL (FINAL VERSION) =================== -->
<!--
   - Mit 2 Tabs ("Abschreibung & Kapital" / "Energie & Betrieb")
   - Kompakte Darstellung
   - "Berechnen" ruft calcExtendedMachineRate() auf (IDs beibehalten)
   - Read-only Felder in grau
   - Stromverbrauch (%) voreingestellt auf 85.0
   - Jahreskosten-Feld optional sichtbar
-->
<style>
  /* Kleines Extra-CSS für read-only Felder (grau) */
  .form-control[readonly], .form-control:disabled {
    background-color: #e9ecef !important;
    cursor: not-allowed;
  }
</style>

<div class="modal fade" id="modalMachine" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-xl" style="max-width:1000px;"> <!-- Extra-breit -->
    <div class="modal-content" style="font-size: 0.9rem;">
      <div class="modal-header bg-theme text-white" style="padding: 0.6rem 1rem;">
        <h5 class="modal-title">Maschinenstundensatz – Erweitert</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
      </div>

      <div class="modal-body p-2">
        <!-- TABS: "Abschreibung/Kapital" & "Energie/Betrieb" -->
        <ul class="nav nav-tabs nav-tabs-v2" role="tablist" style="margin-bottom: 0.5rem;">
          <li class="nav-item">
            <button class="nav-link active" data-bs-toggle="tab" data-bs-target="#machTabCapital" type="button">
              Abschreibung & Kapital
            </button>
          </li>
          <li class="nav-item">
            <button class="nav-link" data-bs-toggle="tab" data-bs-target="#machTabEnergy" type="button">
              Energie & Betrieb
            </button>
          </li>
        </ul>

        <div class="tab-content p-2">
          <!-- TAB 1: Abschreibung & Kapital -->
          <div class="tab-pane fade show active" id="machTabCapital">
            <div class="row mb-2">
              <!-- Kaufpreis + Aus Liste... -->
              <div class="col-md-6 d-flex align-items-center">
                <label class="col-form-label col-5">Kaufpreis (€)</label>
                <div class="col-7 d-flex gap-2">
                  <input
                    type="number"
                    class="form-control form-control-sm"
                    id="machKaufpreis"
                    value="100000"
                  />
                  <button class="btn btn-sm btn-outline-theme" onclick="openMachineListModal()">
                    Aus Liste...
                  </button>
                </div>
              </div>
              <!-- Abschreibung pro Stunde -->
              <div class="col-md-6 d-flex align-items-center">
                <label class="col-form-label col-5">Abschr. pro h</label>
                <div class="col-7">
                  <input
                    type="text"
                    class="form-control form-control-sm"
                    id="machKaufpreisHr"
                    placeholder="€/h"
                    readonly
                  />
                </div>
              </div>
            </div>

            <div class="row mb-2">
              <!-- Installationskosten -->
              <div class="col-md-6 d-flex align-items-center">
                <label class="col-form-label col-5">Installationsk. (€)</label>
                <div class="col-7">
                  <input
                    type="number"
                    class="form-control form-control-sm"
                    id="machInstCost"
                    value="0"
                  />
                </div>
              </div>
              <!-- Zinssatz + Zins pro h -->
              <div class="col-md-6 d-flex align-items-center">
                <label class="col-form-label col-5">Zinssatz (%)</label>
                <div class="col-7 d-flex gap-2">
                  <input
                    type="number"
                    class="form-control form-control-sm"
                    id="machZinssatz"
                    step="0.1"
                    value="3.0"
                  />
                  <input
                    type="text"
                    class="form-control form-control-sm"
                    id="machZinsHr"
                    placeholder="€/h"
                    readonly
                  />
                </div>
              </div>
            </div>

            <div class="row mb-2">
              <!-- Nutzungsdauer -->
              <div class="col-md-6 d-flex align-items-center">
                <label class="col-form-label col-5">Nutzungsdauer (J.)</label>
                <div class="col-7">
                  <input
                    type="number"
                    class="form-control form-control-sm"
                    id="machNutzdauer"
                    value="5"
                  />
                </div>
              </div>
              <!-- Dedicated? -->
              <div class="col-md-6 d-flex align-items-center">
                <label class="col-form-label col-5">Dedicated?</label>
                <div class="col-7 d-flex align-items-center gap-2">
                  <input
                    type="checkbox"
                    class="form-check-input"
                    style="transform: scale(1.2);"
                    id="chkDedicated"
                    onchange="toggleDedicatedPct()"
                  />
                  <input
                    type="number"
                    class="form-control form-control-sm"
                    id="machDedicatedPct"
                    value="100"
                    step="1"
                    min="1"
                    max="100"
                    style="width: 60px;"
                    disabled
                  />
                  <span>%</span>
                  <!-- Mini Chat Icon (als Dummy) -->
                  <div>
                    <a href="javascript:void(0)" onclick="openMiniChatDedicated()" class="text-theme" style="font-size:1.2rem;">
                      <i class="fa fa-question-circle"></i>
                    </a>
                  </div>
                </div>
              </div>
            </div>

            <!-- Minimales Chat-Fenster-Dummy (wird per JS ein-/ausgeblendet) -->
            <div id="miniChatDedicated" class="border p-2 bg-light" style="display:none; margin-bottom: 0.5rem;">
              <strong>Dedicated? Was bedeutet das?</strong>
              <p class="mb-1" style="font-size:0.85rem;">
                Das bedeutet, dass die Maschine nur für dieses Projekt genutzt wird.
                Bei 100% Dedicated entfallen die Maschinenkosten komplett auf dieses Bauteil.
              </p>
              <button class="btn btn-sm btn-outline-secondary" onclick="closeMiniChatDedicated()">
                Verstanden
              </button>
            </div>

            <div class="row mb-2">
              <!-- Jahresauslastung -->
              <div class="col-md-6 d-flex align-items-center">
                <label class="col-form-label col-5">Jahresauslastung (h)</label>
                <div class="col-7">
                  <input
                    type="number"
                    class="form-control form-control-sm"
                    id="machAuslast"
                    value="6000"
                  />
                </div>
              </div>
              <!-- Verfügbarkeit -->
              <div class="col-md-6 d-flex align-items-center">
                <label class="col-form-label col-5">Verfügbarkeit (%)</label>
                <div class="col-7 d-flex gap-2">
                  <input
                    type="number"
                    class="form-control form-control-sm"
                    id="machAvailPct"
                    step="0.1"
                    value="85.0"
                  />
                  <input
                    type="text"
                    class="form-control form-control-sm"
                    id="machAvailHr"
                    placeholder="eff. h"
                    readonly
                  />
                </div>
              </div>
            </div>
          </div>
          <!-- END TAB1 -->

          <!-- TAB 2: Energie & Betrieb -->
          <div class="tab-pane fade" id="machTabEnergy">
            <div class="row mb-2">
              <!-- Anschlusswert -->
              <div class="col-md-6 d-flex align-items-center">
                <label class="col-form-label col-5">Anschlusswert (kW)</label>
                <div class="col-7">
                  <input
                    type="number"
                    class="form-control form-control-sm"
                    id="machKW"
                    value="100"
                  />
                </div>
              </div>
              <!-- Stromverbr. => standard 85% -->
              <div class="col-md-6 d-flex align-items-center">
                <label class="col-form-label col-5">Stromverbr. (%)</label>
                <div class="col-7">
                  <input
                    type="number"
                    class="form-control form-control-sm"
                    id="machStromPct"
                    value="85.0"
                  />
                </div>
              </div>
            </div>

            <div class="row mb-2">
              <!-- Stromkosten -->
              <div class="col-md-6 d-flex align-items-center">
                <label class="col-form-label col-5">Stromkosten (€/kWh)</label>
                <div class="col-7 d-flex gap-2">
                  <input
                    type="number"
                    class="form-control form-control-sm"
                    id="machStromCost"
                    step="0.01"
                    value="0.20"
                  />
                  <input
                    type="text"
                    class="form-control form-control-sm"
                    id="machStromCostHr"
                    placeholder="€/h"
                    readonly
                    style="background-color:#e9ecef;"
                  />
                </div>
              </div>
              <!-- CO2 (kg/h) -->
              <div class="col-md-6 d-flex align-items-center">
                <label class="col-form-label col-5">CO₂ (kg/h)</label>
                <div class="col-7">
                  <input
                    type="text"
                    class="form-control form-control-sm"
                    id="machCo2Hr"
                    placeholder="kg/h"
                    readonly
                    style="background-color:#e9ecef;"
                  />
                </div>
              </div>
            </div>

            <div class="row mb-2">
              <!-- Flächenbedarf -->
              <div class="col-md-6 d-flex align-items-center">
                <label class="col-form-label col-5">Flächenbedarf (m²)</label>
                <div class="col-7">
                  <input
                    type="number"
                    class="form-control form-control-sm"
                    id="machFlaecheBedarf"
                    value="20"
                  />
                </div>
              </div>
              <!-- Flächenkosten -->
              <div class="col-md-6 d-flex align-items-center">
                <label class="col-form-label col-5">Flächenkosten (€/m²)</label>
                <div class="col-7 d-flex gap-2">
                  <input
                    type="number"
                    class="form-control form-control-sm"
                    id="machFlaechenkost"
                    step="0.01"
                    value="7.0"
                  />
                  <input
                    type="text"
                    class="form-control form-control-sm"
                    id="machFlaechenkostHr"
                    placeholder="€/h"
                    readonly
                    style="background-color:#e9ecef;"
                  />
                </div>
              </div>
            </div>

            <div class="row mb-2">
              <!-- Instandhaltung -->
              <div class="col-md-6 d-flex align-items-center">
                <label class="col-form-label col-5">Instandhaltung (% v. KP)</label>
                <div class="col-7 d-flex gap-2">
                  <input
                    type="number"
                    class="form-control form-control-sm"
                    id="machInstandPct"
                    step="0.1"
                    value="3.0"
                  />
                  <input
                    type="text"
                    class="form-control form-control-sm"
                    id="machInstandHr"
                    placeholder="€/h"
                    readonly
                    style="background-color:#e9ecef;"
                  />
                </div>
              </div>
              <!-- Betriebskosten -->
              <div class="col-md-6 d-flex align-items-center">
                <label class="col-form-label col-5">Betriebskosten (% v. KP)</label>
                <div class="col-7 d-flex gap-2">
                  <input
                    type="number"
                    class="form-control form-control-sm"
                    id="machBetriebPct"
                    step="0.1"
                    value="2.0"
                  />
                  <input
                    type="text"
                    class="form-control form-control-sm"
                    id="machBetriebHr"
                    placeholder="€/h"
                    readonly
                    style="background-color:#e9ecef;"
                  />
                </div>
              </div>
            </div>
          </div>
          <!-- END TAB2 -->
        </div> <!-- /.tab-content -->
      </div> <!-- END modal-body -->

      <!-- FOOTER-ROW: Buttons + Ergebnis -->
      <div class="modal-footer d-flex justify-content-between align-items-center" style="padding:0.5rem 1rem;">
        <div class="d-flex align-items-center gap-2">
          <!-- Berechnen -->
          <button type="button" class="btn btn-sm btn-theme" onclick="calcExtendedMachineRate()">
            <i class="fa fa-calculator me-1"></i> Berechnen
          </button>
          <!-- Übernehmen -->
          <button type="button" class="btn btn-sm btn-success" onclick="acceptMachine()">
            <i class="fa fa-check me-1"></i> Übernehmen
          </button>
          <!-- Schließen -->
          <button type="button" class="btn btn-sm btn-secondary" data-bs-dismiss="modal">
            <i class="fa fa-times me-1"></i> Schließen
          </button>
        </div>
        <div class="d-flex align-items-center gap-2">
          <!-- Jahreskosten (falls du es brauchst) -->
        <script>
/* Mini-Chat-Widget (Dedicated) */
function openMiniChatDedicated(){
  document.getElementById('miniChatDedicated').style.display = 'block';
}
function closeMiniChatDedicated(){
  document.getElementById('miniChatDedicated').style.display = 'none';
}

/* ACHTUNG:
   Stelle sicher, dass deine JS-Funktion
   calcExtendedMachineRate()
   exakt die IDs referenziert, die wir hier haben:
   - machKaufpreis, machZinssatz, ...
   - machZinsHr, machBetriebHr, machStromCostHr, ...
   - Der Code muss 1:1 matchen
*/
</script>
          <!-- Maschinenkosten (€/h) -->
          <span style="font-weight:600;">Maschinenkosten (€/h):</span>
          <span id="machResult" class="text-theme fw-bold">--</span>
        </div>
      </div>
    </div> <!-- /.modal-content -->
  </div> <!-- /.modal-dialog -->
</div> <!-- #modalMachine -->


<script>
/* Mini-Chat-Widget (Dedicated) */
function openMiniChatDedicated(){
  document.getElementById('miniChatDedicated').style.display = 'block';
}
function closeMiniChatDedicated(){
  document.getElementById('miniChatDedicated').style.display = 'none';
}

/* ACHTUNG:
   Stelle sicher, dass deine JS-Funktion
   calcExtendedMachineRate()
   exakt die IDs referenziert, die wir hier haben:
   - machKaufpreis, machZinssatz, ...
   - machZinsHr, machBetriebHr, machStromCostHr, ...
   - Der Code muss 1:1 matchen
*/
</script>
        <!-- LOHN-LISTE MODAL -->
<div
  class="modal fade"
  id="modalLohn"
  tabindex="-1"
  aria-hidden="true"
>
  <div class="modal-dialog modal-lg">
    <div class="modal-content" style="max-height: 70vh; overflow-y: auto;">
      <div class="modal-header">
        <h5 class="modal-title">Lohnliste</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>

      <div class="modal-body">
        <!-- Eingabefeld für Anzahl Bediener -->
        <div class="mb-3">
          <label for="operatorsPerMachine" class="form-label">
            Anzahl Bediener pro Maschine
          </label>
          <input
            type="number"
            class="form-control"
            id="operatorsPerMachine"
            step="0.1"
            value="0.5"
          />
        </div>

        <!-- NEU: Eingabefeld für Arbeitsauslastung (Utilization) -->
        <div class="mb-3">
          <label for="lohnUtilPct" class="form-label">
            Arbeitsauslastung (%)
          </label>
          <input
            type="number"
            class="form-control"
            id="lohnUtilPct"
            step="0.1"
            value="85.0"
          />
          <small class="text-muted">
            Beispiel: 85 bedeutet, dass die Kosten auf 85% Produktivzeit umgelegt werden.
          </small>
        </div>

        <!-- NEU: Filter-Feld + Button zum Zurücksetzen -->
        <div class="mb-3 d-flex gap-2">
          <input
            type="text"
            class="form-control"
            id="txtLohnFilter"
            placeholder="Filter nach Land, Schichtmodell, Kommentar..."
            oninput="applyLohnFilter()"
          />
          <button
            class="btn btn-sm btn-outline-secondary"
            onclick="clearLohnFilter()"
          >
            Filter zurücksetzen
          </button>
        </div>

        <!-- Tabelle Lohnliste -->
        <table class="table table-sm" id="tblLohnList">
          <thead>
            <tr>
              <th>Land</th>
              <th>Schichtmodell</th>
              <th>All-In (€/h)</th>
              <th>Kommentar</th>
              <th>Aktion</th>
            </tr>
          </thead>
          <tbody>
            <!-- Dynamische Inhalte per JavaScript -->
          </tbody>
        </table>
      </div>

      <div class="modal-footer">
        <button
          type="button"
          class="btn btn-secondary"
          data-bs-dismiss="modal"
        >
          Schließen
        </button>
      </div>
    </div>
  </div>
</div>

<!-- MASCHINENLISTE MODAL -->
<div
  class="modal fade"
  id="modalMachineList"
  tabindex="-1"
  aria-hidden="true"
>
  <div class="modal-dialog modal-lg">
    <div class="modal-content" style="max-height: 70vh; overflow-y: auto;">
      <div class="modal-header">
        <h5 class="modal-title">Maschinenliste</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>

      <div class="modal-body">
        <!-- NEU: Filter-Feld + Button zum Zurücksetzen -->
        <div class="mb-3 d-flex gap-2">
          <input
            type="text"
            class="form-control"
            id="txtMachineFilter"
            placeholder="Filter (Maschine, Verfahren, Kommentar...)"
            oninput="applyMachineFilter()"
          />
          <button
            class="btn btn-sm btn-outline-secondary"
            onclick="clearMachineFilter()"
          >
            Filter zurücksetzen
          </button>
        </div>

        <table class="table table-sm" id="tblMachineList">
          <thead>
            <tr>
              <th>Maschine</th>
              <th>Verfahren</th>
              <th>Kaufpreis (€)</th>
              <th>Power (kW)</th>
              <th>Kommentar</th>
              <th>Aktion</th>
            </tr>
          </thead>
          <tbody>
            <!-- Befüllung via JS -->
          </tbody>
        </table>
      </div>

      <div class="modal-footer">
        <button
          type="button"
          class="btn btn-secondary"
          data-bs-dismiss="modal"
        >
          Schließen
        </button>
      </div>
    </div>
  </div>
</div><!-- <input id="txtCosts100" type="text" class="form-control" /> -->
<!--<input id="txtCo2Per100" type="text" class="form-control" /> -->
</div>
      <!-- ================== BEGIN ColorAdmin core JS ================== -->
<script src="/static/coloradmin/js/vendor.min.js"></script>
<script src="/static/coloradmin/js/app.min.js"></script>
<!-- ================== END ColorAdmin core JS ================== -->
<!-- Bootstrap-Bundle (JS + Popper) -->
<!-- Chart.js -->
<script
  src="https://cdn.jsdelivr.net/npm/chart.js@4.2.1/dist/chart.umd.min.js"
></script>
<!-- Externes JS -->
<script src="/static/js/mycalc.js"></script>
<script src="/static/js/feinguss_calculator.js"></script>
<script src="/static/js/schmieden_calculator.js"></script>
<script src="/static/js/kaltfliess_calculator.js"></script>
<script src="/static/js/pcb_calculator.js"></script>
<script src="/static/js/spritzguss_calculator.js"></script>
<script src="/static/js/druckguss_calculator.js"></script>
<script src="/static/js/milling_calculator.js"></script>
<script src="/static/js/stamping_calculator.js"></script>
    <!-- Live Chat Widget -->

<hr/>
<div id="cookieBanner" style="position: fixed; bottom: 0; left: 0; right: 0;
     background: #222; color: #fff; padding: 10px; display: none; z-index: 9999;">
  <p style="margin: 0;">
    Wir verwenden Cookies. Einige sind essenziell, andere helfen uns,
    unsere Seite zu verbessern. Mit Klick auf „Alle akzeptieren“ stimmen
    Sie der Verwendung zu.
    <a href="/datenschutz" style="color: #fff; text-decoration: underline;">
      Mehr Infos
    </a>
  </p>
  <button id="cookieAcceptAll" class="btn btn-sm btn-success" style="margin: 5px;">Alle akzeptieren</button>
  <button id="cookieDeclineAll" class="btn btn-sm btn-light" style="margin: 5px;">Nur essenzielle</button>
</div>

<script>
window.addEventListener("DOMContentLoaded", () => {
  checkLicense(); // oder checkUserLogin();
});
  (function () {
    function getCookie(name) {
      const match = document.cookie.match(new RegExp('(^| )' + name + '=([^;]+)'));
      if (match) return match[2];
    }

    if (!getCookie("cookieConsent")) {
      document.getElementById("cookieBanner").style.display = "block";
    }

    document.getElementById("cookieAcceptAll").addEventListener("click", function () {
      document.cookie = "cookieConsent=all; path=/; max-age=" + (365 * 24 * 60 * 60);
      document.getElementById("cookieBanner").style.display = "none";
      // optional: Google Analytics oder andere Tracker aktivieren
    });

    document.getElementById("cookieDeclineAll").addEventListener("click", function () {
      document.cookie = "cookieConsent=essential; path=/; max-age=" + (365 * 24 * 60 * 60);
      document.getElementById("cookieBanner").style.display = "none";
    });
  })();
</script>
<script>
  // Starte das ColorAdmin App-Framework
  document.addEventListener('DOMContentLoaded', function() {
    App.init();
  });

  // Minimales Chat-Fenster an/aus
  function toggleChatWindow(){
    const cw = document.getElementById("chatWindow");
    cw.style.display = (cw.style.display === "block") ? "none" : "block";
  }
</script>
<hr/>
<footer class="text-center my-3">
  <a href="/impressum">Impressum</a> |
  <a href="/datenschutz">Datenschutz</a> |
  <a href="/agb">AGB</a>
</footer>
<div id="chatBubble" onclick="toggleChatWindow()">
  <img src="https://cdn-icons-png.flaticon.com/512/2990/2990675.png" alt="Chat Bubble" />
</div>

<!-- Minimales Chat-Fenster (ausgeblendet) -->
<div id="chatWindow" class="card" style="">
  <div class="card-header bg-theme text-white p-2">
    <h6 class="mb-0">KI-Assistent</h6>
  </div>
  <div class="card-body p-2" style="max-height:200px; overflow-y:auto;">
    <p style="font-size:0.85rem;">Hallo! Wie kann ich helfen?</p>
    <!-- Evtl. ein Eingabefeld, Chat-Verlauf, etc. -->
  </div>
  <div class="card-footer p-2">
    <button class="btn btn-sm btn-secondary" onclick="toggleChatWindow()">Schließen</button>
  </div>
</div>
</body>
</html>