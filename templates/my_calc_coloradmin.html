<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="csrf-token" content="{{ csrf_token() }}">
  <title>ParetoCALC by JPC</title>

  <!-- ================== BEGIN ColorAdmin core CSS ================== -->
  <link href="/static/coloradmin/css/vendor.min.css" rel="stylesheet" />
  <link href="/static/coloradmin/css/app.min.css" rel="stylesheet" />
  <!-- ================== END ColorAdmin core CSS ================== -->

  <!-- ================== BEGIN ApexCharts (lokal oder CDN) ================== -->
  <!-- Falls du ApexCharts lokal hostest, einfach Pfad anpassen.
       Hier als Beispiel von CDN: -->
  <script src="https://cdn.jsdelivr.net/npm/apexcharts@3.37.1/dist/apexcharts.min.js"></script>
  <!-- ================== END ApexCharts ================== -->

  <!-- =========================================================
       1) Deine bisherigen globalen Styles
      ========================================================= -->
<style>
  /* 1) GLOBAL BASIS */
  body {
    font-size: 14px;
    background-color: #f8f9fa;
    margin: 0;
    padding: 0;
  }
  /* #app mit Sidebar minified => standardmäßig eingeklappt */
  #app.app-sidebar-minified { /* ColorAdmin-Klasse: Sidebar start-minimized */ }

  /* 2) HEADER-BEREICH => Einzeiliges Flex-Layout */
  .app-header {
    display: flex;
    align-items: center;
    justify-content: space-between; /* Burger+Logo links, Account rechts */
    min-height: 60px;
    background: #fff;
    border-bottom: 1px solid #ddd;
    padding: 0 15px; /* etwas Horizontal-Padding */
  }
  .navbar-desktop-toggler, .navbar-mobile-toggler {
    font-size: 1rem;
    line-height: 1;
    background: none;
    border: none;
    padding: 0;
    margin: 0;
    cursor: pointer; /* wichtig, da button ohne border */
  }
  .navbar-desktop-toggler i.fa-bars {
    font-size: 1.2rem;
    color: #444;
    margin-right: 5px;
  }
  .navbar-brand {
    display: flex;
    align-items: center;
    gap: 10px;
    white-space: nowrap; /* verhindert Zeilenumbruch */
  }
  .navbar-brand img {
    height: 120px !important;
    width: auto;
  }
  .navbar-brand span {
    font-size: 18px;
    vertical-align: middle;
  }
  .header-center {
    display: flex;
    align-items: center;
    gap: 20px;
  }
  .header-center label {
    font-weight: 600;
    margin-bottom: 0;
  }
  .header-center input[readonly] {
    background: #e9ecef;
  }

  /* 3) SIDEBAR => Minified + nur Icons (verstecke nav-text) */
  .nav-text {
    display: none !important; /* nur Icons */
  }
  .nav-icon {
    font-size: 1.2rem;
  }
  .app-sidebar { /* standard style => left: 0; etc. -> von ColorAdmin gesteuert */ }

  /* 4) CONTENT-BEREICH => (Tabs etc.) */
  #content {
    padding: 1rem;
  }
  .nav-tabs .nav-link {
    font-weight: 500;
  }

    /* 5) PCB-Modal => Chat-Bubble + Chat-Fenster */
    .modal-body { position: relative; }
    #pcbChatBubble {
      position: absolute;
      right: 10px;
      bottom: 10px;
      width: 120px;
      height: 40px;
      cursor: pointer;
      z-index: 9999;
    }
    #pcbChatBubble img {
      width: 100%;
      height: auto;
      border-radius: 50%;
      box-shadow: 0 0 5px rgba(0,0,0,0.3);
    }
    #pcbChatWindow {
      position: absolute;
      right: 60px;
      bottom: 60px;
      width: 280px;
      background: #fff;
      border: 1px solid #ccc;
      box-shadow: 0 0 6px rgba(0,0,0,0.2);
      z-index: 9999;
      display: none;
    }
    #pcbChatWindow .header {
      background: #f0f0f0;
      padding: 6px;
      font-weight: bold;
    }
    #pcbChatWindow .body {
      max-height: 150px;
      overflow-y: auto;
      padding: 6px;
      font-size: 0.85rem;
    }
    #pcbChatWindow .footer {
      padding: 6px;
      text-align: right;
    }
    /* 5) SGChat => Chat-Bubble + Chat-Fenster */
  .modal-body { position: relative; }
  #SGChatBubble {
    position: absolute;
    right: 10px;
    bottom: 10px;
    width: 120px;
    height: 40px;
    cursor: pointer;
    z-index: 9999;
  }
  #SGChatBubble img {
    width: 100%;
    height: auto;
    border-radius: 50%;
    box-shadow: 0 0 5px rgba(0,0,0,0.3);
  }
  #SGChatWindow {
    position: absolute;
    right: 60px;
    bottom: 60px;
    width: 280px;
    background: #fff;
    border: 1px solid #ccc;
    box-shadow: 0 0 6px rgba(0,0,0,0.2);
    z-index: 9999;
    display: none;
  }
  #SGChatWindow .header {
    background: #f0f0f0;
    padding: 6px;
    font-weight: bold;
  }
  #SGChatWindow .body {
    max-height: 150px;
    overflow-y: auto;
    padding: 6px;
    font-size: 0.85rem;
  }
  #SGChatWindow .footer {
    padding: 6px;
    text-align: right;
  }
  /* 5) FGChat => Chat-Bubble + Chat-Fenster */
  .modal-body { position: relative; }
  #FGChatBubble {
    position: absolute;
    right: 10px;
    bottom: 10px;
    width: 120px;
    height: 40px;
    cursor: pointer;
    z-index: 9999;
  }
  #FGChatBubble img {
    width: 100%;
    height: auto;
    border-radius: 50%;
    box-shadow: 0 0 5px rgba(0,0,0,0.3);
  }
  #FGChatWindow {
    position: absolute;
    right: 60px;
    bottom: 60px;
    width: 280px;
    background: #fff;
    border: 1px solid #ccc;
    box-shadow: 0 0 6px rgba(0,0,0,0.2);
    z-index: 9999;
    display: none;
  }
  #FGChatWindow .header {
    background: #f0f0f0;
    padding: 6px;
    font-weight: bold;
  }
  #FGChatWindow .body {
    max-height: 150px;
    overflow-y: auto;
    padding: 6px;
    font-size: 0.85rem;
  }
  #FGChatWindow .footer {
    padding: 6px;
    text-align: right;
  }
  /* 5) mssChat => Chat-Bubble + Chat-Fenster */
  .modal-body { position: relative; }
  #mssChatBubble {
    position: absolute;
    right: 50px;
    bottom: 10px;
    width: 120px;
    height: 40px;
    cursor: pointer;
    z-index: 9999;
  }
  #mssChatBubble img {
    width: 100%;
    height: auto;
    border-radius: 50%;
    box-shadow: 0 0 5px rgba(0,0,0,0.3);
  }
  #mssChatWindow {
    position: absolute;
    right: 60px;
    bottom: 60px;
    width: 280px;
    background: #fff;
    border: 1px solid #ccc;
    box-shadow: 0 0 6px rgba(0,0,0,0.2);
    z-index: 9999;
    display: none;
  }
  #mssChatWindow .header {
    background: #f0f0f0;
    padding: 6px;
    font-weight: bold;
  }
  #mssChatWindow .body {
    max-height: 150px;
    overflow-y: auto;
    padding: 6px;
    font-size: 0.85rem;
  }
  #mssChatWindow .footer {
    padding: 6px;
    text-align: right;
  }

    /* Sonstige Utility */
    .table-sm td, .table-sm th {
      padding: 0.3rem;
    }
    .img-choice {
      width: 120px;
      margin: 0.5rem;
      border: 2px solid #ddd;
      border-radius: 4px;
      cursor: pointer;
    }
    .img-choice:hover {
      border: 2px solid #007bff;
    }
    .flex-container {
      display: flex;
      flex-wrap: nowrap;
      align-items: center;
      justify-content: space-between;
    }

    /* Accordion Styling in Tab4 */
    .accordion-button {
      font-size: 0.9rem;
    }
    .accordion-body {
      font-size: 0.85rem;
      background: #f8f9fa;
    }
    .accordion-item {
      border: 1px solid #ddd;
      border-radius: 4px;
      margin-bottom: 5px;
    }
  </style>

<!-- =========================================================
     2) NEUE Light/Dark Style Definition
    ========================================================= -->
<style>
  /* =========================================================================
     LIGHT MODE (Default)
     ========================================================================= */
  .card-custom {
    background-color: #fff;
    color: #000;
  }
  .input-custom {
    background-color: #fff;
    color: #000;
    border: 1px solid #ced4da; /* Standard-Bootstrap-Border */
  }
  /* Accordion Buttons, Labels, etc. in Light Mode */
  .accordion-button,
  .col-form-label {
    color: #000;
  }

  /* Tabs: Inaktive & aktive Farbabstufungen im LIGHT MODE */
  .nav-tabs .nav-link {
    background-color: #fafafa;
    color: #000;
    border: 1px solid #dee2e6;
    margin-right: 0.1rem;
  }
  .nav-tabs .nav-link:hover {
    background-color: #e9ecef;
  }
  .nav-tabs .nav-link.active {
    background-color: #ddd;
    color: #000;
    border-color: #ccc #ccc #fff;
  }

  /* Spezieller Wunsch: Tab4 Charts und Slider IM Light Mode -> angleichen */
  #tab4 #sliderContainer,
  #tab4 #apexCostChart,
  #tab4 #apexCo2Chart {
    background-color: #f8f9fa !important; /* Hell, passend zu Accordion-Body */
    color: #000 !important;
    border: 1px solid #ddd !important;
  }

  /* Tab2 Felder in Dark Mode trotzdem weiß */
  .app-theme-dark-mode #tab2 .form-control {
    background-color: #fff;
    color: #000;
  }
  /* Tab1 Felder in Dark Mode trotzdem weiß */
  .app-theme-dark-mode #tab1 .form-control {
    background-color: #fff;
    color: #000;
  }
  /* Tab3 Tabelle in Dark Mode trotzdem weiß */
  .app-theme-dark-mode #tab3 table {
    background-color: #fff;
    color: #000;
  }
  /* Tab5 Tabelle in Dark Mode trotzdem weiß */
  .app-theme-dark-mode #tab5 table {
    background-color: #fff;
    color: #000;
  }

  /* =========================================================================
     DARK MODE Overrides (aktiv bei .app-theme-dark-mode auf #app)
     ========================================================================= */
  .app-theme-dark-mode .card-custom {
    background-color: #2d2d2d;
    color: #ccc;
  }
  .app-theme-dark-mode .input-custom {
    background-color: #444;
    color: #fff;
  }
  /* Labels, Accordion Buttons etc. */
  .app-theme-dark-mode .col-form-label,
  .app-theme-dark-mode .accordion-button {
    color: #ccc;
  }
  /* Gesamt-Hintergrund im Dark Mode */
  .app-theme-dark-mode #content,
  .app-theme-dark-mode .app-content {
    background-color: #2d2d2d;
    color: #ccc;
  }

  /* Tabs im DARK MODE: Inaktive & aktive Farbabstufungen */
  .app-theme-dark-mode .nav-tabs .nav-link {
    background-color: #333;
    color: #ccc;
    border: 1px solid #444;
    margin-right: 0.1rem;
  }
  .app-theme-dark-mode .nav-tabs .nav-link:hover {
    background-color: #3a3a3a;
    color: #fff;
  }
  .app-theme-dark-mode .nav-tabs .nav-link.active {
    background-color: #555;
    color: #fff;
    border-color: #777 #777 #555;
  }

  /*********************************************
   * Tab4-Änderungen für den Dark Mode
     (Nur Slider/Charts und Accordion-Body!)
   *********************************************/
  /* (1) Slider + Charts => Dunkel im Dark Mode */
  .app-theme-dark-mode #tab4 #sliderContainer,
  .app-theme-dark-mode #tab4 #apexCostChart,
  .app-theme-dark-mode #tab4 #apexCo2Chart {
    background-color: #333 !important;
    color: #ccc !important;
    border: 1px solid #555 !important;
  }

  /* (2) Accordion-Body in Tab4 dunkler + heller Text */
  .app-theme-dark-mode #tab4 .accordion-body {
    background-color: #333 !important;
    color: #ccc !important;
  }

  /*
    >>>> TABELLEN in Tab4 sollen im Dark Mode genauso wie Light Mode bleiben
    >>>> Daher KEINE Overrides mehr für .app-theme-dark-mode #tab4 table ...
  */

  /* (3) Spalten-Ausrichtung (für beide Modi gleich) */
  #tab4 .table-sm td,
  #tab4 .table-sm th {
    text-align: right;
  }
  #tab4 .table-sm td:first-child,
  #tab4 .table-sm th:first-child {
    text-align: left;
  }

  /* (4) Button-Ausrichtung in Tab4 */
  #tab4 .d-flex.gap-2.align-items-center > button {
    margin-top: 0 !important;
    margin-bottom: 0 !important;
  }

  /* (5) (Optional) Slider-Style im Dark Mode heller + Nullmarkierung */
  .app-theme-dark-mode #tab4 input[type="range"] {
    background-color: #666 !important;
    background-image: linear-gradient(to right,
                                      transparent 49.5%,
                                      #bbb 49.5%,
                                      #bbb 50.5%,
                                      transparent 50.5%);
    background-size: 100% 100%;
    background-repeat: no-repeat;
  }
  /* Erzwingt im Dark Mode: Tabellen mit "table-lightmode-same"
   bleiben weißer Hintergrund + schwarze Schrift */
.app-theme-dark-mode .table-lightmode-same,
.app-theme-dark-mode .table-lightmode-same th,
.app-theme-dark-mode .table-lightmode-same td {
  background-color: #fff !important;
  color: #000 !important;
}
/* --------------------------------------------
   1) Grunddesign der Slider
-------------------------------------------- */
.mySlider {
  width: 100%;
  height: 6px;           /* flacher Slider */
  margin: 0;
  -webkit-appearance: none;  /* Entfernt Standardstil in Chrome/Safari */
  background: transparent;   /* wir stylen track/gradients separat */
  outline: none;
  cursor: pointer;
}

/* --------------------------------------------
   2) Slider-Schiene (Light Mode)
-------------------------------------------- */
.mySlider::-webkit-slider-runnable-track {
  height: 6px;
  border-radius: 2px;
  border: 1px solid #ccc; /* Heller Rahmen für Light Mode */
  background: linear-gradient(
    to right,
    transparent 49.5%,
    #666 49.5%, /* dunklere Linie für Mittellinie */
    #666 50.5%,
    transparent 50.5%
  );
}
.mySlider::-webkit-slider-thumb {
  -webkit-appearance: none;
  width: 14px;
  height: 14px;
  margin-top: -4px;  /* Daumen zentrieren auf Schiene */
  background: #666;
  border: 2px solid #999;
  border-radius: 50%;
  cursor: pointer;
}

/* Firefox Equivalent */
.mySlider::-moz-range-track {
  height: 6px;
  border-radius: 2px;
  border: 1px solid #ccc; /* Heller Rahmen für Light Mode */
  background: linear-gradient(
    to right,
    transparent 49.5%,
    #666 49.5%, /* dunklere Linie für Mittellinie */
    #666 50.5%,
    transparent 50.5%
  );
}
.mySlider::-moz-range-thumb {
  width: 14px;
  height: 14px;
  background: #666;
  border: 2px solid #999;
  border-radius: 50%;
  cursor: pointer;
}

/* --------------------------------------------
   3) Slider-Schiene (Dark Mode)
-------------------------------------------- */
.app-theme-dark-mode .mySlider::-webkit-slider-runnable-track {
  border: 1px solid #555; /* Dunklerer Rahmen */
  background: linear-gradient(
    to right,
    transparent 49.5%,
    #bbb 49.5%, /* hellere Linie für Mittellinie */
    #bbb 50.5%,
    transparent 50.5%
  );
}
.app-theme-dark-mode .mySlider::-moz-range-track {
  border: 1px solid #555; /* Dunklerer Rahmen */
  background: linear-gradient(
    to right,
    transparent 49.5%,
    #bbb 49.5%, /* hellere Linie für Mittellinie */
    #bbb 50.5%,
    transparent 50.5%
  );
}

/* --------------------------------------------
   4) Label über dem Slider (unverändert)
-------------------------------------------- */
.slider-label {
  position: absolute;
  top: -22px;   /* Höhe über dem Slider */
  left: 50%;    /* Start in der Mitte */
  transform: translateX(-50%);
  padding: 2px 5px;
  font-size: 0.75rem;
  background: #222;  /* dunkler Hintergrund */
  color: #fff;       /* helle Schrift */
  border-radius: 3px;
  pointer-events: none; /* nicht anklickbar */
  white-space: nowrap;
}


</style>
  <!-- =========================================================
       Dark Mode Toggle Script
      ========================================================= -->
  <script>
    function toggleDarkMode() {
      const appEl = document.getElementById('app');
      appEl.classList.toggle('app-theme-dark-mode');
    }
  </script>
</head>

<body>
  <!-- BEGIN #app => mit .app-sidebar-minified standardmäßig eingeklappt -->
  <div id="app" class="app app-sidebar-minified">

    <!-- BEGIN Header -->
    <div id="header" class="app-header">
      <div class="d-flex align-items-center" style="gap:15px;">
        <button
          type="button"
          class="navbar-desktop-toggler"
          data-toggle="app-sidebar-minify"
        >
          <i class="fa fa-bars"></i>
        </button>
        <a href="/" class="navbar-brand">
          <img src="/static/img/jpc.jpeg" alt="Logo"/>
          <span>JPC CALC V2.0</span>
        </a>
      </div>
      <div class="header-center">
        <div class="me-3">
          <label>Kosten/St.(€):</label>
          <input
            type="text"
            id="txtCosts100"
            class="form-control form-control-sm d-inline-block"
            style="width:70px;"
            readonly
          >
        </div>
        <div>
          <label>CO₂/St. (kg):</label>
          <input
            type="text"
            id="txtCo2Per100"
            class="form-control form-control-sm d-inline-block"
            style="width:70px;"
            readonly
          >
        </div>
      </div>
      <div class="d-flex align-items-center" style="gap:10px;">
        <div id="userInfo" style="display:none;">
          <span id="spanUserEmail"></span>
          <button class="btn btn-sm btn-primary" onclick="doLogout()">Logout</button>
        </div>
        <button class="btn btn-sm btn-info" onclick="window.location.href='/account/'">
          Zu meinem Account
        </button>

        <!-- Unser neu eingefügter Dark-Mode-Button -->
        <button
          class="btn btn-sm btn-outline-secondary"
          onclick="toggleDarkMode()"
        >
          <i class="fa fa-moon me-1"></i> Dark Mode
        </button>
      </div>
    </div>

  <!-- BEGIN Sidebar -->
  <div id="sidebar" class="app-sidebar">
    <div class="app-sidebar-content" data-scrollbar="true" data-height="100%">
      <div class="menu">
        <div class="menu-header">Navigation</div>
        <div class="nav">
          <div class="nav-item">
            <a href="#" class="nav-link">
              <i class="fa fa-home nav-icon"></i>
              <span class="nav-text">Dashboard</span>
            </a>
          </div>
          <div class="nav-item">
            <a href="#" class="nav-link active">
              <i class="fa fa-calculator nav-icon"></i>
              <span class="nav-text">MyCalc</span>
            </a>
          </div>
          <div class="nav-item">
            <a href="/account/" class="nav-link">
              <i class="fa fa-user nav-icon"></i>
              <span class="nav-text">Account</span>
            </a>
          </div>
        </div>
      </div>
    </div>
    <button class="app-sidebar-mobile-backdrop" data-dismiss="sidebar"></button>
  </div>
  <!-- END Sidebar -->

  <!-- BEGIN #content -->
  <div id="content" class="app-content p-3">
    <div class="container-fluid">
      <!-- Tabs-Navigation -->
      <ul class="nav nav-tabs" id="calcTab" role="tablist">
        <li class="nav-item" role="presentation">
          <button
            class="nav-link active"
            id="tab1-tab"
            data-bs-toggle="tab"
            data-bs-target="#tab1"
            type="button"
            role="tab"
            aria-controls="tab1"
            aria-selected="true"
          >
            1) Projektübersicht
          </button>
        </li>
        <li class="nav-item" role="presentation">
          <button
            class="nav-link"
            id="tab2-tab"
            data-bs-toggle="tab"
            data-bs-target="#tab2"
            type="button"
            role="tab"
            aria-controls="tab2"
            aria-selected="false"
          >
            2) Material
          </button>
        </li>
        <li class="nav-item" role="presentation">
          <button
            class="nav-link"
            id="tab3-tab"
            data-bs-toggle="tab"
            data-bs-target="#tab3"
            type="button"
            role="tab"
            aria-controls="tab3"
            aria-selected="false"
          >
            3) Fertigung
          </button>
        </li>
        <li class="nav-item" role="presentation">
          <button
            class="nav-link"
            id="tab4-tab"
            data-bs-toggle="tab"
            data-bs-target="#tab4"
            type="button"
            role="tab"
            aria-controls="tab4"
            aria-selected="false"
          >
            4) Ergebnis
          </button>
        </li>
        <li class="nav-item" role="presentation">
          <button
            class="nav-link"
            id="tab5-tab"
            data-bs-toggle="tab"
            data-bs-target="#tab5"
            type="button"
            role="tab"
            aria-controls="tab5"
            aria-selected="false"
          >
            5) Baugruppe
          </button>
        </li>
      </ul>

      <!-- Tabs-Inhalt -->
      <div class="tab-content" id="myTabContent" style="min-height: 300px; margin-top: 1rem;">
        <!-- TAB 1 -->
        <div
          class="tab-pane fade show active p-3"
          id="tab1"
          role="tabpanel"
          aria-labelledby="tab1-tab"
        >
          <!-- Tab 1: "Projektübersicht" (vorher bg-gray-800 text-white) -->
          <div class="card border-0 card-custom mb-3">
            <div class="card-body">
              <h5 class="mb-3">Parametric Tools</h5>
              <div class="row mb-2">
                <label for="txtProjectName" class="col-sm-3 col-form-label">
                  Projektname
                </label>
                <div class="col-sm-5">
                  <input
                    type="text"
                    class="form-control form-control-sm input-custom"
                    id="txtProjectName"
                    placeholder="Projekt ABC"
                  />
                </div>
              </div>
              <div class="row mb-2">
                <label for="txtPartName" class="col-sm-3 col-form-label">
                  Bauteilname
                </label>
                <div class="col-sm-5">
                  <input
                    type="text"
                    class="form-control form-control-sm input-custom"
                    id="txtPartName"
                    placeholder="Bauteil X"
                  />
                </div>
              </div>
              <div class="row mb-2">
                <label for="annualQty" class="col-sm-3 col-form-label">
                  Jahresstückzahl
                </label>
                <div class="col-sm-3">
                  <input
                    type="number"
                    class="form-control form-control-sm input-custom"
                    id="annualQty"
                    value="1000"
                  />
                </div>
              </div>
              <div class="row mb-2">
                <label for="lotSize" class="col-sm-3 col-form-label">
                  Losgröße
                </label>
                <div class="col-sm-3">
                  <input
                    type="number"
                    class="form-control form-control-sm input-custom"
                    id="lotSize"
                    value="100"
                  />
                </div>
              </div>
              <div class="row mb-2">
                <label for="scrapPct" class="col-sm-3 col-form-label">
                  Globaler Ausschuss (%)
                </label>
                <div class="col-sm-3">
                  <input
                    type="number"
                    step="0.1"
                    class="form-control form-control-sm input-custom"
                    id="scrapPct"
                    value="5.0"
                  />
                </div>
              </div>
              <div class="row mb-2">
                <label for="sgaPct" class="col-sm-3 col-form-label">
                  SG&A (%)
                </label>
                <div class="col-sm-3">
                  <input
                    type="number"
                    step="0.1"
                    class="form-control form-control-sm input-custom"
                    id="sgaPct"
                    value="10.0"
                  />
                </div>
              </div>
              <div class="row mb-2">
                <label for="profitPct" class="col-sm-3 col-form-label">
                  Profit (%)
                </label>
                <div class="col-sm-3">
                  <input
                    type="number"
                    step="0.1"
                    class="form-control form-control-sm input-custom"
                    id="profitPct"
                    value="5.0"
                  />
                </div>
              </div>
              <div class="row mb-2">
                <label for="yearSpin" class="col-sm-3 col-form-label">
                  Kalkulationsjahr
                </label>
                <div class="col-sm-3">
                  <input
                    type="number"
                    class="form-control form-control-sm input-custom"
                    id="yearSpin"
                    value="2024"
                  />
                </div>
              </div>
              <div class="row mb-2">
                <label for="zielPrice" class="col-sm-3 col-form-label">
                  Zielpreis / Stück
                </label>
                <div class="col-sm-3">
                  <input
                    type="number"
                    step="0.01"
                    class="form-control form-control-sm input-custom"
                    id="zielPrice"
                    value="200.00"
                  />
                </div>
              </div>
                        <button class="btn btn-primary mt-3" onclick="calcAll()">
            Berechnen
          </button>
              <button class="btn btn-teal mt-3" onclick="openParamToolsModal()">
                <i class="fa fa-cogs me-1"></i> Parametric Tools
              </button>
            </div>
          </div>
        </div>
        <!-- END Tab1 -->

        <!-- TAB 2 -->
        <div
          class="tab-pane fade p-3"
          id="tab2"
          role="tabpanel"
          aria-labelledby="tab2-tab"
        >
          <h5>Material</h5>
          <button class="btn btn-secondary mb-3" onclick="openMaterialModal()">
            Materialliste laden
          </button>
          <div class="mb-2 row">
            <label class="col-sm-3 col-form-label" for="matName">
              Materialname
            </label>
            <div class="col-sm-4">
              <input
                type="text"
                class="form-control"
                id="matName"
                value="Aluminium"
              />
            </div>
          </div>
          <div class="mb-2 row">
            <label class="col-sm-3 col-form-label" for="matPrice">
              Materialpreis (€/kg)
            </label>
            <div class="col-sm-3">
              <input
                type="number"
                class="form-control"
                step="0.01"
                id="matPrice"
                value="2.0"
              />
            </div>
          </div>
          <div class="mb-2 row">
            <label class="col-sm-3 col-form-label" for="matCo2">
              Material-CO₂ (kg/kg)
            </label>
            <div class="col-sm-3">
              <input
                type="number"
                class="form-control"
                step="0.1"
                id="matCo2"
                value="2.0"
              />
            </div>
          </div>
          <div class="mb-2 row">
            <label class="col-sm-3 col-form-label" for="matGK">
              Material-GK (%)
            </label>
            <div class="col-sm-3">
              <input
                type="number"
                class="form-control"
                step="0.1"
                id="matGK"
                value="5.0"
              />
            </div>
          </div>
          <div class="mb-2 row">
            <label class="col-sm-3 col-form-label" for="matWeight">
              Bauteilgewicht (kg)
            </label>
            <div class="col-sm-3">
              <input
                type="number"
                class="form-control"
                step="0.01"
                id="matWeight"
                value="0.2"
              />
            </div>
          </div>
          <div class="mb-2 row">
            <label class="col-sm-3 col-form-label" for="fremdValue">
              Fremdzukauf (€)
            </label>
            <div class="col-sm-3">
              <input
                type="number"
                class="form-control"
                step="0.01"
                id="fremdValue"
                value="0.0"
              />
            </div>
          </div>

          <button class="btn btn-primary mt-3" onclick="calcAll()">
            Berechnen
          </button>
        </div>
        <!-- END Tab2 -->

        <!-- TAB 3 -->
        <div
          class="tab-pane fade p-3"
          id="tab3"
          role="tabpanel"
          aria-labelledby="tab3-tab"
        >
          <h5>Fertigung</h5>
          <table class="table table-sm table-bordered align-middle" id="fertTable">
            <thead class="text-center">
              <tr>
                <th>Arbeitsschritt</th>
                <th>Zyklus (s)</th>
                <th>MS (€/h)</th>
                <th>Lohn (€/h)</th>
                <th>Rüst (€/Los)</th>
                <th>Tooling/St. (€)</th>
                <th>FGK (%)</th>
                <th>CO₂ (kg/h)</th>
                <th>Kosten/St. (€)</th>
                <th>CO₂/St. (kg)</th>
              </tr>
            </thead>
            <tbody>

              <!-- Dynamische Zeilen per JS -->
            </tbody>
          </table>
          <button class="btn btn-primary mt-3" onclick="calcAll()">
            Berechnen
          </button>
        </div>
        <!-- END Tab3 -->

        <!-- ====================
             TAB 4: ERGEBNIS
             ==================== -->
        <div
          class="tab-pane fade p-3"
          id="tab4"
          role="tabpanel"
          aria-labelledby="tab4-tab"
        >
          <h5>Ergebnis</h5>
<!-- =============== BEGIN SLIDERS & LABELS =============== -->
<div id="sliderContainer" class="text-center p-3 mb-3 border" style="margin-top: 1rem;">
  <div class="d-flex justify-content-around" style="gap: 30px; flex-wrap: wrap;">

    <!-- 1) Material-Slider -->
    <div class="slider-wrapper" style="width: 260px; position: relative;">
      <label class="form-label" style="font-size: 0.8em;">Materialpreis ±30%</label>
      <input
        type="range"
        min="-30"
        max="30"
        step="1"
        value="0"
        oninput="updateSliderLabel(this, 'lblMat'); onSliderMaterialChange(this.value)"
        class="mySlider"
      />
      <span id="lblMat" class="slider-label">0</span>
    </div>

    <!-- 2) Lohn-Slider -->
    <div class="slider-wrapper" style="width: 260px; position: relative;">
      <label class="form-label" style="font-size: 0.8em;">Lohnkosten ±30%</label>
      <input
        type="range"
        min="-30"
        max="30"
        step="1"
        value="0"
        oninput="updateSliderLabel(this, 'lblLohn'); onSliderLaborChange(this.value)"
        class="mySlider"
      />
      <span id="lblLohn" class="slider-label">0</span>
    </div>

    <!-- 3) CO₂-Slider -->
    <div class="slider-wrapper" style="width: 260px; position: relative;">
      <label class="form-label" style="font-size: 0.8em;">CO₂±100% (@380g/kWh)</label>
      <input
        type="range"
        min="-100"
        max="100"
        step="1"
        value="0"
        oninput="updateSliderLabel(this, 'lblCO2'); onSliderCO2Change(this.value)"
        class="mySlider"
      />
      <span id="lblCO2" class="slider-label">0</span>
    </div>

  </div>
</div>
<!-- =============== END SLIDERS & LABELS =============== -->

          <!-- NEU: ApexCharts-Container -->
          <div class="row mb-3">
            <div class="col-md-6">
              <div
                id="apexCostChart"
                style="
                  border: 1px solid #ccc;
                  min-height: 200px;
                  margin-bottom: 1rem;
                "
              ></div>
            </div>
            <div class="col-md-6">
              <div
                id="apexCo2Chart"
                style="
                  border: 1px solid #ccc;
                  min-height: 200px;
                  margin-bottom: 1rem;
                "
              ></div>
            </div>
          </div>

          <!-- Accordion-Bereich für Detailkosten -->
          <div class="accordion mb-3" id="accCostsParent">
            <!-- MATERIAL ACCORDION -->
            <div class="accordion-item">
              <h2 class="accordion-header" id="headingMaterial">
                <button
                  class="accordion-button collapsed"
                  type="button"
                  data-bs-toggle="collapse"
                  data-bs-target="#collapseMaterial"
                  aria-expanded="false"
                  aria-controls="collapseMaterial"
                >
                  Material-Kosten (Details)
                </button>
              </h2>
              <div
                id="collapseMaterial"
                class="accordion-collapse collapse"
                aria-labelledby="headingMaterial"

              >
                <div class="accordion-body">
                  <table class="table table-sm mb-0 table-lightmode-same">
                    <tbody>
                      <tr>
                        <td>Material-Einzelkosten/Stück</td>
                        <td id="tdMatEinzel">0.00</td>
                      </tr>
                      <tr>
                        <td>Fremdzukauf/Stück</td>
                        <td id="tdFremd">0.00</td>
                      </tr>
                                            <tr>
                        <td>Ausschuss (Material)/Stück</td>
                        <td id="tdMatScrapDelta">0.00</td>
                      </tr>
                      <tr>
                        <td>Material-Gemeinkosten/Stück</td>
                        <td id="tdMatGemein">0.00</td>
                      </tr>

                    </tbody>
                    <tfoot>
                      <tr class="table-active">
                        <th>Summe Material/Stück</th>
                        <th id="tdMatSumDetailed">0.00</th>
                      </tr>
                    </tfoot>
                  </table>
                </div>
              </div>
            </div>

            <!-- FERTIGUNG ACCORDION -->
            <div class="accordion-item">
              <h2 class="accordion-header" id="headingFertigung">
                <button
                  class="accordion-button collapsed"
                  type="button"
                  data-bs-toggle="collapse"
                  data-bs-target="#collapseFertigung"
                  aria-expanded="false"
                  aria-controls="collapseFertigung"
                >
                  Fertigungs-Kosten (Details)
                </button>
              </h2>
              <div
                id="collapseFertigung"
                class="accordion-collapse collapse"
                aria-labelledby="headingFertigung"

              >
                <div class="accordion-body">
                  <table class="table table-sm mb-0 table-lightmode-same">
                    <tbody>
                      <tr>
                        <td>Maschinenkosten/Stück</td>
                        <td id="tdMach">0.00</td>
                      </tr>
                      <tr>
                        <td>Lohnkosten/Stück</td>
                        <td id="tdLohn">0.00</td>
                      </tr>

                      <tr>
                        <td>Rüstkosten/Stück</td>
                        <td id="tdRuestDetailed">0.00</td>
                      </tr>
                      <tr>
                        <td>Tooling/Stück</td>
                        <td id="tdToolingDetailed">0.00</td>
                      </tr>
                      <tr>
                        <td>Ausschuss (Fertigung)/Stück</td>
                        <td id="tdFertScrapDelta">0.00</td>
                      </tr>
                                          <tr>
                        <td>Fertigungsgemeinkosten/Stück</td>
                        <td id="tdFGK">0.00</td>
                      </tr>
                    </tbody>
                    <tfoot>
                      <tr class="table-active">
                        <th>Summe Fertigung/Stück</th>
                        <th id="tdFertSumDetailed">0.00</th>
                      </tr>
                    </tfoot>
                  </table>
                </div>
              </div>
            </div>
          </div>
          <!-- Ende Accordion -->

          <!-- Summenzeilen unten drunter -->
          <table class="table table-striped table-sm table-lightmode-same">
            <tbody>
              <tr>
                <td>Herstellkosten/Stück</td>
                <td id="tdHerstell">0.00</td>
              </tr>
              <tr>
                <td>SG&A</td>
                <td id="tdSGA">0.00</td>
              </tr>
              <tr>
                <td>Profit</td>
                <td id="tdProfit">0.00</td>
              </tr>
              <tr>
                <th>Gesamtkosten/Stück</th>
                <th id="tdTotal">0.00</th>
              </tr>
            </tbody>
          </table>
          <div class="d-flex gap-2 align-items-center mt-2">
          <button class="btn btn-primary mt-3" onclick="calcAll()">
            Berechnen
          </button>
          <button class="btn btn-primary mt-3" onclick="addResultToBaugruppeFromTab4()">
            In Baugruppe übernehmen

          <button class="btn btn-indigo mt-2" onclick="export8StepsExcel()">
            <i class="fa fa-file-excel me-1"></i> Excel Export 8 Schritte
          </button>
          <button class="btn btn-orange mt-2" onclick="exportBaugruppenPowerPoint()">
            <i class="fa fa-file-powerpoint me-1"></i> PDF Export Baugruppen
          </button>
            </div>
        </div>
        <!-- END Tab4 -->

        <!-- TAB 5: Baugruppe -->
        <div
          class="tab-pane fade p-3 d-flex flex-column align-items-start"
          id="tab5"
          role="tabpanel"
          aria-labelledby="tab5-tab"
        >
          <h4>Baugruppenliste</h4>
          <table
            id="baugruppeTable"
            class="table table-sm"
            style="margin-bottom: 10px;"
          >
            <thead>
              <tr>
                <th>Bauteilname</th>
                <th>Verfahren</th>
                <th>MatEinzel</th>
                <th>MatGemein</th>
                <th>Fremd</th>
                <th>Mach</th>
                <th>Lohn</th>
                <th>FGK</th>
                <th>Herstell</th>
                <th>SGA</th>
                <th>Profit</th>
                <th>Total</th>
                <th>CO₂/100</th>
              </tr>
            </thead>
            <tbody>
              <!-- Dynamische Einträge via JS (renderBaugruppeItems) -->
            </tbody>
            <tfoot>
              <tr>
                <th>Summe:</th>
                <td></td> <!-- leer für Verfahren-Spalte -->
                <td id="bgSumMatEinzel"></td>
                <td id="bgSumMatGemein"></td>
                <td id="bgSumFremd"></td>
                <td id="bgSumMach"></td>
                <td id="bgSumLohn"></td>
                <td id="bgSumFGK"></td>
                <td id="bgSumHerstell"></td>
                <td id="bgSumSGA"></td>
                <td id="bgSumProfit"></td>
                <td id="bgSumTotal"></td>
                <td id="bgSumCO2"></td>
              </tr>
            </tfoot>
          </table>
          <div id="baugruppeSumArea" class="d-flex flex-wrap gap-2 align-items-center">
            <button class="btn btn-primary mt-3" onclick="calcBaugruppeSum()">
              Gesamtsumme
            </button>
            <button class="btn btn-primary mt-3" onclick="resetBaugruppenListe()">
              Liste zurücksetzen
            </button>
            <button class="btn btn-primary mt-3" onclick="addManualBaugruppe()">
              Manuell hinzufügen
            </button>
            <button class="btn btn-primary mt-3" onclick="exportBaugruppenAsCSV()">
              Export als CSV
            </button>
          </div>
        </div>
        <!-- Ende von Tab 5 -->

        <!-- KI-Assistent (Beta) -->
        <div class="card mt-3">
          <div class="card-header">
            <h5>KI-Assistent (Beta)</h5>
          </div>
          <div class="card-body">
            <label for="gptQuestion" class="form-label">Deine Frage:</label>
            <input
              type="text"
              id="gptQuestion"
              class="form-control"
              placeholder="Z.B. Was ist FGK?"
            />
            <button
              class="btn btn-primary btn-sm mt-2"
              onclick="onAskGPT('gptQuestion', 'gptAnswer')"
            >
              Fragen
            </button>
            <div
              id="gptAnswer"
              class="mt-3 p-2 border bg-light"
              style="min-height:40px; white-space:pre-wrap;"
            ></div>
          </div>
        </div>
        <!-- End KI-Assistent -->
      </div>
    </div>
  </div>
  <!-- END #content -->
</div><!-- .tab-content -->

<!--
Erklärung:
.card.border-0.bg-gray-800.text-white: dunkelgraue Card (ColorAdmin-Theme).
class="form-control form-control-sm bg-dark text-white": passt für Inputs auf dunklem Hintergrund.
btn btn-teal: ein ColorAdmin-Farbton.
-->
<div
  class="modal fade"
  id="modalParamTools"
  tabindex="-1"
  aria-hidden="true"
>
  <div class="modal-dialog modal-lg">
    <div class="modal-content">

      <div class="modal-header">
        <h5 class="modal-title">Parametric Tools</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>

      <div class="modal-body">
        <p>Wähle deinen Prozess:</p>
        <div class="d-flex flex-wrap justify-content-between">
          <!-- Feinguss -->
          <div class="text-center m-2">
            <img
              src="/static/img/feinguss.jpeg"
              alt="Feinguss"
              class="img-choice"
              onclick="openFeingussModal()"
              style="width: 150px; height: auto; cursor: pointer;"
            />
            <p>Feinguss</p>
          </div>
          <!-- Schmieden -->
          <div class="text-center m-2">
            <img
              src="/static/img/schmieden.jpeg"
              alt="Schmieden"
              class="img-choice"
              onclick="openSchmiedenModalSafe()"
              style="width: 150px; height: auto; cursor: pointer;"
            />
            <p>Schmieden</p>
          </div>
          <!-- Kaltfließpressen -->
          <div class="text-center m-2">
            <img
              src="/static/img/kaltfliess.jpeg"
              alt="Kaltfließpressen"
              class="img-choice"
              onclick="openKaltfliessModalSafe()"
              style="width: 150px; height: auto; cursor: pointer;"
            />
            <p>Kaltfließpressen</p>
          </div>
          <!-- PCB-Parametrik -->
          <div class="text-center m-2">
            <img
              src="/static/img/pcb_logo.jpeg"
              alt="PCB-Parametrik"
              class="img-choice"
              onclick="openPcbModalSafe()"
              style="width: 150px; height: auto; cursor: pointer;"
            />
            <p>PCB-Parametrik</p>
          </div>
        </div>
      </div>

      <div class="modal-footer">
        <button
          type="button"
          class="btn btn-secondary"
          data-bs-dismiss="modal"
        >
          Schließen
        </button>
      </div>

    </div> <!-- .modal-content -->
  </div> <!-- .modal-dialog -->
</div> <!-- #modalParamTools -->

<!-- =============== FEINGUSS MODAL (feingussModal) =============== -->

<!-- =================== FEINGUSS-PARAMETRIC V2 (DESIGN-ADAPTIERT) =================== -->
<div class="modal fade" id="feingussModal" tabindex="-1" aria-labelledby="feingussModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-xl" style="max-width:1000px;">
    <div class="modal-content" style="font-size: 0.9rem;">

      <!-- HEADER -->
      <div class="modal-header bg-theme text-white" style="padding: 0.6rem 1rem;">
        <h5 class="modal-title" id="feingussModalLabel">Feinguss-Parametric V2</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Schließen"></button>
      </div>

      <!-- BODY -->
      <div class="modal-body p-2">

        <!-- NAV-TABS (Basis / Erweitert) -->
        <ul class="nav nav-tabs nav-tabs-v2" id="fgTabs" role="tablist" style="margin-bottom: 0.5rem;">
          <li class="nav-item" role="presentation">
            <button
              class="nav-link active"
              id="fg-tab-basis"
              data-bs-toggle="tab"
              data-bs-target="#fgTabBasis"
              type="button"
              role="tab"
              aria-controls="fgTabBasis"
              aria-selected="true"
            >
              Basis
            </button>
          </li>
          <li class="nav-item" role="presentation">
            <button
              class="nav-link"
              id="fg-tab-erweitert"
              data-bs-toggle="tab"
              data-bs-target="#fgTabErweitert"
              type="button"
              role="tab"
              aria-controls="fgTabErweitert"
              aria-selected="false"
            >
              Erweitert
            </button>
          </li>
        </ul>

        <div class="tab-content mt-2" id="fgTabContent">
          <!-- TAB 1: BASIS -->
          <div
            class="tab-pane fade show active"
            id="fgTabBasis"
            role="tabpanel"
            aria-labelledby="fg-tab-basis"
          >
            <div class="row mb-2">
              <div class="col-md-6">
                <label class="form-label fw-bold mb-1">Legierung / Material</label>
                <select id="fgMatSelect" class="form-select form-select-sm">
                  <option value="Stahl">Stahl (Allg.)</option>
                  <option value="Alu">Aluminium</option>
                  <option value="Titan">Titan</option>
                  <option value="NickelAlloy">Nickelbasis-Legierung</option>
                </select>
              </div>
              <div class="col-md-6">
                <label class="form-label fw-bold mb-1">Standort</label>
                <select id="fgLocationSelect" class="form-select form-select-sm">
                  <option value="DE">Deutschland</option>
                  <option value="CN">China</option>
                  <option value="PL">Polen</option>
                </select>
              </div>
            </div>

            <div class="row mb-2">
              <div class="col-md-6">
                <label class="form-label fw-bold mb-1">Gewicht (g)</label>
                <input
                  type="number"
                  id="fgWeight"
                  class="form-control form-control-sm"
                  value="50"
                  step="1"
                />
              </div>
              <div class="col-md-6">
                <label class="form-label fw-bold mb-1">Ausschuss (%)</label>
                <input
                  type="number"
                  id="fgScrapRate"
                  class="form-control form-control-sm"
                  value="5"
                  step="0.1"
                />
              </div>
            </div>

            <div class="row mb-2">
              <div class="col-md-6">
                <label class="form-label fw-bold mb-1">Jahresmenge</label>
                <input
                  type="number"
                  id="fgQuantity"
                  class="form-control form-control-sm"
                  value="1000"
                  step="1"
                />
              </div>
            </div>
          </div><!-- #fgTabBasis -->

          <!-- TAB 2: ERWEITERT -->
          <div
            class="tab-pane fade"
            id="fgTabErweitert"
            role="tabpanel"
            aria-labelledby="fg-tab-erweitert"
          >
            <div class="row mb-2">
              <div class="col-md-6">
                <label class="form-label fw-bold mb-1">Komplexität</label>
                <select id="fgComplexitySelect" class="form-select form-select-sm">
                  <option value="Low">Low</option>
                  <option value="Medium" selected>Medium</option>
                  <option value="High">High</option>
                </select>
              </div>
              <div class="col-md-6">
                <label class="form-label fw-bold mb-1">Rüstzeit (min/Jahr)</label>
                <input
                  type="number"
                  id="fgSetupTimeMin"
                  class="form-control form-control-sm"
                  value="60"
                  step="1"
                />
              </div>
            </div>

            <div class="row mb-2">
              <div class="col-md-6">
                <label class="form-label fw-bold mb-1">Overhead (%)</label>
                <input
                  type="number"
                  id="fgOverheadRate"
                  class="form-control form-control-sm"
                  value="15"
                  step="1"
                />
              </div>
              <div class="col-md-6">
                <label class="form-label fw-bold mb-1">Gewinnrate (%)</label>
                <input
                  type="number"
                  id="fgProfitRate"
                  class="form-control form-control-sm"
                  value="10"
                  step="1"
                />
              </div>
            </div>

            <div class="row mb-2">
              <div class="col-md-6">
                <label class="form-label fw-bold mb-1">Werkzeugkosten (€)</label>
                <input
                  type="number"
                  id="fgToolCost"
                  class="form-control form-control-sm"
                  value="0"
                  step="50"
                />
              </div>
              <div class="col-md-6">
                <label class="form-label fw-bold mb-1">Nachbearb. (min/Teil)</label>
                <input
                  type="number"
                  id="fgPostProcMin"
                  class="form-control form-control-sm"
                  value="0.5"
                  step="0.1"
                />
              </div>
            </div>
          </div><!-- #fgTabErweitert -->
        </div><!-- .tab-content -->

        <hr />

        <!-- Ergebnis + Chart -->
        <div class="row">
          <div class="col-md-6">
            <div class="table-responsive mb-2">
              <table class="table table-sm table-bordered">
                <thead class="table-light">
                  <tr>
                    <th>Parameter/Kostenblock</th>
                    <th>Wert</th>
                  </tr>
                </thead>
                <tbody id="fgTableBody">
                  <!-- 5 Zeilen dynamisch -->
                </tbody>
              </table>
            </div>
          </div>
          <div class="col-md-6 text-center">
            <canvas
              id="fgCostChart"
              width="240"
              height="240"
              style="border:1px solid #ccc;"
            ></canvas>
          </div>
        </div>
        <div id="FGChatBubble">
          <img
            src="https://cdn-icons-png.flaticon.com/512/2990/2990675.png"
            alt="Chat"
            onclick="toggleFGChatWindow()"
          />
        </div>

        <div id="FGChatWindow">
          <div class="header">KI-Assistent</div>
          <div class="body">
            <p>Hallo, wie kann ich helfen?</p>
          </div>
          <div class="footer d-flex align-items-center" style="gap:5px;">
            <!-- NEU: Eingabefeld + Senden-Button -->
            <input
              type="text"
              id="FGChatInput"
              class="form-control form-control-sm"
              placeholder="Frage eingeben..."
              style="flex:1;"
            />



            <button class="btn btn-sm btn-primary" onclick="sendFGChat()">Senden</button>
            <button class="btn btn-sm btn-secondary" onclick="toggleFGChatWindow()">Schließen</button>
          </div>
        </div>
      </div><!-- .modal-body -->

      <!-- FOOTER -->
      <div class="modal-footer d-flex justify-content-between align-items-center" style="padding: 0.5rem 1rem;">
        <div>
                    <button
      type="button"
      class="btn btn-info btn-sm"
      onclick="askFGPredefined('Wie verwende ich das Feinguss-Parametrik-Tool')"
    >
      <i class="fa fa-question-circle me-1"></i> Advisor
    </button>
          <button
            type="button"
            class="btn btn-sm btn-theme me-2"
            id="fgCalcBtn"
            onclick="calculateFeingussParametricV2()"
          >
            <i class="fa fa-calculator me-1"></i> Berechnen
          </button>

          <button
            type="button"
            class="btn btn-sm btn-secondary"
            data-bs-dismiss="modal"
          >
            <i class="fa fa-times me-1"></i> Schließen
          </button>
        </div>
      </div>

    </div><!-- .modal-content -->
  </div><!-- .modal-dialog -->
</div><!-- #feingussModal -->

<!-- ============== SCHMIEDEN-MODAL ============== -->
<!-- =================== SCHMIEDEN-KALKULATOR (PARAMETRIC) - DESIGN-ADAPTIERT =================== -->
<div class="modal fade" id="schmiedenModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-xl" style="max-width:1000px;">
    <!-- Übernimmt Design-Komponenten analog zum Beispiel -->
    <div class="modal-content" style="font-size: 0.9rem; max-height: 85vh; overflow-y: auto;">

      <!-- HEADER (Farbe & Styling übernommen) -->
      <div class="modal-header bg-theme text-white" style="padding: 0.6rem 1rem;">
        <h5 class="modal-title">Schmieden-Kalkulator (Parametric)</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
      </div>

      <!-- BODY (Tabs + Inhalt) -->
      <div class="modal-body p-2">
        <!-- === NAV TABS (Eingaben / Erweitert) - mit nav-tabs-v2 === -->
        <ul class="nav nav-tabs nav-tabs-v2" id="schmiedenTabs" role="tablist" style="margin-bottom: 0.5rem;">
          <li class="nav-item" role="presentation">
            <button
              class="nav-link active"
              id="schmieden-tab-input"
              data-bs-toggle="tab"
              data-bs-target="#schmieden-tabpane-input"
              type="button"
              role="tab"
            >
              Eingaben
            </button>
          </li>
          <li class="nav-item" role="presentation">
            <button
              class="nav-link"
              id="schmieden-tab-adv"
              data-bs-toggle="tab"
              data-bs-target="#schmieden-tabpane-adv"
              type="button"
              role="tab"
            >
              Erweitert
            </button>
          </li>
        </ul>

        <div class="tab-content p-3" id="schmiedenTabsContent">
          <!-- =========== TAB 1: EINGABEN =========== -->
          <div
            class="tab-pane fade show active"
            id="schmieden-tabpane-input"
            role="tabpanel"
          >
            <!-- Material -->
            <div class="row mb-3">
              <label for="schmiedenMaterial" class="col-sm-4 col-form-label">
                Material:
              </label>
              <div class="col-sm-5">
                <select class="form-select form-select-sm" id="schmiedenMaterial">
                  <option>C45 (Stahl)</option>
                  <option>42CrMo4</option>
                  <option>Alu 6082</option>
                </select>
              </div>
            </div>

            <!-- Land (DE / CN) -->
            <div class="row mb-3">
              <label for="schmiedenCountry" class="col-sm-4 col-form-label">
                Land
              </label>
              <div class="col-sm-5">
                <select class="form-select form-select-sm" id="schmiedenCountry">
                  <option>DE</option>
                  <option>CN</option>
                </select>
              </div>
            </div>

            <!-- Teilgewicht (Fertig, in kg) -->
            <div class="row mb-3">
              <label for="schmiedenPartWeight" class="col-sm-4 col-form-label">
                Fertig-Gewicht (kg)
              </label>
              <div class="col-sm-5">
                <input
                  type="number"
                  class="form-control form-control-sm"
                  id="schmiedenPartWeight"
                  step="0.001"
                  value="0.50"
                />
              </div>
            </div>

            <!-- Losgröße -->
            <div class="row mb-3">
              <label for="schmiedenLos" class="col-sm-4 col-form-label">
                Losgröße
              </label>
              <div class="col-sm-5">
                <input
                  type="number"
                  class="form-control form-control-sm"
                  id="schmiedenLos"
                  step="1"
                  value="10000"
                />
              </div>
            </div>
          </div>

          <!-- =========== TAB 2: ERWEITERT =========== -->
          <div
            class="tab-pane fade"
            id="schmieden-tabpane-adv"
            role="tabpanel"
          >
            <!-- Verschnitt (%) -->
            <div class="row mb-3">
              <label for="schmiedenScrapPct" class="col-sm-4 col-form-label">
                Verschnitt (%)
              </label>
              <div class="col-sm-5">
                <input
                  type="number"
                  class="form-control form-control-sm"
                  id="schmiedenScrapPct"
                  step="0.1"
                  value="15"
                />
              </div>
            </div>

            <!-- proj. Querschnitt (cm²) -->
            <div class="row mb-3">
              <label for="schmiedenArea" class="col-sm-4 col-form-label">
                proj. Querschnitt (cm²)
              </label>
              <div class="col-sm-5">
                <input
                  type="number"
                  class="form-control form-control-sm"
                  id="schmiedenArea"
                  step="0.1"
                  value="10.0"
                />
              </div>
            </div>

            <!-- Rüstzeit (min) -->
            <div class="row mb-3">
              <label for="schmiedenRuestMin" class="col-sm-4 col-form-label">
                Rüstzeit (min)
              </label>
              <div class="col-sm-5">
                <input
                  type="number"
                  class="form-control form-control-sm"
                  id="schmiedenRuestMin"
                  step="1"
                  value="60"
                />
              </div>
            </div>
          </div>
        </div><!-- /.tab-content -->

        <!-- ========== ERGEBNISBEREICH (3-spaltig) ========== -->
        <hr />
        <div class="row" id="schmiedenResultRow">
          <!-- TEXT-Result -->
          <div class="col-sm-4" id="schmiedenResultText" style="font-size:0.85rem;">
            <!-- Dynamisch gefüllt via JS -->
          </div>
          <!-- COST Chart -->
          <div class="col-sm-4 text-center">
            <canvas
              id="schmiedenCostChart"
              width="200"
              height="200"
              style="border:1px solid #ccc;"
            ></canvas>
          </div>
          <!-- CO2 Chart -->
          <div class="col-sm-4 text-center">
            <canvas
              id="schmiedenCo2Chart"
              width="200"
              height="200"
              style="border:1px solid #ccc;"
            ></canvas>
          </div>
        </div>
      </div><!-- /.modal-body -->

      <!-- FOOTER (Buttons & Styling analog) -->
      <div class="modal-footer d-flex justify-content-between align-items-center" style="padding: 0.5rem 1rem;">
        <div>
          <button
            type="button"
            class="btn btn-sm btn-theme me-2"
            onclick="calculateSchmieden()"
          >
            <i class="fa fa-calculator me-1"></i> Berechnen
          </button>
          <button
            type="button"
            class="btn btn-sm btn-secondary"
            data-bs-dismiss="modal"
          >
            <i class="fa fa-times me-1"></i> Schließen
          </button>
        </div>
      </div>

    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- #schmiedenModal -->
<!-- End SchmiedenModal -->


<!-- ============== KALTFLIESS-MODAL ============== -->
<!-- =================== KALTFLIESSPRESSEN – PARAMETRIK (DESIGN-ADAPTIERT) =================== -->
<div class="modal fade" id="kaltfliessModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-xl" style="max-width:1000px;">
    <div class="modal-content" style="font-size: 0.9rem; max-height: 85vh; overflow-y: auto;">

      <!-- HEADER (Design analog zu "Maschinenstundensatz") -->
      <div class="modal-header bg-theme text-white" style="padding: 0.6rem 1rem;">
        <h5 class="modal-title">Kaltfließpressen – Parametrik</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
      </div>

      <!-- BODY -->
      <div class="modal-body p-2">
        <!-- NAV-TABS (Eingaben / Erweitert) -->
        <ul class="nav nav-tabs nav-tabs-v2" id="kaltfliessTabs" role="tablist" style="margin-bottom: 0.5rem;">
          <li class="nav-item" role="presentation">
            <button
              class="nav-link active"
              id="kaltfliess-tab-input"
              data-bs-toggle="tab"
              data-bs-target="#kaltfliess-tabpane-input"
              type="button"
              role="tab"
            >
              Eingaben
            </button>
          </li>
          <li class="nav-item" role="presentation">
            <button
              class="nav-link"
              id="kaltfliess-tab-adv"
              data-bs-toggle="tab"
              data-bs-target="#kaltfliess-tabpane-adv"
              type="button"
              role="tab"
            >
              Erweitert
            </button>
          </li>
        </ul>

        <div class="tab-content p-3" id="kaltfliessTabsContent">
          <!-- TAB 1: EINGABEN -->
          <div
            class="tab-pane fade show active"
            id="kaltfliess-tabpane-input"
            role="tabpanel"
          >
            <!-- Material -->
            <div class="row mb-3">
              <label for="kaltfliessMatSelect" class="col-sm-4 col-form-label">
                Material
              </label>
              <div class="col-sm-5">
                <select class="form-select form-select-sm" id="kaltfliessMatSelect">
                  <option>C10 (Stahl)</option>
                  <option>C35 (Stahl)</option>
                  <option>Alu6060</option>
                  <option>Edelstahl304</option>
                </select>
              </div>
            </div>

            <!-- Land -->
            <div class="row mb-3">
              <label for="kaltfliessCountry" class="col-sm-4 col-form-label">
                Land
              </label>
              <div class="col-sm-5">
                <select class="form-select form-select-sm" id="kaltfliessCountry">
                  <option>DE</option>
                  <option>CN</option>
                </select>
              </div>
            </div>

            <!-- Bauteilgewicht (g) -->
            <div class="row mb-3">
              <label for="kaltfliessWeight" class="col-sm-4 col-form-label">
                Bauteilgewicht (g)
              </label>
              <div class="col-sm-5">
                <input
                  type="number"
                  class="form-control form-control-sm"
                  id="kaltfliessWeight"
                  step="0.1"
                  value="50.0"
                />
              </div>
            </div>

            <!-- Losgröße -->
            <div class="row mb-3">
              <label for="kaltfliessLos" class="col-sm-4 col-form-label">
                Losgröße
              </label>
              <div class="col-sm-5">
                <input
                  type="number"
                  class="form-control form-control-sm"
                  id="kaltfliessLos"
                  step="1"
                  value="10000"
                />
              </div>
            </div>
          </div>

          <!-- TAB 2: ERWEITERT -->
          <div
            class="tab-pane fade"
            id="kaltfliess-tabpane-adv"
            role="tabpanel"
          >
            <!-- Umform-Stufen -->
            <div class="row mb-3">
              <label for="kaltfliessStufen" class="col-sm-4 col-form-label">
                Umform-Stufen
              </label>
              <div class="col-sm-5">
                <input
                  type="number"
                  class="form-control form-control-sm"
                  id="kaltfliessStufen"
                  step="1"
                  value="3"
                />
              </div>
            </div>

            <!-- Rüstzeit (min) -->
            <div class="row mb-3">
              <label for="kaltfliessRuestMin" class="col-sm-4 col-form-label">
                Rüstzeit (min)
              </label>
              <div class="col-sm-5">
                <input
                  type="number"
                  class="form-control form-control-sm"
                  id="kaltfliessRuestMin"
                  step="1"
                  value="60"
                />
              </div>
            </div>

            <!-- Komplex => -20% Hub/min -->
            <div class="row mb-3">
              <div class="col-sm-4"></div>
              <div class="col-sm-8">
                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="kaltfliessKomplex"
                  />
                  <label class="form-check-label" for="kaltfliessKomplex">
                    Komplex => -20% Hub/min
                  </label>
                </div>
              </div>
            </div>

            <!-- Automatische Maschinenwahl? -->
            <div class="row mb-3">
              <div class="col-sm-4"></div>
              <div class="col-sm-8">
                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="kaltfliessAutoMach"
                    checked
                  />
                  <label class="form-check-label" for="kaltfliessAutoMach">
                    Maschine automatisch wählen?
                  </label>
                </div>
              </div>
            </div>

            <!-- Manuelle Maschine-Combo -->
            <div class="row mb-3">
              <label for="kaltfliessMachineCombo" class="col-sm-4 col-form-label">
                Manuelle Maschine:
              </label>
              <div class="col-sm-5">
                <select class="form-select form-select-sm" id="kaltfliessMachineCombo" disabled>
                  <option>200 t</option>
                  <option>400 t</option>
                  <option>600 t</option>
                </select>
              </div>
            </div>
          </div><!-- #kaltfliess-tabpane-adv -->
        </div><!-- .tab-content -->

        <!-- =========== ERGEBNISBEREICH (3 Spalten) =========== -->
        <hr />
        <div class="row">
          <div class="col-sm-4" id="kaltfliessResultText" style="font-size:0.85rem;">
            <!-- Dynamisch gefüllt -->
          </div>
          <div class="col-sm-4 text-center">
            <canvas
              id="kaltfliessCostChart"
              width="200"
              height="200"
              style="border:1px solid #ccc;"
            ></canvas>
          </div>
          <div class="col-sm-4 text-center">
            <canvas
              id="kaltfliessCo2Chart"
              width="200"
              height="200"
              style="border:1px solid #ccc;"
            ></canvas>
          </div>
        </div>
      </div><!-- /.modal-body -->

      <!-- FOOTER (Design-Farben & Buttons) -->
      <div class="modal-footer d-flex justify-content-between align-items-center" style="padding: 0.5rem 1rem;">
        <div>
          <button
            type="button"
            class="btn btn-sm btn-theme me-2"
            onclick="calculateKaltfliess()"
          >
            <i class="fa fa-calculator me-1"></i> Berechnen
          </button>
          <button
            type="button"
            class="btn btn-sm btn-secondary"
            data-bs-dismiss="modal"
          >
            <i class="fa fa-times me-1"></i> Schließen
          </button>
        </div>
      </div>

    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- #kaltfliessModal --><!-- End KaltfliessModal -->
<!-- =================== PCB-KALKULATOR (PARAMETRIK) - DESIGN-ADAPTIERT =================== -->
<div class="modal fade" id="pcbModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-xl" style="max-width:1000px;">
    <div class="modal-content" style="font-size: 0.9rem; max-height: 85vh; overflow-y: auto;">

      <!-- HEADER -->
      <div class="modal-header bg-theme text-white" style="padding: 0.6rem 1rem;">
        <h5 class="modal-title">PCB-Kalkulator (Parametrik)</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
      </div>

      <!-- BODY: position relative -->
      <div class="modal-body p-2 position-relative">
        <!-- NAV-TABS -->
        <ul class="nav nav-tabs nav-tabs-v2" id="pcbTabs" role="tablist" style="margin-bottom: 0.5rem;">
          <li class="nav-item" role="presentation">
            <button
              class="nav-link active"
              id="pcb-tab-input"
              data-bs-toggle="tab"
              data-bs-target="#pcb-tabpane-input"
              type="button"
              role="tab"
            >
              Eingaben
            </button>
          </li>
          <li class="nav-item" role="presentation">
            <button
              class="nav-link"
              id="pcb-tab-adv"
              data-bs-toggle="tab"
              data-bs-target="#pcb-tabpane-adv"
              type="button"
              role="tab"
            >
              Erweitert
            </button>
          </li>
        </ul>

        <div class="tab-content p-3" id="pcbTabContent">
          <!-- TAB 1: EINGABEN -->
          <div
            class="tab-pane fade show active"
            id="pcb-tabpane-input"
            role="tabpanel"
          >
            <!-- L x B (mm) -->
            <div class="row mb-3">
              <label class="col-sm-4 col-form-label">
                Abmessung:
              </label>
              <div class="col-sm-5 d-flex flex-wrap gap-2">
                <div class="input-group input-group-sm" style="width: 48%;">
                  <span class="input-group-text">L (mm)</span>
                  <input
                    type="number"
                    class="form-control"
                    id="pcbLen"
                    step="1"
                    value="100"
                  />
                </div>
                <div class="input-group input-group-sm" style="width: 48%;">
                  <span class="input-group-text">B (mm)</span>
                  <input
                    type="number"
                    class="form-control"
                    id="pcbWid"
                    step="1"
                    value="80"
                  />
                </div>
              </div>
            </div>

            <!-- Lagenzahl -->
            <div class="row mb-3">
              <label for="pcbLayer" class="col-sm-4 col-form-label">
                Lagenzahl
              </label>
              <div class="col-sm-5">
                <select class="form-select form-select-sm" id="pcbLayer">
                  <option>2</option>
                  <option>4</option>
                  <option>6</option>
                  <option>8</option>
                </select>
              </div>
            </div>

            <!-- Stückzahl -->
            <div class="row mb-3">
              <label for="pcbQty" class="col-sm-4 col-form-label">
                Stückzahl
              </label>
              <div class="col-sm-5">
                <input
                  type="number"
                  class="form-control form-control-sm"
                  id="pcbQty"
                  step="1"
                  value="1000"
                />
              </div>
            </div>

            <!-- Land -->
            <div class="row mb-3">
              <label for="pcbLand" class="col-sm-4 col-form-label">
                Land (Fertigung)
              </label>
              <div class="col-sm-5">
                <select class="form-select form-select-sm" id="pcbLand">
                  <option>China</option>
                  <option>Europa</option>
                  <option>Sonst</option>
                </select>
              </div>
            </div>
          </div>

          <!-- TAB 2: ERWEITERT -->
          <div
            class="tab-pane fade"
            id="pcb-tabpane-adv"
            role="tabpanel"
          >
            <!-- Dicke -->
            <div class="row mb-3">
              <label for="pcbThick" class="col-sm-4 col-form-label">
                PCB-Dicke (mm)
              </label>
              <div class="col-sm-5">
                <input
                  type="number"
                  class="form-control form-control-sm"
                  id="pcbThick"
                  step="0.01"
                  value="1.6"
                />
              </div>
            </div>

            <!-- Kupferdicke -->
            <div class="row mb-3">
              <label for="pcbCu" class="col-sm-4 col-form-label">
                Kupferdicke
              </label>
              <div class="col-sm-5">
                <select class="form-select form-select-sm" id="pcbCu">
                  <option>35µm</option>
                  <option>70µm</option>
                </select>
              </div>
            </div>

            <!-- Finish -->
            <div class="row mb-3">
              <label for="pcbFinish" class="col-sm-4 col-form-label">
                Oberfläche (Finish)
              </label>
              <div class="col-sm-5">
                <select class="form-select form-select-sm" id="pcbFinish">
                  <option>HASL</option>
                  <option>ENIG</option>
                  <option>OSP</option>
                </select>
              </div>
            </div>

            <!-- Tooling-Kosten -->
            <div class="row mb-3">
              <label for="pcbTooling" class="col-sm-4 col-form-label">
                Tooling-Kosten (€)
              </label>
              <div class="col-sm-5">
                <input
                  type="number"
                  class="form-control form-control-sm"
                  id="pcbTooling"
                  step="1"
                  value="200"
                />
              </div>
            </div>

            <!-- CheckBox: "Einfache Bestückung?" -->
            <div class="row mb-3">
              <div class="col-sm-4"></div>
              <div class="col-sm-8">
                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="pcbAssemblyCheck"
                  />
                  <label
                    class="form-check-label"
                    for="pcbAssemblyCheck"
                  >
                    Einfache Bestückung berücksichtigen?
                  </label>
                </div>
              </div>
            </div>

            <!-- SMD / THT Felder -->
            <div class="row mb-3">
              <label for="pcbSmdCount" class="col-sm-4 col-form-label">
                SMD-Bauteile (Anzahl)
              </label>
              <div class="col-sm-5">
                <input
                  type="number"
                  class="form-control form-control-sm"
                  id="pcbSmdCount"
                  step="1"
                  value="50"
                />
              </div>
            </div>

            <div class="row mb-3">
              <label for="pcbThtCount" class="col-sm-4 col-form-label">
                THT-Pins (Anzahl)
              </label>
              <div class="col-sm-5">
                <input
                  type="number"
                  class="form-control form-control-sm"
                  id="pcbThtCount"
                  step="1"
                  value="10"
                />
              </div>
            </div>
          </div>
        </div><!-- .tab-content -->

        <!-- Ergebnis-Bereich -->
        <hr />
        <div class="row">
          <div class="col-sm-4" id="pcbResultText" style="font-size:0.85rem;">
            <!-- Dynamisch gefüllt -->
          </div>
          <div class="col-sm-4 text-center">
            <canvas
              id="pcbCostChart"
              width="200"
              height="200"
              style="border:1px solid #ccc;"
            ></canvas>
          </div>
          <div class="col-sm-4 text-center">
            <canvas
              id="pcbCo2Chart"
              width="200"
              height="200"
              style="border:1px solid #ccc;"
            ></canvas>
          </div>
        </div>

        <!-- Chat-Bubble + Chat-Fenster im Modal (Beispiel) -->
        <div id="pcbChatBubble">
          <img
            src="https://cdn-icons-png.flaticon.com/512/2990/2990675.png"
            alt="Chat"
            onclick="togglePcbChatWindow()"
          />
        </div>

        <div id="pcbChatWindow">
          <div class="header">KI-Assistent</div>
          <div class="body">
            <p>Hallo, wie kann ich helfen?</p>
          </div>
          <div class="footer d-flex align-items-center" style="gap:5px;">
            <!-- NEU: Eingabefeld + Senden-Button -->
            <input
              type="text"
              id="pcbChatInput"
              class="form-control form-control-sm"
              placeholder="Frage eingeben..."
              style="flex:1;"
            />



            <button class="btn btn-sm btn-primary" onclick="sendPcbChat()">Senden</button>
            <button class="btn btn-sm btn-secondary" onclick="togglePcbChatWindow()">Schließen</button>
          </div>
        </div>

      </div><!-- .modal-body -->

      <!-- FOOTER -->
      <div class="modal-footer d-flex justify-content-between align-items-center" style="padding: 0.5rem 1rem;">

        <div>
          <button
      type="button"
      class="btn btn-info btn-sm"
      onclick="askPCBPredefined('Wie verwende ich den Maschinenstundensatzrechner')"
    >
      <i class="fa fa-question-circle me-1"></i> Advisor
    </button>

    <button
      type="button"
      class="btn btn-sm btn-theme me-2"
      onclick="calculatePcb()"
    >
      <i class="fa fa-calculator me-1"></i> Berechnen
    </button>

    <button
      type="button"
      class="btn btn-sm btn-secondary"
      data-bs-dismiss="modal"
    >
      <i class="fa fa-times me-1"></i> Schließen
    </button>
        </div>
      </div>

    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- #pcbModal -->
<!-- ================= SPRITZGUSS-MODAL ================= --><!-- =================== SPRITZGUSS – TAKTZEITRECHNER (DESIGN-ADAPTIERT) =================== -->
<div class="modal fade" id="modalSpritzguss" tabindex="-1" aria-labelledby="spritzgussModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-xl modal-sg" style="max-width:1000px;">
    <div class="modal-content" style="font-size: 0.9rem; max-height: 85vh; overflow-y: auto;">

      <!-- HEADER -->
      <div class="modal-header bg-theme text-white" style="padding: 0.6rem 1rem;">
        <h5 class="modal-title" id="spritzgussModalLabel">
          Spritzguss – Taktzeitrechner
        </h5>
        <button
          type="button"
          class="btn-close btn-close-white"
          data-bs-dismiss="modal"
          aria-label="Schließen"
        ></button>
      </div>

      <!-- BODY -->
      <div class="modal-body p-2">

        <!-- TABS (Basis / Erweitert / Profile) -->
        <ul class="nav nav-tabs nav-tabs-v2" id="sgTabs" role="tablist" style="margin-bottom: 0.5rem;">
          <li class="nav-item" role="presentation">
            <button
              class="nav-link active"
              id="sg-basic-tab"
              data-bs-toggle="tab"
              data-bs-target="#sgTabBasic"
              type="button"
              role="tab"
              aria-controls="sgTabBasic"
              aria-selected="true"
            >
              Basis
            </button>
          </li>
          <li class="nav-item" role="presentation">
            <button
              class="nav-link"
              id="sg-adv-tab"
              data-bs-toggle="tab"
              data-bs-target="#sgTabAdvanced"
              type="button"
              role="tab"
              aria-controls="sgTabAdvanced"
              aria-selected="false"
            >
              Erweitert
            </button>
          </li>
          <li class="nav-item" role="presentation">
            <button
              class="nav-link"
              id="sg-profile-tab"
              data-bs-toggle="tab"
              data-bs-target="#sgTabProfile"
              type="button"
              role="tab"
              aria-controls="sgTabProfile"
              aria-selected="false"
            >
              Profile
            </button>
          </li>
        </ul>

        <!-- TAB-CONTENT -->
        <div class="tab-content mt-2" id="sgTabContent">

          <!-- TAB 1: BASIS -->
          <div
            class="tab-pane fade show active"
            id="sgTabBasic"
            role="tabpanel"
            aria-labelledby="sg-basic-tab"
          >
            <div class="row mb-2">
              <div class="col-md-6">
                <label class="form-label fw-bold mb-1">Material</label>
                <select id="sgMaterialSelect" class="form-select form-select-sm">
                  <option value="PP">PP</option>
                  <option value="ABS">ABS</option>
                  <option value="PA6GF30">PA6GF30</option>
                  <option value="PC">PC</option>
                  <option value="POM">POM</option>
                  <option value="TPE">TPE</option>
                  <option value="PBT">PBT</option>
                </select>
              </div>
              <div class="col-md-6">
                <label class="form-label fw-bold mb-1">Kavitäten</label>
                <input
                  type="number"
                  class="form-control form-control-sm"
                  id="sgCavities"
                  value="4"
                  min="1"
                  max="64"
                />
              </div>
            </div>

            <div class="row mb-2">
              <div class="col-md-6">
                <label class="form-label fw-bold mb-1">Bauteilgewicht (g)</label>
                <input
                  type="number"
                  class="form-control form-control-sm"
                  id="sgPartWeight"
                  value="50"
                />
              </div>
              <div class="col-md-6">
                <label class="form-label fw-bold mb-1">Anguss (g)</label>
                <div class="d-flex">
                  <input
                    type="number"
                    class="form-control form-control-sm"
                    id="sgRunnerWeight"
                    value="10"
                    style="max-width:60%;"
                  />
                  <div class="form-check ms-2">
                    <input
                      class="form-check-input"
                      type="checkbox"
                      id="sgRunnerAutoChk"
                    />
                    <label
                      class="form-check-label"
                      for="sgRunnerAutoChk"
                      style="font-size:0.85rem;"
                    >
                      auto?
                    </label>
                  </div>
                </div>
              </div>
            </div>

            <div class="row mb-2">
              <div class="col-md-6">
                <label class="form-label fw-bold mb-1">
                  Abmessungen (L×B, mm)
                </label>
                <div class="input-group input-group-sm">
                  <input
                    type="number"
                    class="form-control"
                    id="sgLength"
                    value="100"
                  />
                  <span class="input-group-text">×</span>
                  <input
                    type="number"
                    class="form-control"
                    id="sgWidth"
                    value="80"
                  />
                </div>
              </div>
              <div class="col-md-6">
                <label class="form-label fw-bold mb-1">Wandstärke (mm)</label>
                <input
                  type="number"
                  class="form-control form-control-sm"
                  id="sgWallThickness"
                  value="2.0"
                  min="0.3"
                  max="8.0"
                  step="0.1"
                />
              </div>
            </div>
          </div><!-- END TAB BASIC -->


          <!-- TAB 2: ERWEITERT => Accordion -->
          <div
            class="tab-pane fade"
            id="sgTabAdvanced"
            role="tabpanel"
            aria-labelledby="sg-adv-tab"
          >
            <div class="accordion" id="sgAccordionAdvanced">

              <!-- ACCORDION-EINTRAG 1: MASCHINE -->
              <div class="accordion-item">
                <h2 class="accordion-header" id="sgAdvHeadOne">
                  <button
                    class="accordion-button collapsed"
                    type="button"
                    data-bs-toggle="collapse"
                    data-bs-target="#sgAdvCollapseOne"
                    aria-expanded="false"
                    aria-controls="sgAdvCollapseOne"
                  >
                    Maschinen-Parameter
                  </button>
                </h2>
                <div
                  id="sgAdvCollapseOne"
                  class="accordion-collapse collapse"
                  aria-labelledby="sgAdvHeadOne"
                  data-bs-parent="#sgAccordionAdvanced"
                >
                  <div class="accordion-body">
                    <!-- Unverändert -->
                    <div class="row mb-2">
                      <div class="col-md-6">
                        <label class="form-label fw-bold mb-1">
                          Maschine (manuell)
                        </label>
                        <select id="sgMachineCombo" class="form-select form-select-sm">
                          <option value="80t HighSpeed">80t HighSpeed</option>
                          <option value="80t Automotive">80t Automotive</option>
                          <option value="100t Standard">100t Standard</option>
                          <option value="120t AllElectric">120t AllElectric</option>
                          <option value="150t Automotive">150t Automotive</option>
                          <option value="200t Standard">200t Standard</option>
                          <option value="250t Standard">250t Standard</option>
                          <option value="350t Automotive">350t Automotive</option>
                          <option value="400t Standard">400t Standard</option>
                        </select>
                        <div class="form-check mt-1">
                          <input
                            class="form-check-input"
                            type="checkbox"
                            id="sgMachineAutoChk"
                          />
                          <label
                            class="form-check-label"
                            for="sgMachineAutoChk"
                            style="font-size:0.85rem;"
                          >
                            Maschine automatisch?
                          </label>
                        </div>
                      </div>
                      <div class="col-md-6">
                        <label class="form-label fw-bold mb-1">
                          Formen-Innendruck (bar)
                        </label>
                        <select id="sgPressureSelect" class="form-select form-select-sm">
                          <option value="300">300</option>
                          <option value="600">600</option>
                          <option value="800">800</option>
                        </select>
                        <label class="form-label fw-bold mb-1 mt-2">
                          Sicherheitszuschlag (%)
                        </label>
                        <input
                          type="number"
                          class="form-control form-control-sm"
                          id="sgSafetyFactor"
                          value="30"
                        />
                      </div>
                    </div>
                  </div><!-- .accordion-body -->
                </div><!-- #sgAdvCollapseOne -->
              </div><!-- .accordion-item -->


              <!-- ACCORDION-EINTRAG 2: ZUSÄTZLICHE OPTIONEN -->
              <div class="accordion-item">
                <h2 class="accordion-header" id="sgAdvHeadTwo">
                  <button
                    class="accordion-button collapsed"
                    type="button"
                    data-bs-toggle="collapse"
                    data-bs-target="#sgAdvCollapseTwo"
                    aria-expanded="false"
                    aria-controls="sgAdvCollapseTwo"
                  >
                    Zusätzliche Optionen
                  </button>
                </h2>
                <div
                  id="sgAdvCollapseTwo"
                  class="accordion-collapse collapse"
                  aria-labelledby="sgAdvHeadTwo"
                  data-bs-parent="#sgAccordionAdvanced"
                >
                  <div class="accordion-body">
                    <div class="form-check mb-1">
                      <input
                        class="form-check-input"
                        type="checkbox"
                        id="sgAutomotiveChk"
                      />
                      <label class="form-check-label" for="sgAutomotiveChk">
                        Automotive? (+20% Schließkraft)
                      </label>
                    </div>
                    <div class="form-check mb-1">
                      <input
                        class="form-check-input"
                        type="checkbox"
                        id="sgRobotChk"
                      />
                      <label class="form-check-label" for="sgRobotChk">
                        Roboter? (+2s)
                      </label>
                    </div>
                    <div class="form-check mb-1">
                      <input
                        class="form-check-input"
                        type="checkbox"
                        id="sgSliderChk"
                      />
                      <label class="form-check-label" for="sgSliderChk">
                        Schieber? (+1.5s)
                      </label>
                    </div>

                    <label class="form-label fw-bold mb-1 mt-2">
                      Nachdruck/Haltedruck (s)
                    </label>
                    <input
                      type="number"
                      class="form-control form-control-sm"
                      id="sgHoldPressure"
                      value="2.0"
                    />

                    <label class="form-label fw-bold mb-1 mt-2">
                      Min. Kühlzeit (s)
                    </label>
                    <input
                      type="number"
                      class="form-control form-control-sm"
                      id="sgMinCool"
                      value="1.5"
                    />
                    <div class="form-check mb-1">
                      <input
                        class="form-check-input"
                        type="checkbox"
                        id="sgContourCoolChk"
                      />
                      <label class="form-check-label" for="sgContourCoolChk">
                        Konturnahe Kühlung (-20% Kühlzeit)
                      </label>
                    </div>

                    <!-- ### NEU: "Erweiterte Logik" & "Paralleles Plastifizieren" -->
                    <hr/>
                    <div class="form-check mb-1">
                      <input
                        class="form-check-input"
                        type="checkbox"
                        id="sgAdvModeChk"
                      />
                      <label class="form-check-label" for="sgAdvModeChk">
                        Erweiterte Logik aktivieren
                      </label>
                    </div>
                    <div class="form-check mb-1 ms-4">
                      <input
                        class="form-check-input"
                        type="checkbox"
                        id="sgParallelPlastChk"
                      />
                      <label class="form-check-label" for="sgParallelPlastChk">
                        Paralleles Plastifizieren
                      </label>
                    </div>
                    <!-- ENDE NEU -->

                  </div><!-- .accordion-body -->
                </div><!-- #sgAdvCollapseTwo -->
              </div><!-- .accordion-item -->
            </div><!-- .accordion -->
          </div><!-- END TAB ERWEITERT -->


          <!-- TAB 3: PROFILE -->
          <div
            class="tab-pane fade"
            id="sgTabProfile"
            role="tabpanel"
            aria-labelledby="sg-profile-tab"
          >
            <div class="mt-2">
              <h6>Wähle ein Prozess-Profil:</h6>
              <div class="d-flex flex-wrap gap-2">
                <button
                  type="button"
                  class="btn btn-outline-primary btn-sm"
                  onclick="loadProfile('standard')"
                >
                  Standard-Profil
                </button>
                <button
                  type="button"
                  class="btn btn-outline-success btn-sm"
                  onclick="loadProfile('packaging')"
                >
                  Verpackungs-Profil
                </button>
                <button
                  type="button"
                  class="btn btn-outline-danger btn-sm"
                  onclick="loadProfile('automotive')"
                >
                  Automotive-Profil
                </button>
              </div>
              <div
                id="sgProfileChanges"
                class="mt-3 p-2 border border-info"
                style="white-space: pre-wrap; font-size:0.9rem;"
              >
                Noch kein Profil geladen.
              </div>
            </div>
          </div><!-- END TAB PROFILE -->

        </div><!-- END of TAB-CONTENT -->

        <hr />
        <!-- ERGEBNISSE -->
        <h6>Ergebnisse</h6>
        <div class="row">
          <div class="col-md-6">
            <div class="mb-1">
              Schließkraft (t):
              <span id="sgClosureForce" class="fw-bold">--</span>
            </div>
            <div class="mb-1">
              Gewählte Maschine:
              <span id="sgChosenMachine" class="fw-bold">--</span>
            </div>
            <div class="mb-1">
              Zyklus/Schuss (s):
              <span id="sgCycleShot" class="fw-bold">--</span>
            </div>
            <div class="mb-1">
              Zyklus/Teil (s):
              <span id="sgCyclePart" class="fw-bold">--</span>
            </div>

            <div
              id="sgMachineExplain"
              class="text-muted"
              style="font-size:0.85rem;"
            >
              <!-- Dynamisch vom JS ausgefüllt -->
            </div>

            <!-- Versteckte Felder für Durchsatz / Kosten (bei Bedarf genutzt) -->
            <div style="display:none;">
              Teile/h:
              <span id="sgThroughput">--</span>
            </div>
            <div style="display:none;">
              Kosten/Teil:
              <span id="sgCostEach">--</span>
            </div>
          </div>
          <div class="col-md-6">
            <canvas
              id="sgCycleChart"
              width="240"
              height="240"
              style="border:1px solid #ccc;"
            ></canvas>
          </div>
        </div>
        <div id="SGChatBubble">
          <img
            src="https://cdn-icons-png.flaticon.com/512/2990/2990675.png"
            alt="Chat"
            onclick="toggleSGChatWindow()"
          />
        </div>

        <div id="SGChatWindow">
          <div class="header">KI-Assistent</div>
          <div class="body">
            <p>Hallo, wie kann ich helfen?</p>
          </div>
          <div class="footer d-flex align-items-center" style="gap:5px;">
            <!-- NEU: Eingabefeld + Senden-Button -->
            <input
              type="text"
              id="SGChatInput"
              class="form-control form-control-sm"
              placeholder="Frage eingeben..."
              style="flex:1;"
            />



            <button class="btn btn-sm btn-primary" onclick="sendSGChat()">Senden</button>
            <button class="btn btn-sm btn-secondary" onclick="toggleSGChatWindow()">Schließen</button>
          </div>
        </div>
      </div><!-- END modal-body -->

      <!-- FOOTER -->
      <div class="modal-footer d-flex justify-content-between align-items-center" style="padding: 0.5rem 1rem;">
        <div>
          <button
      type="button"
      class="btn btn-info btn-sm"
      onclick="askSGPredefined('Wie verwende ich den Spritzgussrechner')"
    >
      <i class="fa fa-question-circle me-1"></i> Advisor
    </button>
          <!-- Reihenfolge wie im Original, nur Design & Icons ergänzt -->
          <button
            type="button"
            class="btn btn-sm btn-secondary me-2"
            data-bs-dismiss="modal"
          >
            <i class="fa fa-times me-1"></i> Schließen
          </button>
          <button
            type="button"
            class="btn btn-sm btn-theme me-2"
            onclick="calculateSpritzguss()"
          >
            <i class="fa fa-calculator me-1"></i> Berechnen
          </button>
          <button
            type="button"
            class="btn btn-sm btn-success"
            id="btnSpritzgussUebernehmen"
          >
            <i class="fa fa-check me-1"></i> Übernehmen
          </button>
        </div>
      </div>

    </div><!-- .modal-content -->
  </div><!-- .modal-dialog -->
</div>
<!-- =================== ENDE SPRITZGUSS-MODAL =================== -->
        <!-- DRUCKGUSS-MODAL (Fancy v2.0) -->
<!-- =================== DRUCKGUSS – TAKTZEITRECHNER (DESIGN-ADAPTIERT) =================== -->
<div class="modal fade" id="modalDruckguss" tabindex="-1" aria-labelledby="druckgussModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-xl modal-dg" style="max-width:1000px;">
    <div class="modal-content" style="font-size: 0.9rem; max-height: 85vh; overflow-y: auto;">

      <!-- HEADER (Design analog) -->
      <div class="modal-header bg-theme text-white" style="padding: 0.6rem 1rem;">
        <h5 class="modal-title" id="druckgussModalLabel">Druckguss – Taktzeitrechner</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
      </div>

      <!-- BODY -->
      <div class="modal-body p-2">
        <!-- TABS (Basis / Erweitert) -->
        <ul class="nav nav-tabs nav-tabs-v2" id="dgTabs" role="tablist" style="margin-bottom: 0.5rem;">
          <li class="nav-item" role="presentation">
            <button
              class="nav-link active"
              id="dg-basic-tab"
              data-bs-toggle="tab"
              data-bs-target="#dgTabBasic"
              type="button"
              role="tab"
              aria-selected="true"
            >
              Basis
            </button>
          </li>
          <li class="nav-item" role="presentation">
            <button
              class="nav-link"
              id="dg-adv-tab"
              data-bs-toggle="tab"
              data-bs-target="#dgTabAdvanced"
              type="button"
              role="tab"
              aria-selected="false"
            >
              Erweitert
            </button>
          </li>
        </ul>

        <div class="tab-content mt-2" id="dgTabContent">
          <!-- TAB 1: BASIS -->
          <div
            class="tab-pane fade show active"
            id="dgTabBasic"
            role="tabpanel"
          >
            <div class="row mb-2">
              <div class="col-md-6">
                <label class="form-label fw-bold mb-1">Legierung</label>
                <select id="dgMaterialSelect" class="form-select form-select-sm">
                  <option value="AlSi9Cu3">AlSi9Cu3</option>
                  <option value="AZ91D">AZ91D</option>
                  <option value="Zamak5">Zamak5</option>
                </select>
              </div>
              <div class="col-md-6">
                <label class="form-label fw-bold mb-1">Teilegewicht (g)</label>
                <input
                  type="number"
                  class="form-control form-control-sm"
                  id="dgPartWeight"
                  value="500"
                />
              </div>
            </div>

            <div class="row mb-2">
              <div class="col-md-6">
                <label class="form-label fw-bold mb-1">proj. Fläche (cm²)</label>
                <input
                  type="number"
                  class="form-control form-control-sm"
                  id="dgAreaCm2"
                  value="80"
                />
              </div>
              <div class="col-md-6">
                <label class="form-label fw-bold mb-1">Kavitäten</label>
                <input
                  type="number"
                  class="form-control form-control-sm"
                  id="dgCavities"
                  value="1"
                />
              </div>
            </div>

            <div class="row mb-2">
              <div class="col-md-6">
                <div class="form-check mb-1">
                  <input class="form-check-input" type="checkbox" id="dgDickwandChk" />
                  <label class="form-check-label" for="dgDickwandChk">
                    Dickwand? (+15% Kraft, ggf. +2x Kühlzeit)
                  </label>
                </div>
                <div class="form-check mb-1">
                  <input class="form-check-input" type="checkbox" id="dgEntgratenChk" />
                  <label class="form-check-label" for="dgEntgratenChk">
                    Entgraten (+2s)
                  </label>
                </div>
              </div>
              <div class="col-md-6">
                <label class="form-label fw-bold mb-1">Overflow (%)</label>
                <input
                  type="number"
                  class="form-control form-control-sm"
                  id="dgOverflowPct"
                  value="50"
                />
              </div>
            </div>
          </div><!-- END TAB BASIC -->

          <!-- TAB 2: ERWEITERT -->
          <div
            class="tab-pane fade"
            id="dgTabAdvanced"
            role="tabpanel"
          >
            <div class="row mb-2">
              <div class="col-md-6">
                <div class="form-check mb-1">
                  <input class="form-check-input" type="checkbox" id="dgAutoMachineChk" checked />
                  <label class="form-check-label" for="dgAutoMachineChk">
                    Maschine automatisch wählen?
                  </label>
                </div>
                <label class="form-label fw-bold mb-1">Manuelle Maschine</label>
                <select
                  id="dgMachineSelect"
                  class="form-select form-select-sm"
                  disabled
                >
                  <option value="200t">200 t</option>
                  <option value="400t">400 t</option>
                  <option value="800t">800 t</option>
                </select>

                <div class="form-check mb-1 mt-2">
                  <input class="form-check-input" type="checkbox" id="dgAbgeschrChk" />
                  <label class="form-check-label" for="dgAbgeschrChk">
                    Abgeschrieben? (-20% Rate)
                  </label>
                </div>
              </div>
              <div class="col-md-6">
                <label class="form-label fw-bold mb-1">Sicherheitsfaktor</label>
                <input
                  type="number"
                  class="form-control form-control-sm"
                  id="dgSafetyFactor"
                  value="2.0"
                />
                <div class="form-check mb-1 mt-2">
                  <input class="form-check-input" type="checkbox" id="dgSqueezeChk" />
                  <label class="form-check-label" for="dgSqueezeChk">
                    Squeeze Casting (+20% Kraft, +3s Nachdruck)
                  </label>
                </div>
              </div>
            </div>

            <div class="row mb-2">
              <div class="col-md-6">
                <label class="form-label fw-bold mb-1">Wandstärke (mm)</label>
                <input
                  type="number"
                  class="form-control form-control-sm"
                  id="dgWallThickness"
                  value="6.0"
                />
                <label class="form-label fw-bold mb-1 mt-2">Sprühzeit (s)</label>
                <input
                  type="number"
                  class="form-control form-control-sm"
                  id="dgSprayTime"
                  value="5.0"
                />
              </div>
              <div class="col-md-6">
                <label class="form-label fw-bold mb-1">Nachdruck (s)</label>
                <input
                  type="number"
                  class="form-control form-control-sm"
                  id="dgHoldTime"
                  value="5.0"
                />
                <label class="form-label fw-bold mb-1 mt-2">Automation-Level</label>
                <select id="dgAutomationSelect" class="form-select form-select-sm">
                  <option value="Manuell">Manuell</option>
                  <option value="Halbauto">Halbauto</option>
                  <option value="Vollauto">Vollauto</option>
                </select>
              </div>
            </div>

            <div class="row mb-2">
              <div class="col-md-6">
                <label class="form-label fw-bold mb-1">Auslastung (%)</label>
                <input
                  type="number"
                  class="form-control form-control-sm"
                  id="dgUtilPct"
                  value="85"
                />
              </div>
            </div>
          </div><!-- END TAB ADVANCED -->
        </div><!-- END .tab-content -->

        <hr/>
        <!-- ERGEBNISSE -->
        <div id="dgResultsArea" class="mt-2">
          <h6>Ergebnisse</h6>
          <div class="row">
            <div class="col-md-6">
              <div>Schließkraft (t): <span id="dgClosureForce" class="fw-bold">--</span></div>
              <div>Gewählte Maschine: <span id="dgChosenMachine" class="fw-bold">--</span></div>
              <div>Zyklus/Schuss (s): <span id="dgCycleShot" class="fw-bold">--</span></div>
              <div>Zyklus/Teil (s): <span id="dgCyclePart" class="fw-bold">--</span></div>
              <div>Teile/h (real): <span id="dgThroughput" class="fw-bold">--</span></div>
              <div>Kosten/Teil: <span id="dgCostEach" class="fw-bold">--</span></div>
              <div>CO₂/Teil: <span id="dgCo2Each" class="fw-bold">--</span></div>
            </div>
            <div class="col-md-6">
              <canvas
                id="dgCycleChart"
                width="240"
                height="240"
                style="border:1px solid #ccc;"
              ></canvas>
            </div>
          </div>
        </div>
      </div><!-- END modal-body -->

      <!-- FOOTER-BUTTONS (Design analog) -->
      <div class="modal-footer d-flex justify-content-between align-items-center" style="padding: 0.5rem 1rem;">
        <div>
          <button
            type="button"
            class="btn btn-sm btn-secondary me-2"
            data-bs-dismiss="modal"
          >
            <i class="fa fa-times me-1"></i> Schließen
          </button>
          <button
            type="button"
            class="btn btn-sm btn-theme me-2"
            onclick="calculateDruckguss()"
          >
            <i class="fa fa-calculator me-1"></i> Berechnen
          </button>
          <button
            type="button"
            class="btn btn-sm btn-success"
            id="btnDruckgussUebernehmen"
          >
            <i class="fa fa-check me-1"></i> Übernehmen
          </button>
        </div>
      </div>
    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- #modalDruckguss -->
<!-- ================================================
     (10-15 Zeilen VORLAUF, z. B. andere Modals)
     ================================================ -->

<!-- =================== MILLING-MODAL =================== -->

<!-- =================== FRÄS-/ZERSPANUNGS-RECHNER (DESIGN-ADAPTIERT) =================== -->
<div class="modal fade" id="modalMilling" tabindex="-1" aria-labelledby="millingModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-xl modal-milling" style="max-width:1000px;">
    <div class="modal-content" style="font-size: 0.9rem; max-height: 85vh; overflow-y: auto;">

      <!-- HEADER (Design analog) -->
      <div class="modal-header bg-theme text-white" style="padding: 0.6rem 1rem;">
        <h5 class="modal-title" id="millingModalLabel">Fräs-/Zerspanungs-Rechner</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
      </div>

      <!-- BODY -->
      <div class="modal-body p-2">
        <!-- Tabs (Basis / Erweitert) -->
        <ul class="nav nav-tabs nav-tabs-v2" id="millTabs" role="tablist" style="margin-bottom: 0.5rem;">
          <li class="nav-item" role="presentation">
            <button
              class="nav-link active"
              id="mill-basic-tab"
              data-bs-toggle="tab"
              data-bs-target="#millTabBasic"
              type="button"
              role="tab"
            >
              Basis
            </button>
          </li>
          <li class="nav-item" role="presentation">
            <button
              class="nav-link"
              id="mill-adv-tab"
              data-bs-toggle="tab"
              data-bs-target="#millTabAdvanced"
              type="button"
              role="tab"
            >
              Erweitert
            </button>
          </li>
        </ul>

        <div class="tab-content mt-2" id="millTabContent">
          <!-- TAB 1: BASIS -->
          <div
            class="tab-pane fade show active"
            id="millTabBasic"
            role="tabpanel"
          >
            <div class="row mb-2">
              <div class="col-md-6">
                <label class="form-label fw-bold mb-1">Werkstoff</label>
                <select id="millMatSelect" class="form-select form-select-sm">
                  <option value="Stahl S235">Stahl S235</option>
                  <option value="Alu ENAW6060">Alu ENAW6060</option>
                  <option value="GG25 Guss">GG25 Guss</option>
                </select>
              </div>
              <div class="col-md-6">
                <div class="form-check mt-2">
                  <input class="form-check-input" type="checkbox" id="millAutoMachChk" checked />
                  <label class="form-check-label" for="millAutoMachChk">
                    Maschine automatisch wählen?
                  </label>
                </div>
              </div>
            </div>

            <div class="row mb-2">
              <label class="form-label fw-bold mb-1">Manuelle Maschine:</label>
              <select
                id="millMachineSelect"
                class="form-select form-select-sm ms-2"
                style="max-width:60%;"
                disabled
              >
                <option value="3-Achs Standard">3-Achs Standard</option>
                <option value="5-Achs Standard">5-Achs Standard</option>
                <option value="5-Achs HighEnd">5-Achs HighEnd</option>
              </select>
            </div>

            <div class="row">
              <div class="col-md-4 mb-2">
                <label class="form-label">Länge (mm)</label>
                <input
                  type="number"
                  class="form-control form-control-sm"
                  id="millLenMm"
                  value="100"
                />
              </div>
              <div class="col-md-4 mb-2">
                <label class="form-label">Breite (mm)</label>
                <input
                  type="number"
                  class="form-control form-control-sm"
                  id="millWidMm"
                  value="80"
                />
              </div>
              <div class="col-md-4 mb-2">
                <label class="form-label">Höhe (mm)</label>
                <input
                  type="number"
                  class="form-control form-control-sm"
                  id="millHeiMm"
                  value="30"
                />
              </div>
            </div>

            <div class="mb-2">
              <label class="form-label fw-bold mb-1">End-Höhe (mm)</label>
              <input
                type="number"
                class="form-control form-control-sm"
                id="millFinishHeight"
                value="28"
              />
            </div>
          </div><!-- END TAB BASIC -->

          <!-- TAB 2: ERWEITERT -->
          <div
            class="tab-pane fade"
            id="millTabAdvanced"
            role="tabpanel"
          >
            <div class="row mb-2">
              <div class="col-md-6">
                <label class="form-label fw-bold mb-1">Vorschub (mm/min)</label>
                <input
                  type="number"
                  class="form-control form-control-sm"
                  id="millFeedRate"
                  value="1500"
                />
                <label class="form-label fw-bold mt-2">Schnitttiefe pro Zug (mm)</label>
                <input
                  type="number"
                  class="form-control form-control-sm"
                  id="millCutDepth"
                  value="3.0"
                />
              </div>
              <div class="col-md-6">
                <label class="form-label fw-bold mb-1">Toolchange-Zeit (s)</label>
                <input
                  type="number"
                  class="form-control form-control-sm"
                  id="millToolChange"
                  value="20"
                />
                <label class="form-label fw-bold mt-2">Maschinen-Verfügbarkeit (%)</label>
                <small class="form-text text-muted">(fix im Code? Optional.)</small>
              </div>
            </div>

            <div class="row mb-2">
              <div class="col-md-6">
                <label class="form-label fw-bold mb-1">Losgröße</label>
                <input
                  type="number"
                  class="form-control form-control-sm"
                  id="millLotSize"
                  value="100"
                />
              </div>
              <div class="col-md-6">
                <label class="form-label fw-bold mb-1">Rüstzeit (min)</label>
                <input
                  type="number"
                  class="form-control form-control-sm"
                  id="millRuestMin"
                  value="30"
                />
              </div>
            </div>
          </div><!-- END TAB ADVANCED -->
        </div><!-- END .tab-content -->

        <hr/>
        <!-- ERGEBNISSE -->
        <div id="millResultsArea" class="mt-2">
          <h6>Ergebnisse</h6>
          <div class="row">
            <div class="col-md-6">
              <div>Maschine: <span id="millChosenMachine" class="fw-bold">--</span></div>
              <div>Takt/Teil (s): <span id="millCycleTime" class="fw-bold">--</span></div>
              <div>Teile/h: <span id="millPartPerHour" class="fw-bold">--</span></div>
              <div>Kosten/Teil: <span id="millCostEach" class="fw-bold">--</span></div>
              <div>CO₂/Teil: <span id="millCo2Each" class="fw-bold">--</span></div>
            </div>
            <div class="col-md-6">
              <canvas
                id="millCostChart"
                width="240"
                height="240"
                style="border:1px solid #ccc;"
              ></canvas>
            </div>
          </div>
        </div><!-- /millResultsArea -->
      </div><!-- /modal-body -->

      <!-- FOOTER (Design analog) -->
      <div class="modal-footer d-flex justify-content-between align-items-center" style="padding: 0.5rem 1rem;">
        <div>
          <button
            type="button"
            class="btn btn-sm btn-secondary me-2"
            data-bs-dismiss="modal"
          >
            <i class="fa fa-times me-1"></i> Schließen
          </button>
          <button
            type="button"
            class="btn btn-sm btn-theme me-2"
            onclick="calculateMilling()"
          >
            <i class="fa fa-calculator me-1"></i> Berechnen
          </button>
          <button
            type="button"
            class="btn btn-sm btn-success"
            id="btnMillingUebernehmen"
          >
            <i class="fa fa-check me-1"></i> Übernehmen
          </button>
        </div>
      </div>

    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- #modalMilling -->
<!-- End MILLING-MODAL -->
        <!-- ============== STAMPING-MODAL ============== -->
<!-- =================== STANZEN/PRESSEN – KALKULATOR (DESIGN-ADAPTIERT) =================== -->
<div class="modal fade" id="modalStamping" tabindex="-1" aria-labelledby="stampingModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-xl modal-stamping" style="max-width:1000px;">
    <div class="modal-content" style="font-size: 0.9rem; max-height: 85vh; overflow-y: auto;">

      <!-- HEADER (Design analog) -->
      <div class="modal-header bg-theme text-white" style="padding: 0.6rem 1rem;">
        <h5 class="modal-title" id="stampingModalLabel">Stanzen/Pressen – Kalkulator</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
      </div>

      <!-- BODY -->
      <div class="modal-body p-2">
        <!-- Tabs (Basis / Erweitert) -->
        <ul class="nav nav-tabs nav-tabs-v2" id="stampingTabs" role="tablist" style="margin-bottom: 0.5rem;">
          <li class="nav-item" role="presentation">
            <button
              class="nav-link active"
              id="stamping-basic-tab"
              data-bs-toggle="tab"
              data-bs-target="#stampingTabBasic"
              type="button"
              role="tab"
            >
              Basis
            </button>
          </li>
          <li class="nav-item" role="presentation">
            <button
              class="nav-link"
              id="stamping-adv-tab"
              data-bs-toggle="tab"
              data-bs-target="#stampingTabAdvanced"
              type="button"
              role="tab"
            >
              Erweitert
            </button>
          </li>
        </ul>

        <div class="tab-content mt-2" id="stampingTabContent">
          <!-- TAB 1: BASIS -->
          <div
            class="tab-pane fade show active"
            id="stampingTabBasic"
            role="tabpanel"
          >
            <div class="row mb-2">
              <div class="col-md-6">
                <label class="form-label fw-bold mb-1">Material</label>
                <select id="stMatSelect" class="form-select form-select-sm">
                  <option value="Stahl DC01">Stahl DC01</option>
                  <option value="Stahl DP600">Stahl DP600</option>
                  <option value="Alu AW1050">Alu AW1050</option>
                </select>
              </div>
              <div class="col-md-6">
                <label class="form-label fw-bold mb-1">Blechdicke (mm)</label>
                <input
                  type="number"
                  class="form-control form-control-sm"
                  id="stThickMm"
                  value="1.0"
                />
              </div>
            </div>

            <div class="row mb-2">
              <div class="col-md-6">
                <label class="form-label fw-bold mb-1">proj. Fläche (cm²)</label>
                <input
                  type="number"
                  class="form-control form-control-sm"
                  id="stAreaCm2"
                  value="150"
                />
              </div>
              <div class="col-md-6">
                <label class="form-label fw-bold mb-1">Verschnitt (%)</label>
                <input
                  type="number"
                  class="form-control form-control-sm"
                  id="stScrapPct"
                  value="15"
                />
              </div>
            </div>

            <div class="row mb-2">
              <div class="col-md-6">
                <label class="form-label fw-bold mb-1">Losgröße</label>
                <input
                  type="number"
                  class="form-control form-control-sm"
                  id="stLos"
                  value="10000"
                />
              </div>
              <div class="col-md-6">
                <label class="form-label fw-bold mb-1">Rüstzeit (min)</label>
                <input
                  type="number"
                  class="form-control form-control-sm"
                  id="stRuestMin"
                  value="60"
                />
              </div>
            </div>

            <div class="mb-2 form-check">
              <input class="form-check-input" type="checkbox" id="stDickBlechChk" />
              <label class="form-check-label" for="stDickBlechChk">
                Dickes Blech => -20% Hubzahl
              </label>
            </div>
          </div><!-- END TAB BASIC -->

          <!-- TAB 2: ERWEITERT -->
          <div
            class="tab-pane fade"
            id="stampingTabAdvanced"
            role="tabpanel"
          >
            <div class="row mb-2">
              <div class="col-md-6">
                <div class="form-check mb-1">
                  <input class="form-check-input" type="checkbox" id="stAutoMachChk" checked />
                  <label class="form-check-label" for="stAutoMachChk">
                    Presse automatisch wählen?
                  </label>
                </div>
                <label class="form-label fw-bold mb-1">Manuelle Presse</label>
                <select id="stPressSelect" class="form-select form-select-sm" disabled>
                  <option value="100">100 t</option>
                  <option value="200">200 t</option>
                  <option value="400">400 t</option>
                  <option value="600">600 t</option>
                </select>
              </div>
              <div class="col-md-6">
                <label class="form-label fw-bold mb-1">Hub/min (Berechnung intern)</label>
                <small class="form-text text-muted">
                  (Kein separates Eingabefeld, wir leiten es aus machine_data ab.)
                </small>
              </div>
            </div>
          </div><!-- END TAB ADVANCED -->
        </div><!-- /tab-content -->

        <hr/>
        <!-- ERGEBNISSE -->
        <div id="stResultsArea" class="mt-2">
          <h6>Ergebnisse</h6>
          <div class="row">
            <div class="col-md-6">
              <div>Presskraft (t): <span id="stPressForce" class="fw-bold">--</span></div>
              <div>Gewählte Presse: <span id="stChosenPress" class="fw-bold">--</span></div>
              <div>Takt/Teil (s): <span id="stCycleTime" class="fw-bold">--</span></div>
              <div>Teile/h: <span id="stPartPerHour" class="fw-bold">--</span></div>
              <div>Kosten/Teil: <span id="stCostEach" class="fw-bold">--</span></div>
              <div>CO₂/Teil: <span id="stCo2Each" class="fw-bold">--</span></div>
            </div>
            <div class="col-md-6">
              <canvas
                id="stCycleChart"
                width="240"
                height="240"
                style="border:1px solid #ccc;"
              ></canvas>
            </div>
          </div>
        </div>
      </div><!-- /modal-body -->

      <!-- FOOTER (Design analog) -->
      <div class="modal-footer d-flex justify-content-between align-items-center" style="padding: 0.5rem 1rem;">
        <div>
          <button type="button" class="btn btn-sm btn-secondary me-2" data-bs-dismiss="modal">
            <i class="fa fa-times me-1"></i> Schließen
          </button>
          <button type="button" class="btn btn-sm btn-theme me-2" onclick="calculateStamping()">
            <i class="fa fa-calculator me-1"></i> Berechnen
          </button>
          <button type="button" class="btn btn-sm btn-success" id="btnStampingUebernehmen">
            <i class="fa fa-check me-1"></i> Übernehmen
          </button>
        </div>
      </div>

    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- #modalStamping -->

<!-- ============= ZYKLUSZEIT-MODAL (mit 4 Verfahren) ============= -->
<div
  class="modal fade"
  id="modalZyklusBild"
  tabindex="-1"
  aria-hidden="true"
>
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Zykluszeit – Auswahl</h5>
        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="modal"
        ></button>
      </div>
      <div class="modal-body">
        <p>Wähle deine Fertigungstechnik:</p>
        <div class="d-flex flex-wrap justify-content-between">
          <!-- Spritzguss -->
          <div class="text-center m-2">
            <img
              src="/static/img/spritzguss.jpeg"
              alt="Spritzguss"
              class="img-choice"
              onclick="openSpritzgussModal()"
            />
            <p class="mt-2 mb-0">Spritzguss</p>
          </div>
          <!-- Druckguss -->
          <div class="text-center m-2">
            <img
              src="/static/img/druckguss.jpeg"
              alt="Druckguss"
              class="img-choice"
              onclick="openDruckgussModalSafe()"
            />
            <p class="mt-2 mb-0">Druckguss</p>
          </div>
          <!-- Zerspanung -->
          <div class="text-center m-2">
            <img
              src="/static/img/zerspanung.jpeg"
              alt="Zerspanung"
              class="img-choice"
              onclick="openMillingModalSafe()"
            />
            <p class="mt-2 mb-0">Zerspanung</p>
          </div>
          <!-- Stanzen -->
          <div class="text-center m-2">
            <img
              src="/static/img/stanzen.jpeg"
              alt="Stanzen"
              class="img-choice"
              onclick="openStampingModalSafe()"
            />
            <p class="mt-2 mb-0">Stanzen</p>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button
          type="button"
          class="btn btn-secondary"
          data-bs-dismiss="modal"
        >
          Schließen
        </button>
      </div>
    </div>
  </div>
</div>


<!-- Taktzeit-Modal -->
<div
  class="modal fade"
  id="modalTakt"
  tabindex="-1"
  aria-hidden="true"
>
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Taktzeit-Rechner</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <label for="taktFormfill" class="form-label">Formfüllzeit (s)</label>
        <input type="number" step="0.1" class="form-control" id="taktFormfill" value="5" />
        <label for="taktCooling" class="form-label mt-2">Kühlzeit (s)</label>
        <input type="number" step="0.1" class="form-control" id="taktCooling" value="10" />
      </div>
      <div class="modal-footer">
        <button
          type="button"
          class="btn btn-secondary"
          data-bs-dismiss="modal"
        >
          Abbrechen
        </button>
        <button
          type="button"
          class="btn btn-primary"
          onclick="acceptTakt()"
        >
          Übernehmen
        </button>
      </div>
    </div>
  </div>
</div>
<!-- =================== NEUES MASCHINENSTUNDENSATZ-MODAL =================== -->
<!-- =================== NEUES MASCHINENSTUNDENSATZ-MODAL (FINAL VERSION) =================== -->
<!--
   - Mit 2 Tabs ("Abschreibung & Kapital" / "Energie & Betrieb")
   - Kompakte Darstellung
   - "Berechnen" ruft calcExtendedMachineRate() auf (IDs beibehalten)
   - Read-only Felder in grau
   - Stromverbrauch (%) voreingestellt auf 85.0
   - Jahreskosten-Feld optional sichtbar
-->
<!-- ======================== MASCHINENSTUNDENSATZ MODAL (Berechnung aktiv) ======================== -->
<!-- 1) STYLE-BLOCK für read-only Felder -->
<style>
  /* Lesezeichen: grauer Hintergrund bei readonly Feldern */
  .form-control[readonly],
  .form-control:disabled {
    background-color: #e9ecef !important;
    cursor: not-allowed;
  }
</style>

<!-- 2) MODAL-STRUKTUR -->
<!-- 2) MODAL-STRUKTUR -->
<!-- 2) MODAL-STRUKTUR -->
<div class="modal fade" id="modalMachine" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-xl" style="max-width:1000px;"> <!-- Extra-breit -->
    <div class="modal-content" style="font-size: 0.9rem;">

      <!-- HEADER -->
      <div class="modal-header bg-theme text-white" style="padding: 0.6rem 1rem;">
        <h5 class="modal-title">Maschinenstundensatz – Erweitert</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
      </div>

      <!-- BODY: 2 Tabs (Abschreibung + Energie), position: relative für Chat-Bubble -->
      <div class="modal-body p-2 position-relative">
        <ul class="nav nav-tabs nav-tabs-v2" role="tablist" style="margin-bottom: 0.5rem;">
          <li class="nav-item">
            <button class="nav-link active" data-bs-toggle="tab" data-bs-target="#machTabCapital" type="button">
              Abschreibung & Kapital
            </button>
          </li>
          <li class="nav-item">
            <button class="nav-link" data-bs-toggle="tab" data-bs-target="#machTabEnergy" type="button">
              Energie & Betrieb
            </button>
          </li>
        </ul>

        <div class="tab-content p-2">
          <!-- TAB 1: Abschreibung/Kapital -->
          <div class="tab-pane fade show active" id="machTabCapital">
            <div class="row mb-2">
              <!-- Kaufpreis -->
              <div class="col-md-6 d-flex align-items-center">
                <label class="col-form-label col-5">Kaufpreis (€)</label>
                <div class="col-7 d-flex gap-2">
                  <input
                    type="number"
                    class="form-control form-control-sm"
                    id="machKaufpreis"
                    value="100000"
                  />
                  <button class="btn btn-sm btn-outline-theme" onclick="openMachineListModal()">
                    Aus Liste...
                  </button>
                </div>
              </div>
              <!-- Abschreibung pro Stunde -->
              <div class="col-md-6 d-flex align-items-center">
                <label class="col-form-label col-5">Abschr. pro h</label>
                <div class="col-7">
                  <input
                    type="text"
                    class="form-control form-control-sm"
                    id="machKaufpreisHr"
                    placeholder="€/h"
                    readonly
                  />
                </div>
              </div>
            </div>

            <div class="row mb-2">
              <!-- Installationskosten -->
              <div class="col-md-6 d-flex align-items-center">
                <label class="col-form-label col-5">Installationsk. (€)</label>
                <div class="col-7">
                  <input
                    type="number"
                    class="form-control form-control-sm"
                    id="machInstCost"
                    value="0"
                  />
                </div>
              </div>
              <!-- Zinssatz + Zins/h -->
              <div class="col-md-6 d-flex align-items-center">
                <label class="col-form-label col-5">Zinssatz (%)</label>
                <div class="col-7 d-flex gap-2">
                  <input
                    type="number"
                    class="form-control form-control-sm"
                    id="machZinssatz"
                    step="0.1"
                    value="3.0"
                  />
                  <input
                    type="text"
                    class="form-control form-control-sm"
                    id="machZinsHr"
                    placeholder="€/h"
                    readonly
                  />
                </div>
              </div>
            </div>

            <div class="row mb-2">
              <!-- Nutzungsdauer -->
              <div class="col-md-6 d-flex align-items-center">
                <label class="col-form-label col-5">Nutzungsdauer (J.)</label>
                <div class="col-7">
                  <input
                    type="number"
                    class="form-control form-control-sm"
                    id="machNutzdauer"
                    value="5"
                  />
                </div>
              </div>
              <!-- Dedicated? -->
              <div class="col-md-6 d-flex align-items-center">
                <label class="col-form-label col-5">Dedicated?</label>
                <div class="col-7 d-flex align-items-center gap-2">
                  <input
                    type="checkbox"
                    class="form-check-input"
                    style="transform: scale(1.2);"
                    id="chkDedicated"
                    onchange="toggleDedicatedPct()"
                  />
                  <input
                    type="number"
                    class="form-control form-control-sm"
                    id="machDedicatedPct"
                    value="100"
                    step="1"
                    min="1"
                    max="100"
                    style="width: 60px;"
                    disabled
                  />
                  <span>%</span>
                  <!-- Kleines Chat-Icon (Dummy) -->
                  <a href="javascript:void(0)" onclick="openMiniChatDedicated()" class="text-theme" style="font-size:1.2rem;">
                    <i class="fa fa-question-circle"></i>
                  </a>
                </div>
              </div>
            </div>

            <!-- Minimales Chat-Fenster (Dedicated-Info) -->
            <div id="miniChatDedicated" class="border p-2 bg-light" style="display:none; margin-bottom: 0.5rem;">
              <strong>Dedicated? Was bedeutet das?</strong>
              <p class="mb-1" style="font-size:0.85rem;">
                Die Maschine wird nur für dieses Projekt genutzt.
                Bei 100% Dedicated entfallen die gesamten Kosten auf dieses Teil.
              </p>
              <button class="btn btn-sm btn-outline-secondary" onclick="closeMiniChatDedicated()">
                Verstanden
              </button>
            </div>

            <div class="row mb-2">
              <!-- Jahresauslastung -->
              <div class="col-md-6 d-flex align-items-center">
                <label class="col-form-label col-5">Jahresauslastung (h)</label>
                <div class="col-7">
                  <input
                    type="number"
                    class="form-control form-control-sm"
                    id="machAuslast"
                    value="6000"
                  />
                </div>
              </div>
              <!-- Verfügbarkeit -->
              <div class="col-md-6 d-flex align-items-center">
                <label class="col-form-label col-5">Verfügbarkeit (%)</label>
                <div class="col-7 d-flex gap-2">
                  <input
                    type="number"
                    class="form-control form-control-sm"
                    id="machAvailPct"
                    step="0.1"
                    value="85.0"
                  />
                  <input
                    type="text"
                    class="form-control form-control-sm"
                    id="machAvailHr"
                    placeholder="eff. h"
                    readonly
                  />
                </div>
              </div>
            </div>
          </div><!-- END TAB 1 -->

          <!-- TAB 2: Energie & Betrieb -->
          <div class="tab-pane fade" id="machTabEnergy">
            <div class="row mb-2">
              <!-- Anschlusswert (kW) -->
              <div class="col-md-6 d-flex align-items-center">
                <label class="col-form-label col-5">Anschlusswert (kW)</label>
                <div class="col-7">
                  <input
                    type="number"
                    class="form-control form-control-sm"
                    id="machKW"
                    value="100"
                  />
                </div>
              </div>
              <!-- Stromverbrauch (%) => 85.0 default -->
              <div class="col-md-6 d-flex align-items-center">
                <label class="col-form-label col-5">Stromverbr. (%)</label>
                <div class="col-7">
                  <input
                    type="number"
                    class="form-control form-control-sm"
                    id="machStromPct"
                    value="85.0"
                  />
                </div>
              </div>
            </div>

            <div class="row mb-2">
              <!-- Stromkosten (€/kWh) + €/h -->
              <div class="col-md-6 d-flex align-items-center">
                <label class="col-form-label col-5">Stromkosten (€/kWh)</label>
                <div class="col-7 d-flex gap-2">
                  <input
                    type="number"
                    class="form-control form-control-sm"
                    id="machStromCost"
                    step="0.01"
                    value="0.20"
                  />
                  <input
                    type="text"
                    class="form-control form-control-sm"
                    id="machStromCostHr"
                    placeholder="€/h"
                    readonly
                  />
                </div>
              </div>
              <!-- CO2 (kg/h) -->
              <div class="col-md-6 d-flex align-items-center">
                <label class="col-form-label col-5">CO₂ (kg/h)</label>
                <div class="col-7">
                  <input
                    type="text"
                    class="form-control form-control-sm"
                    id="machCo2Hr"
                    placeholder="kg/h"
                    readonly
                  />
                </div>
              </div>
            </div>

            <div class="row mb-2">
              <!-- Flächenbedarf -->
              <div class="col-md-6 d-flex align-items-center">
                <label class="col-form-label col-5">Flächenbedarf (m²)</label>
                <div class="col-7">
                  <input
                    type="number"
                    class="form-control form-control-sm"
                    id="machFlaecheBedarf"
                    value="20"
                  />
                </div>
              </div>
              <!-- Flächenkosten (€/m²) + €/h -->
              <div class="col-md-6 d-flex align-items-center">
                <label class="col-form-label col-5">Flächenkosten (€/m²)</label>
                <div class="col-7 d-flex gap-2">
                  <input
                    type="number"
                    class="form-control form-control-sm"
                    id="machFlaechenkost"
                    step="0.01"
                    value="7.0"
                  />
                  <input
                    type="text"
                    class="form-control form-control-sm"
                    id="machFlaechenkostHr"
                    placeholder="€/h"
                    readonly
                  />
                </div>
              </div>
            </div>

            <div class="row mb-2">
              <!-- Instandhaltung -->
              <div class="col-md-6 d-flex align-items-center">
                <label class="col-form-label col-5">Instandhaltung (% v. KP)</label>
                <div class="col-7 d-flex gap-2">
                  <input
                    type="number"
                    class="form-control form-control-sm"
                    id="machInstandPct"
                    step="0.1"
                    value="3.0"
                  />
                  <input
                    type="text"
                    class="form-control form-control-sm"
                    id="machInstandHr"
                    placeholder="€/h"
                    readonly
                  />
                </div>
              </div>
              <!-- Betriebskosten -->
              <div class="col-md-6 d-flex align-items-center">
                <label class="col-form-label col-5">Betriebskosten (% v. KP)</label>
                <div class="col-7 d-flex gap-2">
                  <input
                    type="number"
                    class="form-control form-control-sm"
                    id="machBetriebPct"
                    step="0.1"
                    value="2.0"
                  />
                  <input
                    type="text"
                    class="form-control form-control-sm"
                    id="machBetriebHr"
                    placeholder="€/h"
                    readonly
                  />
                </div>
              </div>
            </div>
          </div><!-- END TAB 2 -->
        </div><!-- /.tab-content -->

        <!-- ============== NEUER CHAT-BEREICH (Bubble & Window) ============== -->
        <div id="mssChatBubble">
          <img
            src="https://cdn-icons-png.flaticon.com/512/2990/2990675.png"
            alt="Chat"
            onclick="toggleMssChatWindow()"
          />
        </div>

        <div id="mssChatWindow">
          <div class="header">KI-Assistent</div>
          <div class="body">
            <p>Hallo, wie kann ich helfen?</p>
          </div>
          <div class="footer">
            <input
              type="text"
              id="mssChatInput"
              class="form-control form-control-sm"
              placeholder="Frage eingeben..."
              style="flex:1;"
            />
            <button class="btn btn-sm btn-primary" onclick="sendMssChat()">Senden</button>
            <button class="btn btn-sm btn-secondary" onclick="toggleMssChatWindow()">Schließen</button>
          </div>
        </div>
        <!-- ============== /NEUER CHAT-BEREICH ============== -->

      </div><!-- /.modal-body -->

      <!-- FOOTER: Buttons + Maschinenkosten -->
      <div class="modal-footer d-flex justify-content-between align-items-center" style="padding:0.5rem 1rem;">
        <!-- Linker Block: Advisor, Berechnen, Übernehmen, Schließen -->
        <div class="d-flex align-items-center gap-2">
          <!-- Neu: Advisor-Button, stellt Standard-Frage an Mss-Chat -->
          <button
            type="button"
            class="btn btn-info btn-sm"
            onclick="askMssPredefined('Wie verwende ich den Maschinenstundensatzrechner?')"
          >
            <i class="fa fa-question-circle me-1"></i> Advisor
          </button>

          <button type="button" class="btn btn-sm btn-theme" onclick="calcExtendedMachineRate()">
            <i class="fa fa-calculator me-1"></i> Berechnen
          </button>
          <button type="button" class="btn btn-sm btn-success" onclick="acceptMachine()">
            <i class="fa fa-check me-1"></i> Übernehmen
          </button>
          <button type="button" class="btn btn-sm btn-secondary" data-bs-dismiss="modal">
            <i class="fa fa-times me-1"></i> Schließen
          </button>
        </div>

        <!-- Rechter Block: Ergebnis "Maschinenkosten (€/h): XX" -->
        <div class="d-flex align-items-center gap-2">
          <label style="font-weight:600;" for="machResult">Maschinenkosten (€/h):</label>
          <!-- Statt <input>, damit .textContent = ... im JS funktioniert -->
          <span id="machResult" class="fw-bold text-theme">--</span>
        </div>
      </div><!-- /.modal-footer -->

    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- #modalMachine -->
<!-- Jahreskosten (falls du es brauchst) -->

<!-- =================== MATERIAL MODAL (Design wie PCB-Kalkulator) =================== -->
<div
  class="modal fade"
  id="modalMaterial"
  tabindex="-1"
  aria-hidden="true"
>
  <!-- "modal-xl" + style="max-width:1000px;" => wie PCB-Modal -->
  <div class="modal-dialog modal-xl" style="max-width:1000px;">
    <!-- Modal-Content mit einheitlicher Schrift, Overflow etc. -->
    <div class="modal-content" style="font-size: 0.9rem; max-height: 85vh; overflow-y: auto;">

      <!-- HEADER: dunkel ("bg-theme text-white"), mit engem Padding -->
      <div class="modal-header bg-theme text-white" style="padding: 0.6rem 1rem;">
        <h5 class="modal-title">Materialliste</h5>
        <!-- Schließen-Knopf in Weiß -->
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>

      <!-- BODY: p-2 + position-relative für evtl. Chat-Bubbles -->
      <div class="modal-body p-2 position-relative">

        <!-- Filterfeld (unverändert) -->
        <div class="mb-3 d-flex gap-2">
          <div class="flex-grow-1">
            <label for="matFilterInput" class="form-label"
              >Filter (Materialname oder Verfahren)</label
            >
            <input
              type="text"
              class="form-control"
              id="matFilterInput"
              placeholder="z.B. 'AlSi9' oder 'Guss'"
              oninput="filterMaterialList()"
            />
          </div>
          <div class="align-self-end">
            <button
              class="btn btn-sm btn-outline-secondary"
              onclick="clearMaterialFilter()"
              style="margin-top: 1.8rem;"
            >
              Filter zurücksetzen
            </button>
          </div>
        </div>

        <!-- Material-Tabelle (ID & Inhalt unverändert) -->
        <table class="table table-sm" id="tblMaterialList">
          <thead>
            <tr>
              <th style="width: 25%;">Material</th>
              <th style="width: 20%;">Verfahren</th>
              <th style="width: 15%;">Preis/kg</th>
              <th style="width: 10%;">CO₂/kg</th>
              <th>Kommentar</th>
              <th style="width: 10%;"></th>
            </tr>
          </thead>
          <tbody>
            <!-- Dynamisch gefüllt via JS (e.g. loadMaterialList()) -->
          </tbody>
        </table>

      </div><!-- /.modal-body -->

      <!-- FOOTER: minimal, Buttons analog PCB-Style -->
      <div
        class="modal-footer d-flex justify-content-between align-items-center"
        style="padding: 0.5rem 1rem;"
      >
        <div>
          <button
            type="button"
            class="btn btn-sm btn-secondary"
            data-bs-dismiss="modal"
          >
            <i class="fa fa-times me-1"></i> Schließen
          </button>
        </div>
      </div><!-- /.modal-footer -->

    </div><!-- /.modal-content -->
  </div><
    </div><!-- /.modal-dialog -->




        <!-- LOHN-LISTE MODAL -->
<!-- =================== LOHNLISTEN-MODAL (DESIGN WIE PCB-PARAMETRIK) =================== -->
<div
  class="modal fade"
  id="modalLohn"
  tabindex="-1"
  aria-hidden="true"
>
  <!-- "modal-xl" + style="max-width:1000px;" => analog zum PCB-Design -->
  <div class="modal-dialog modal-xl" style="max-width:1000px;">
    <!-- Modal-Content mit einheitlicher Schrift, Overflow etc. -->
    <div class="modal-content" style="font-size: 0.9rem; max-height: 85vh; overflow-y: auto;">

      <!-- HEADER: dunkel ("bg-theme text-white"), mit engem Padding -->
      <div class="modal-header bg-theme text-white" style="padding: 0.6rem 1rem;">
        <h5 class="modal-title">Lohnliste</h5>
        <!-- Schließen-Knopf in Weiß -->
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>

      <!-- BODY: p-2 + position-relative -->
      <div class="modal-body p-2 position-relative">

        <!-- Eingabefeld für Anzahl Bediener -->
        <div class="mb-3">
          <label for="operatorsPerMachine" class="form-label">
            Anzahl Bediener pro Maschine
          </label>
          <input
            type="number"
            class="form-control"
            id="operatorsPerMachine"
            step="0.1"
            value="0.5"
          />
        </div>

        <!-- Arbeitsauslastung (Utilization) -->
        <div class="mb-3">
          <label for="lohnUtilPct" class="form-label">
            Arbeitsauslastung (%)
          </label>
          <input
            type="number"
            class="form-control"
            id="lohnUtilPct"
            step="0.1"
            value="85.0"
          />
          <small class="text-muted">
            Beispiel: 85 bedeutet, dass die Kosten auf 85% Produktivzeit umgelegt werden.
          </small>
        </div>

        <!-- Filter-Feld + Button zum Zurücksetzen -->
        <div class="mb-3 d-flex gap-2">
          <input
            type="text"
            class="form-control"
            id="txtLohnFilter"
            placeholder="Filter nach Land, Schichtmodell, Kommentar..."
            oninput="applyLohnFilter()"
          />
          <button
            class="btn btn-sm btn-outline-secondary"
            onclick="clearLohnFilter()"
          >
            Filter zurücksetzen
          </button>
        </div>

        <!-- Tabelle Lohnliste -->
        <table class="table table-sm" id="tblLohnList">
          <thead>
            <tr>
              <th>Land</th>
              <th>Schichtmodell</th>
              <th>All-In (€/h)</th>
              <th>Kommentar</th>
              <th>Aktion</th>
            </tr>
          </thead>
          <tbody>
            <!-- Dynamische Inhalte per JavaScript -->
          </tbody>
        </table>

      </div><!-- /.modal-body -->

      <!-- FOOTER: minimal, wie PCB-Style -->
      <div
        class="modal-footer d-flex justify-content-between align-items-center"
        style="padding: 0.5rem 1rem;"
      >
        <div>
          <button
            type="button"
            class="btn btn-sm btn-secondary"
            data-bs-dismiss="modal"
          >
            <i class="fa fa-times me-1"></i> Schließen
          </button>
        </div>
      </div><!-- /.modal-footer -->

    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- /.modal -->
<!-- =================== MASCHINENLISTE-MODAL (PCB-Style) =================== -->
<div
  class="modal fade"
  id="modalMachineList"
  tabindex="-1"
  aria-hidden="true"
>
  <!-- "modal-xl" + style="max-width:1000px;" => analog zu deinen PCB-Modals -->
  <div class="modal-dialog modal-xl" style="max-width:1000px;">
    <!-- Modal-Content mit einheitlicher Schrift, Overflow etc. -->
    <div class="modal-content" style="font-size: 0.9rem; max-height: 85vh; overflow-y: auto;">

      <!-- HEADER: dunkel ("bg-theme text-white"), mit engem Padding -->
      <div class="modal-header bg-theme text-white" style="padding: 0.6rem 1rem;">
        <h5 class="modal-title">Maschinenliste</h5>
        <!-- Schließen-Knopf in Weiß -->
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>

      <!-- BODY: p-2 + position-relative -->
      <div class="modal-body p-2 position-relative">
        <!-- Filter-Feld + Button zum Zurücksetzen -->
        <div class="mb-3 d-flex gap-2">
          <input
            type="text"
            class="form-control"
            id="txtMachineFilter"
            placeholder="Filter (Maschine, Verfahren, Kommentar...)"
            oninput="applyMachineFilter()"
          />
          <button
            class="btn btn-sm btn-outline-secondary"
            onclick="clearMachineFilter()"
          >
            Filter zurücksetzen
          </button>
        </div>

        <!-- Tabelle Maschinenliste -->
        <table class="table table-sm" id="tblMachineList">
          <thead>
            <tr>
              <th>Maschine</th>
              <th>Verfahren</th>
              <th>Kaufpreis (€)</th>
              <th>Power (kW)</th>
              <th>Kommentar</th>
              <th>Aktion</th>
            </tr>
          </thead>
          <tbody>
            <!-- Dynamische Inhalte per JavaScript -->
          </tbody>
        </table>
      </div><!-- /.modal-body -->

      <!-- FOOTER: minimal, wie PCB-Style -->
      <div
        class="modal-footer d-flex justify-content-between align-items-center"
        style="padding: 0.5rem 1rem;"
      >
        <div>
          <button
            type="button"
            class="btn btn-sm btn-secondary"
            data-bs-dismiss="modal"
          >
            <i class="fa fa-times me-1"></i> Schließen
          </button>
        </div>
      </div><!-- /.modal-footer -->

    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- /.modal --><!--<input id="txtCo2Per100" type="text" class="form-control" /> -->
</div>
      <!-- ================== BEGIN ColorAdmin core JS ================== -->
<script src="/static/coloradmin/js/vendor.min.js"></script>
<script src="/static/coloradmin/js/app.min.js"></script>
    <script src="/static/plugins/apexcharts/apexcharts.min.js"></script>

<!-- ================== END ColorAdmin core JS ================== -->
<!-- Bootstrap-Bundle (JS + Popper) -->
<!-- Chart.js -->
<script
  src="https://cdn.jsdelivr.net/npm/chart.js@4.2.1/dist/chart.umd.min.js"
></script>
<!-- Externes JS -->
  <!-- In base.html oder layout.html (im <head> oder unten vor </body>) -->

<script src="/static/js/mycalc.js"></script>
<script src="/static/js/feinguss_calculator.js"></script>
<script src="/static/js/schmieden_calculator.js"></script>
<script src="/static/js/kaltfliess_calculator.js"></script>
<script src="/static/js/pcb_calculator.js"></script>
<script src="/static/js/spritzguss_calculator.js"></script>
<script src="/static/js/druckguss_calculator.js"></script>
<script src="/static/js/milling_calculator.js"></script>
<script src="/static/js/stamping_calculator.js"></script>
    <!-- Live Chat Widget -->

<hr/>
<div id="cookieBanner" style="position: fixed; bottom: 0; left: 0; right: 0;
     background: #222; color: #fff; padding: 10px; display: none; z-index: 9999;">
  <p style="margin: 0;">
    Wir verwenden Cookies. Einige sind essenziell, andere helfen uns,
    unsere Seite zu verbessern. Mit Klick auf „Alle akzeptieren“ stimmen
    Sie der Verwendung zu.
    <a href="/datenschutz" style="color: #fff; text-decoration: underline;">
      Mehr Infos
    </a>
  </p>
  <button id="cookieAcceptAll" class="btn btn-sm btn-success" style="margin: 5px;">Alle akzeptieren</button>
  <button id="cookieDeclineAll" class="btn btn-sm btn-light" style="margin: 5px;">Nur essenzielle</button>
</div>
</div>
<script>
window.addEventListener("DOMContentLoaded", () => {
  checkLicense(); // oder checkUserLogin();
});
  (function () {
    function getCookie(name) {
      const match = document.cookie.match(new RegExp('(^| )' + name + '=([^;]+)'));
      if (match) return match[2];
    }

    if (!getCookie("cookieConsent")) {
      document.getElementById("cookieBanner").style.display = "block";
    }

    document.getElementById("cookieAcceptAll").addEventListener("click", function () {
      document.cookie = "cookieConsent=all; path=/; max-age=" + (365 * 24 * 60 * 60);
      document.getElementById("cookieBanner").style.display = "none";
      // optional: Google Analytics oder andere Tracker aktivieren
    });

    document.getElementById("cookieDeclineAll").addEventListener("click", function () {
      document.cookie = "cookieConsent=essential; path=/; max-age=" + (365 * 24 * 60 * 60);
      document.getElementById("cookieBanner").style.display = "none";
    });
  })();
</script>
<script>
  // Starte das ColorAdmin App-Framework
  document.addEventListener('DOMContentLoaded', function() {
    App.init();
  });

  // Minimales Chat-Fenster an/aus
  function toggleChatWindow(){
    const cw = document.getElementById("chatWindow");
    cw.style.display = (cw.style.display === "block") ? "none" : "block";
  }
</script>
<hr/>
<footer class="text-center my-3">
  <a href="/impressum">Impressum</a> |
  <a href="/datenschutz">Datenschutz</a> |
  <a href="/agb">AGB</a>
</footer>



</div>

</body>
</html>